(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{563:function(module,exports,__webpack_require__){var jQuery=__webpack_require__(9),qq=function(e){"use strict";return{hide:function(){return e.style.display="none",this},attach:function(t,n){return e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n),function(){qq(e).detach(t,n)}},detach:function(t,n){return e.removeEventListener?e.removeEventListener(t,n,!1):e.attachEvent&&e.detachEvent("on"+t,n),this},contains:function(t){return!!t&&(e===t||(e.contains?e.contains(t):!!(8&t.compareDocumentPosition(e))))},insertBefore:function(t){return t.parentNode.insertBefore(e,t),this},remove:function(){return e.parentNode.removeChild(e),this},css:function(t){if(null==e.style)throw new qq.Error("Can't apply style to node as it is not on the HTMLElement prototype chain!");return null!=t.opacity&&"string"!=typeof e.style.opacity&&void 0!==e.filters&&(t.filter="alpha(opacity="+Math.round(100*t.opacity)+")"),qq.extend(e.style,t),this},hasClass:function(t){return new RegExp("(^| )"+t+"( |$)").test(e.className)},addClass:function(t){return qq(e).hasClass(t)||(e.className+=" "+t),this},removeClass:function(t){var n=new RegExp("(^| )"+t+"( |$)");return e.className=e.className.replace(n," ").replace(/^\s+|\s+$/g,""),this},getByClass:function(t){var n,i=[];return e.querySelectorAll?e.querySelectorAll("."+t):(n=e.getElementsByTagName("*"),qq.each(n,function(e,n){qq(n).hasClass(t)&&i.push(n)}),i)},children:function(){for(var t=[],n=e.firstChild;n;)1===n.nodeType&&t.push(n),n=n.nextSibling;return t},setText:function(t){return e.innerText=t,e.textContent=t,this},clearText:function(){return qq(e).setText("")},hasAttribute:function(t){var n;return e.hasAttribute?!!e.hasAttribute(t)&&null==/^false$/i.exec(e.getAttribute(t)):void 0!==(n=e[t])&&null==/^false$/i.exec(n)}}};!function(){"use strict";var div;qq.log=function(e,t){window.console&&(t&&"info"!==t?window.console[t]?window.console[t](e):window.console.log("<"+t+"> "+e):window.console.log(e))},qq.isObject=function(e){return e&&!e.nodeType&&"[object Object]"===Object.prototype.toString.call(e)},qq.isFunction=function(e){return"function"==typeof e},qq.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)||e&&window.ArrayBuffer&&e.buffer&&e.buffer.constructor===ArrayBuffer},qq.isItemList=function(e){return"[object DataTransferItemList]"===Object.prototype.toString.call(e)},qq.isNodeList=function(e){return"[object NodeList]"===Object.prototype.toString.call(e)||e.item&&e.namedItem},qq.isString=function(e){return"[object String]"===Object.prototype.toString.call(e)},qq.trimStr=function(e){return String.prototype.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},qq.format=function(e){var t=Array.prototype.slice.call(arguments,1),n=e,i=n.indexOf("{}");return qq.each(t,function(e,t){var r=n.substring(0,i),o=n.substring(i+2);if((i=(n=r+t+o).indexOf("{}",i+t.length))<0)return!1}),n},qq.isFile=function(e){return window.File&&"[object File]"===Object.prototype.toString.call(e)},qq.isFileList=function(e){return window.FileList&&"[object FileList]"===Object.prototype.toString.call(e)},qq.isFileOrInput=function(e){return qq.isFile(e)||qq.isInput(e)},qq.isInput=function(e,t){var n=function(e){var n=e.toLowerCase();return t?"file"!==n:"file"===n};return!!(window.HTMLInputElement&&"[object HTMLInputElement]"===Object.prototype.toString.call(e)&&e.type&&n(e.type))||!!(e.tagName&&"input"===e.tagName.toLowerCase()&&e.type&&n(e.type))},qq.isBlob=function(e){if(window.Blob&&"[object Blob]"===Object.prototype.toString.call(e))return!0},qq.isXhrUploadSupported=function(){var e=document.createElement("input");return e.type="file",void 0!==e.multiple&&"undefined"!=typeof File&&"undefined"!=typeof FormData&&void 0!==qq.createXhrInstance().upload},qq.createXhrInstance=function(){if(window.XMLHttpRequest)return new XMLHttpRequest;try{return new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(e){return qq.log("Neither XHR or ActiveX are supported!","error"),null}},qq.isFolderDropSupported=function(e){return e.items&&e.items.length>0&&e.items[0].webkitGetAsEntry},qq.isFileChunkingSupported=function(){return!qq.androidStock()&&qq.isXhrUploadSupported()&&(void 0!==File.prototype.slice||void 0!==File.prototype.webkitSlice||void 0!==File.prototype.mozSlice)},qq.sliceBlob=function(e,t,n){return(e.slice||e.mozSlice||e.webkitSlice).call(e,t,n)},qq.arrayBufferToHex=function(e){var t="",n=new Uint8Array(e);return qq.each(n,function(e,n){var i=n.toString(16);i.length<2&&(i="0"+i),t+=i}),t},qq.readBlobToHex=function(e,t,n){var i=qq.sliceBlob(e,t,t+n),r=new FileReader,o=new qq.Promise;return r.onload=function(){o.success(qq.arrayBufferToHex(r.result))},r.onerror=o.failure,r.readAsArrayBuffer(i),o},qq.extend=function(e,t,n){return qq.each(t,function(t,i){n&&qq.isObject(i)?(void 0===e[t]&&(e[t]={}),qq.extend(e[t],i,!0)):e[t]=i}),e},qq.override=function(e,t){var n={},i=t(n);return qq.each(i,function(t,i){void 0!==e[t]&&(n[t]=e[t]),e[t]=i}),e},qq.indexOf=function(e,t,n){if(e.indexOf)return e.indexOf(t,n);n=n||0;var i=e.length;for(n<0&&(n+=i);n<i;n+=1)if(e.hasOwnProperty(n)&&e[n]===t)return n;return-1},qq.getUniqueId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},qq.ie=function(){return-1!==navigator.userAgent.indexOf("MSIE")},qq.ie7=function(){return-1!==navigator.userAgent.indexOf("MSIE 7")},qq.ie10=function(){return-1!==navigator.userAgent.indexOf("MSIE 10")},qq.ie11=function(){return-1!==navigator.userAgent.indexOf("Trident")&&-1!==navigator.userAgent.indexOf("rv:11")},qq.safari=function(){return void 0!==navigator.vendor&&-1!==navigator.vendor.indexOf("Apple")},qq.chrome=function(){return void 0!==navigator.vendor&&-1!==navigator.vendor.indexOf("Google")},qq.opera=function(){return void 0!==navigator.vendor&&-1!==navigator.vendor.indexOf("Opera")},qq.firefox=function(){return!qq.ie11()&&-1!==navigator.userAgent.indexOf("Mozilla")&&void 0!==navigator.vendor&&""===navigator.vendor},qq.windows=function(){return"Win32"===navigator.platform},qq.android=function(){return-1!==navigator.userAgent.toLowerCase().indexOf("android")},qq.androidStock=function(){return qq.android()&&navigator.userAgent.toLowerCase().indexOf("chrome")<0},qq.ios7=function(){return qq.ios()&&-1!==navigator.userAgent.indexOf(" OS 7_")},qq.ios=function(){return-1!==navigator.userAgent.indexOf("iPad")||-1!==navigator.userAgent.indexOf("iPod")||-1!==navigator.userAgent.indexOf("iPhone")},qq.preventDefault=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},qq.toElement=(div=document.createElement("div"),function(e){div.innerHTML=e;var t=div.firstChild;return div.removeChild(t),t}),qq.each=function(e,t){var n;if(e)if(window.Storage&&e.constructor===window.Storage)for(n=0;n<e.length&&!1!==t(e.key(n),e.getItem(e.key(n)));n++);else if(qq.isArray(e)||qq.isItemList(e)||qq.isNodeList(e))for(n=0;n<e.length&&!1!==t(n,e[n]);n++);else if(qq.isString(e))for(n=0;n<e.length&&!1!==t(n,e.charAt(n));n++);else for(n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&!1===t(n,e[n]))break},qq.bind=function(e,t){if(qq.isFunction(e)){var n=Array.prototype.slice.call(arguments,2);return function(){var i=qq.extend([],n);return arguments.length&&(i=i.concat(Array.prototype.slice.call(arguments))),e.apply(t,i)}}throw new Error("first parameter must be a function!")},qq.obj2url=function(e,t,n){var i=[],r="&",o=function(e,n){var r=t?/\[\]$/.test(t)?t:t+"["+n+"]":n;"undefined"!==r&&"undefined"!==n&&i.push("object"==typeof e?qq.obj2url(e,r,!0):"[object Function]"===Object.prototype.toString.call(e)?encodeURIComponent(r)+"="+encodeURIComponent(e()):encodeURIComponent(r)+"="+encodeURIComponent(e))};return!n&&t?(r=/\?/.test(t)?/\?$/.test(t)?"":"&":"?",i.push(t),i.push(qq.obj2url(e))):"[object Array]"===Object.prototype.toString.call(e)&&void 0!==e?qq.each(e,function(e,t){o(t,e)}):null!=e&&"object"==typeof e?qq.each(e,function(e,t){o(t,e)}):i.push(encodeURIComponent(t)+"="+encodeURIComponent(e)),t?i.join(r):i.join(r).replace(/^&/,"").replace(/%20/g,"+")},qq.obj2FormData=function(e,t,n){return t||(t=new FormData),qq.each(e,function(e,i){e=n?n+"["+e+"]":e,qq.isObject(i)?qq.obj2FormData(i,t,e):qq.isFunction(i)?t.append(e,i()):t.append(e,i)}),t},qq.obj2Inputs=function(e,t){var n;return t||(t=document.createElement("form")),qq.obj2FormData(e,{append:function(e,i){(n=document.createElement("input")).setAttribute("name",e),n.setAttribute("value",i),t.appendChild(n)}}),t},qq.parseJson=function(json){return window.JSON&&qq.isFunction(JSON.parse)?JSON.parse(json):eval("("+json+")")},qq.getExtension=function(e){var t=e.lastIndexOf(".")+1;if(t>0)return e.substr(t,e.length-t)},qq.getFilename=function(e){return qq.isInput(e)?e.value.replace(/.*(\/|\\)/,""):qq.isFile(e)&&null!==e.fileName&&void 0!==e.fileName?e.fileName:e.name},qq.DisposeSupport=function(){var e=[];return{dispose:function(){var t;do{(t=e.shift())&&t()}while(t)},attach:function(){var e=arguments;this.addDisposer(qq(e[0]).attach.apply(this,Array.prototype.slice.call(arguments,1)))},addDisposer:function(t){e.push(t)}}}}(),function(){"use strict";qq.Error=function(e){this.message="[Fine Uploader "+qq.version+"] "+e},qq.Error.prototype=new Error}(),qq.version="5.0.3",qq.supportedFeatures=function(){"use strict";var e,t,n,i,r,o,s,a,u,l,c,d,p,h;function f(){return!!window.XMLHttpRequest&&void 0!==qq.createXhrInstance().withCredentials}function q(){return void 0!==window.XDomainRequest}return e=function(){var e,t=!0;try{(e=document.createElement("input")).type="file",qq(e).hide(),e.disabled&&(t=!1)}catch(e){t=!1}return t}(),t=(n=e&&qq.isXhrUploadSupported())&&!qq.androidStock(),i=n&&(qq.chrome()||qq.opera())&&void 0!==navigator.userAgent.match(/Chrome\/[2][1-9]|Chrome\/[3-9][0-9]/),r=n&&qq.isFileChunkingSupported(),o=n&&r&&!!window.localStorage,s=n&&(qq.chrome()||qq.opera())&&void 0!==navigator.userAgent.match(/Chrome\/[1][4-9]|Chrome\/[2-9][0-9]/),a=e&&(void 0!==window.postMessage||n),l=f(),u=q(),c=!!f()||q(),d=void 0!==document.createElement("input").webkitdirectory,p=n&&void 0!==window.FileReader,h=!!n&&!(qq.androidStock()||qq.ios()&&navigator.userAgent.indexOf("CriOS")>=0),{ajaxUploading:n,blobUploading:t,canDetermineSize:n,chunking:r,deleteFileCors:c,deleteFileCorsXdr:u,deleteFileCorsXhr:l,fileDrop:n,folderDrop:i,folderSelection:d,imagePreviews:p,imageValidation:p,itemSizeValidation:n,pause:r,progressBar:h,resume:o,scaling:p&&t,tiffPreviews:qq.safari(),unlimitedScaledImageSize:!qq.ios(),uploading:e,uploadCors:a,uploadCustomHeaders:n,uploadNonMultipart:n,uploadViaPaste:s}}(),qq.isGenericPromise=function(e){"use strict";return!!(e&&e.then&&qq.isFunction(e.then))},qq.Promise=function(){"use strict";var e,t,n=[],i=[],r=[],o=0;qq.extend(this,{then:function(r,s){return 0===o?(r&&n.push(r),s&&i.push(s)):-1===o?s&&s.apply(null,t):r&&r.apply(null,e),this},done:function(n){return 0===o?r.push(n):n.apply(null,void 0===t?e:t),this},success:function(){return o=1,e=arguments,n.length&&qq.each(n,function(t,n){n.apply(null,e)}),r.length&&qq.each(r,function(t,n){n.apply(null,e)}),this},failure:function(){return o=-1,t=arguments,i.length&&qq.each(i,function(e,n){n.apply(null,t)}),r.length&&qq.each(r,function(e,n){n.apply(null,t)}),this}})},qq.BlobProxy=function(e,t){"use strict";qq.extend(this,{referenceBlob:e,create:function(){return t(e)}})},qq.UploadButton=function(e){"use strict";var t,n,i=new qq.DisposeSupport,r={element:null,multiple:!1,acceptFiles:null,folders:!1,name:"qqfile",onChange:function(e){},hoverClass:"qq-upload-button-hover",focusClass:"qq-upload-button-focus"};function o(){var e=document.createElement("input");return e.setAttribute(qq.UploadButton.BUTTON_ID_ATTR_NAME,n),r.multiple&&e.setAttribute("multiple",""),r.folders&&qq.supportedFeatures.folderSelection&&e.setAttribute("webkitdirectory",""),r.acceptFiles&&e.setAttribute("accept",r.acceptFiles),e.setAttribute("type","file"),e.setAttribute("name",r.name),qq(e).css({position:"absolute",right:0,top:0,fontFamily:"Arial",fontSize:"118px",margin:0,padding:0,cursor:"pointer",opacity:0}),r.element.appendChild(e),i.attach(e,"change",function(){r.onChange(e)}),i.attach(e,"mouseover",function(){qq(r.element).addClass(r.hoverClass)}),i.attach(e,"mouseout",function(){qq(r.element).removeClass(r.hoverClass)}),i.attach(e,"focus",function(){qq(r.element).addClass(r.focusClass)}),i.attach(e,"blur",function(){qq(r.element).removeClass(r.focusClass)}),window.attachEvent&&e.setAttribute("tabIndex","-1"),e}qq.extend(r,e),n=qq.getUniqueId(),qq(r.element).css({position:"relative",overflow:"hidden",direction:"ltr"}),t=o(),qq.extend(this,{getInput:function(){return t},getButtonId:function(){return n},setMultiple:function(e){e!==r.multiple&&(e?t.setAttribute("multiple",""):t.removeAttribute("multiple"))},setAcceptFiles:function(e){e!==r.acceptFiles&&t.setAttribute("accept",e)},reset:function(){t.parentNode&&qq(t).remove(),qq(r.element).removeClass(r.focusClass),t=o()}})},qq.UploadButton.BUTTON_ID_ATTR_NAME="qq-button-id",qq.UploadData=function(e){"use strict";var t=[],n={},i={},r={},o={};qq.extend(this,{addFile:function(s){var a=s.status||qq.status.SUBMITTING,u=t.push({name:s.name,originalName:s.name,uuid:s.uuid,size:s.size||-1,status:a})-1;return s.batchId&&(t[u].batchId=s.batchId,void 0===o[s.batchId]&&(o[s.batchId]=[]),o[s.batchId].push(u)),s.proxyGroupId&&(t[u].proxyGroupId=s.proxyGroupId,void 0===r[s.proxyGroupId]&&(r[s.proxyGroupId]=[]),r[s.proxyGroupId].push(u)),t[u].id=u,n[s.uuid]=u,void 0===i[a]&&(i[a]=[]),i[a].push(u),e.onStatusChange(u,null,a),u},retrieve:function(e){return qq.isObject(e)&&t.length?void 0!==e.id?function(e){if(qq.isArray(e)){var n=[];return qq.each(e,function(e,i){n.push(t[i])}),n}return t[e]}(e.id):void 0!==e.uuid?function(e){if(qq.isArray(e)){var i=[];return qq.each(e,function(e,r){i.push(t[n[r]])}),i}return t[n[e]]}(e.uuid):e.status?(r=e.status,o=[],s=[].concat(r),qq.each(s,function(e,n){var r=i[n];void 0!==r&&qq.each(r,function(e,n){o.push(t[n])})}),o):void 0:qq.extend([],t,!0);var r,o,s},reset:function(){t=[],n={},i={},o={}},setStatus:function(n,r){var o=t[n].status,s=qq.indexOf(i[o],n);i[o].splice(s,1),t[n].status=r,void 0===i[r]&&(i[r]=[]),i[r].push(n),e.onStatusChange(n,o,r)},uuidChanged:function(e,i){var r=t[e].uuid;t[e].uuid=i,n[i]=e,delete n[r]},updateName:function(e,n){t[e].name=n},updateSize:function(e,n){t[e].size=n},setParentId:function(e,n){t[e].parentId=n},getIdsInProxyGroup:function(e){var n=t[e].proxyGroupId;return n?r[n]:[]},getIdsInBatch:function(e){var n=t[e].batchId;return o[n]}})},qq.status={SUBMITTING:"submitting",SUBMITTED:"submitted",REJECTED:"rejected",QUEUED:"queued",CANCELED:"canceled",PAUSED:"paused",UPLOADING:"uploading",UPLOAD_RETRYING:"retrying upload",UPLOAD_SUCCESSFUL:"upload successful",UPLOAD_FAILED:"upload failed",DELETE_FAILED:"delete failed",DELETING:"deleting",DELETED:"deleted"},function(){"use strict";qq.basePublicApi={addBlobs:function(e,t,n){if(!qq.supportedFeatures.blobUploading)throw new qq.Error("Blob uploading is not supported in this browser!");if(e){var i=[].concat(e),r=[],o=0===this._storedIds.length?qq.getUniqueId():this._currentBatchId,s=this;this._currentBatchId=o,qq.each(i,function(e,t){var n;qq.isBlob(t)&&!qq.isFileOrInput(t)?n={blob:t,name:s._options.blobs.defaultName}:qq.isObject(t)&&t.blob&&t.name?n=t:s.log("addBlobs: entry at index "+e+" is not a Blob or a BlobData object","error"),n&&s._handleNewFile(n,o,r)}),this._prepareItemsForUpload(r,t,n)}else this.log("undefined or non-array parameter passed into addBlobs","error")},addFiles:function(e,t,n){var i,r,o,s=[],a=0===this._storedIds.length?qq.getUniqueId():this._currentBatchId;if(this._currentBatchId=a,e){for(qq.isFileList(e)||(e=[].concat(e)),i=0;i<e.length;i+=1)if(r=e[i],qq.isFileOrInput(r))if(qq.isInput(r)&&qq.supportedFeatures.ajaxUploading)for(o=0;o<r.files.length;o++)this._handleNewFile(r.files[o],a,s);else this._handleNewFile(r,a,s);else this.log(r+" is not a File or INPUT element!  Ignoring!","warn");this.log("Received "+s.length+" files or inputs."),this._prepareItemsForUpload(s,t,n)}},cancel:function(e){this._handler.cancel(e)},cancelAll:function(){var e=[],t=this;qq.extend(e,this._storedIds),qq.each(e,function(e,n){t.cancel(n)}),this._handler.cancelAll()},clearStoredFiles:function(){this._storedIds=[]},continueUpload:function(e){var t=this._uploadData.retrieve({id:e});return!(!qq.supportedFeatures.pause||!this._options.chunking.enabled)&&(t.status===qq.status.PAUSED?(this.log(qq.format("Paused file ID {} ({}) will be continued.  Not paused.",e,this.getName(e))),this._uploadFile(e),!0):(this.log(qq.format("Ignoring continue for file ID {} ({}).  Not paused.",e,this.getName(e)),"error"),!1))},deleteFile:function(e){return this._onSubmitDelete(e)},doesExist:function(e){return this._handler.isValid(e)},drawThumbnail:function(e,t,n,i){var r=new qq.Promise;if(this._imageGenerator){var o=this._thumbnailUrls[e],s={scale:n>0,maxSize:n>0?n:null};!i&&qq.supportedFeatures.imagePreviews&&(o=this.getFile(e)),null==o?r.failure({container:t,error:"File or URL not found."}):this._imageGenerator.generate(o,t,s).then(function(e){r.success(e)},function(e,t){r.failure({container:e,error:t||"Problem generating thumbnail"})})}else r.failure({container:t,error:"Missing image generator module"});return r},getButton:function(e){return this._getButton(this._buttonIdsForFileIds[e])},getFile:function(e){return this._handler.getFile(e)||null},getInProgress:function(){return this._uploadData.retrieve({status:[qq.status.UPLOADING,qq.status.UPLOAD_RETRYING,qq.status.QUEUED]}).length},getName:function(e){return this._uploadData.retrieve({id:e}).name},getParentId:function(e){var t=this.getUploads({id:e}),n=null;return t&&void 0!==t.parentId&&(n=t.parentId),n},getResumableFilesData:function(){return this._handler.getResumableFilesData()},getSize:function(e){return this._uploadData.retrieve({id:e}).size},getNetUploads:function(){return this._netUploaded},getRemainingAllowedItems:function(){return this._options.validation.itemLimit>0?this._options.validation.itemLimit-this._netUploadedOrQueued:null},getUploads:function(e){return this._uploadData.retrieve(e)},getUuid:function(e){return this._uploadData.retrieve({id:e}).uuid},log:function(e,t){!this._options.debug||t&&"info"!==t?t&&"info"!==t&&qq.log("[Fine Uploader "+qq.version+"] "+e,t):qq.log("[Fine Uploader "+qq.version+"] "+e)},pauseUpload:function(e){var t=this._uploadData.retrieve({id:e});if(!qq.supportedFeatures.pause||!this._options.chunking.enabled)return!1;if(qq.indexOf([qq.status.UPLOADING,qq.status.UPLOAD_RETRYING],t.status)>=0){if(this._handler.pause(e))return this._uploadData.setStatus(e,qq.status.PAUSED),!0;this.log(qq.format("Unable to pause file ID {} ({}).",e,this.getName(e)),"error")}else this.log(qq.format("Ignoring pause for file ID {} ({}).  Not in progress.",e,this.getName(e)),"error");return!1},reset:function(){this.log("Resetting uploader..."),this._handler.reset(),this._storedIds=[],this._autoRetries=[],this._retryTimeouts=[],this._preventRetries=[],this._thumbnailUrls=[],qq.each(this._buttons,function(e,t){t.reset()}),this._paramsStore.reset(),this._endpointStore.reset(),this._netUploadedOrQueued=0,this._netUploaded=0,this._uploadData.reset(),this._buttonIdsForFileIds=[],this._pasteHandler&&this._pasteHandler.reset(),this._options.session.refreshOnReset&&this._refreshSessionData(),this._succeededSinceLastAllComplete=[],this._failedSinceLastAllComplete=[],this._totalProgress&&this._totalProgress.reset()},retry:function(e){return this._manualRetry(e)},scaleImage:function(e,t){return qq.Scaler.prototype.scaleImage(e,t,{log:qq.bind(this.log,this),getFile:qq.bind(this.getFile,this),uploadData:this._uploadData})},setCustomHeaders:function(e,t){this._customHeadersStore.set(e,t)},setDeleteFileCustomHeaders:function(e,t){this._deleteFileCustomHeadersStore.set(e,t)},setDeleteFileEndpoint:function(e,t){this._deleteFileEndpointStore.set(e,t)},setDeleteFileParams:function(e,t){this._deleteFileParamsStore.set(e,t)},setEndpoint:function(e,t){this._endpointStore.set(e,t)},setName:function(e,t){this._uploadData.updateName(e,t)},setParams:function(e,t){this._paramsStore.set(e,t)},setUuid:function(e,t){return this._uploadData.uuidChanged(e,t)},uploadStoredFiles:function(){var e;if(0===this._storedIds.length)this._itemError("noFilesError");else for(;this._storedIds.length;)e=this._storedIds.shift(),this._uploadFile(e)}},qq.basePrivateApi={_addCannedFile:function(e){var t=this._uploadData.addFile({uuid:e.uuid,name:e.name,size:e.size,status:qq.status.UPLOAD_SUCCESSFUL});return e.deleteFileEndpoint&&this.setDeleteFileEndpoint(e.deleteFileEndpoint,t),e.deleteFileParams&&this.setDeleteFileParams(e.deleteFileParams,t),e.thumbnailUrl&&(this._thumbnailUrls[t]=e.thumbnailUrl),this._netUploaded++,this._netUploadedOrQueued++,t},_annotateWithButtonId:function(e,t){qq.isFile(e)&&(e.qqButtonId=this._getButtonId(t))},_batchError:function(e){this._options.callbacks.onError(null,null,e,void 0)},_createDeleteHandler:function(){var e=this;return new qq.DeleteFileAjaxRequester({method:this._options.deleteFile.method.toUpperCase(),maxConnections:this._options.maxConnections,uuidParamName:this._options.request.uuidName,customHeaders:this._deleteFileCustomHeadersStore,paramsStore:this._deleteFileParamsStore,endpointStore:this._deleteFileEndpointStore,demoMode:this._options.demoMode,cors:this._options.cors,log:qq.bind(e.log,e),onDelete:function(t){e._onDelete(t),e._options.callbacks.onDelete(t)},onDeleteComplete:function(t,n,i){e._onDeleteComplete(t,n,i),e._options.callbacks.onDeleteComplete(t,n,i)}})},_createPasteHandler:function(){var e=this;return new qq.PasteSupport({targetElement:this._options.paste.targetElement,callbacks:{log:qq.bind(e.log,e),pasteReceived:function(t){e._handleCheckedCallback({name:"onPasteReceived",callback:qq.bind(e._options.callbacks.onPasteReceived,e,t),onSuccess:qq.bind(e._handlePasteSuccess,e,t),identifier:"pasted image"})}}})},_createStore:function(e,t){var n={},i=e,r={},o=function(e){return qq.isObject(e)?qq.extend({},e):e},s=function(e,n){t&&qq.isObject(n)&&qq.extend(n,qq.isFunction(t)?t():t),r[e]&&qq.extend(n,r[e])};return{set:function(e,t){null==t?(n={},i=o(e)):n[t]=o(e)},get:function(e){var t;return t=null!=e&&n[e]?n[e]:o(i),s(e,t),o(t)},addReadOnly:function(e,t){qq.isObject(n)&&(r[e]=r[e]||{},qq.extend(r[e],t))},remove:function(e){return delete n[e]},reset:function(){n={},r={},i=e}}},_createUploadDataTracker:function(){var e=this;return new qq.UploadData({getName:function(t){return e.getName(t)},getUuid:function(t){return e.getUuid(t)},getSize:function(t){return e.getSize(t)},onStatusChange:function(t,n,i){e._onUploadStatusChange(t,n,i),e._options.callbacks.onStatusChange(t,n,i),e._maybeAllComplete(t,i),e._totalProgress&&setTimeout(function(){e._totalProgress.onStatusChange(t,n,i)},0)}})},_createUploadButton:function(e){var t=this,n=e.accept||this._options.validation.acceptFiles,i=e.allowedExtensions||this._options.validation.allowedExtensions;var r=new qq.UploadButton({element:e.element,folders:e.folders,name:this._options.request.inputName,multiple:!!qq.supportedFeatures.ajaxUploading&&(!qq.ios7()||!t._isAllowedExtension(i,".mov"))&&(void 0===e.multiple?t._options.multiple:e.multiple),acceptFiles:n,onChange:function(e){t._onInputChange(e)},hoverClass:this._options.classes.buttonHover,focusClass:this._options.classes.buttonFocus});return this._disposeSupport.addDisposer(function(){r.dispose()}),t._buttons.push(r),r},_createUploadHandler:function(e,t){var n=this,i={},r={debug:this._options.debug,maxConnections:this._options.maxConnections,cors:this._options.cors,demoMode:this._options.demoMode,paramsStore:this._paramsStore,endpointStore:this._endpointStore,chunking:this._options.chunking,resume:this._options.resume,blobs:this._options.blobs,log:qq.bind(n.log,n),preventRetryParam:this._options.retry.preventRetryResponseProperty,onProgress:function(e,t,r,o){i[e]&&i[e].loaded===r&&i[e].total===o||(n._onProgress(e,t,r,o),n._options.callbacks.onProgress(e,t,r,o)),i[e]={loaded:r,total:o}},onComplete:function(e,t,r,o){delete i[e];var s=n.getUploads({id:e}).status;if(s!==qq.status.UPLOAD_SUCCESSFUL&&s!==qq.status.UPLOAD_FAILED){var a=n._onComplete(e,t,r,o);a instanceof qq.Promise?a.done(function(){n._options.callbacks.onComplete(e,t,r,o)}):n._options.callbacks.onComplete(e,t,r,o)}},onCancel:function(e,t,i){var r=new qq.Promise;return n._handleCheckedCallback({name:"onCancel",callback:qq.bind(n._options.callbacks.onCancel,n,e,t),onFailure:r.failure,onSuccess:function(){i.then(function(){n._onCancel(e,t)}),r.success()},identifier:e}),r},onUploadPrep:qq.bind(this._onUploadPrep,this),onUpload:function(e,t){n._onUpload(e,t),n._options.callbacks.onUpload(e,t)},onUploadChunk:function(e,t,i){n._onUploadChunk(e,i),n._options.callbacks.onUploadChunk(e,t,i)},onUploadChunkSuccess:function(e,t,i,r){n._options.callbacks.onUploadChunkSuccess.apply(n,arguments)},onResume:function(e,t,i){return n._options.callbacks.onResume(e,t,i)},onAutoRetry:function(e,t,i,r){return n._onAutoRetry.apply(n,arguments)},onUuidChanged:function(e,t){n.log("Server requested UUID change from '"+n.getUuid(e)+"' to '"+t+"'"),n.setUuid(e,t)},getName:qq.bind(n.getName,n),getUuid:qq.bind(n.getUuid,n),getSize:qq.bind(n.getSize,n),setSize:qq.bind(n._setSize,n),getDataByUuid:function(e){return n.getUploads({uuid:e})},isQueued:function(e){var t=n.getUploads({id:e}).status;return t===qq.status.QUEUED||t===qq.status.SUBMITTED||t===qq.status.UPLOAD_RETRYING||t===qq.status.PAUSED},getIdsInProxyGroup:n._uploadData.getIdsInProxyGroup,getIdsInBatch:n._uploadData.getIdsInBatch};return qq.each(this._options.request,function(e,t){r[e]=t}),r.customHeaders=this._customHeadersStore,e&&qq.each(e,function(e,t){r[e]=t}),new qq.UploadHandlerController(r,t)},_fileOrBlobRejected:function(e){this._netUploadedOrQueued--,this._uploadData.setStatus(e,qq.status.REJECTED)},_formatSize:function(e){var t=-1;do{e/=1e3,t++}while(e>999);return Math.max(e,.1).toFixed(1)+this._options.text.sizeSymbols[t]},_generateExtraButtonSpecs:function(){var e=this;this._extraButtonSpecs={},qq.each(this._options.extraButtons,function(t,n){var i=n.multiple,r=qq.extend({},e._options.validation,!0),o=qq.extend({},n);void 0===i&&(i=e._options.multiple),o.validation&&qq.extend(r,n.validation,!0),qq.extend(o,{multiple:i,validation:r},!0),e._initExtraButton(o)})},_getButton:function(e){var t=this._extraButtonSpecs[e];return t?t.element:e===this._defaultButtonId?this._options.button:void 0},_getButtonId:function(e){var t,n,i=e;if(i instanceof qq.BlobProxy&&(i=i.referenceBlob),i&&!qq.isBlob(i)){if(qq.isFile(i))return i.qqButtonId;if("input"===i.tagName.toLowerCase()&&"file"===i.type.toLowerCase())return i.getAttribute(qq.UploadButton.BUTTON_ID_ATTR_NAME);if(t=i.getElementsByTagName("input"),qq.each(t,function(e,t){if("file"===t.getAttribute("type"))return n=t,!1}),n)return n.getAttribute(qq.UploadButton.BUTTON_ID_ATTR_NAME)}},_getNotFinished:function(){return this._uploadData.retrieve({status:[qq.status.UPLOADING,qq.status.UPLOAD_RETRYING,qq.status.QUEUED,qq.status.SUBMITTING,qq.status.SUBMITTED,qq.status.PAUSED]}).length},_getValidationBase:function(e){var t=this._extraButtonSpecs[e];return t?t.validation:this._options.validation},_getValidationDescriptor:function(e){return e.file instanceof qq.BlobProxy?{name:qq.getFilename(e.file.referenceBlob),size:e.file.referenceBlob.size}:{name:this.getUploads({id:e.id}).name,size:this.getUploads({id:e.id}).size}},_getValidationDescriptors:function(e){var t=this,n=[];return qq.each(e,function(e,i){n.push(t._getValidationDescriptor(i))}),n},_handleCameraAccess:function(){if(this._options.camera.ios&&qq.ios()){var e=this._options.camera.button,t=e?this._getButtonId(e):this._defaultButtonId,n=this._options;t&&t!==this._defaultButtonId&&(n=this._extraButtonSpecs[t]),n.multiple=!1,null===n.validation.acceptFiles?n.validation.acceptFiles="image/*;capture=camera":n.validation.acceptFiles+=",image/*;capture=camera",qq.each(this._buttons,function(e,i){if(i.getButtonId()===t)return i.setMultiple(n.multiple),i.setAcceptFiles(n.acceptFiles),!1})}},_handleCheckedCallback:function(e){var t=this,n=e.callback();return qq.isGenericPromise(n)?(this.log(e.name+" - waiting for "+e.name+" promise to be fulfilled for "+e.identifier),n.then(function(n){t.log(e.name+" promise success for "+e.identifier),e.onSuccess(n)},function(){e.onFailure?(t.log(e.name+" promise failure for "+e.identifier),e.onFailure()):t.log(e.name+" promise failure for "+e.identifier)})):(!1!==n?e.onSuccess(n):e.onFailure?(this.log(e.name+" - return value was 'false' for "+e.identifier+".  Invoking failure callback."),e.onFailure()):this.log(e.name+" - return value was 'false' for "+e.identifier+".  Will not proceed."),n)},_handleNewFile:function(e,t,n){var i=this,r=qq.getUniqueId(),o=-1,s=qq.getFilename(e),a=e.blob||e,u=this._customNewFileHandler?this._customNewFileHandler:qq.bind(i._handleNewFileGeneric,i);!qq.isInput(a)&&a.size>=0&&(o=a.size),u(a,s,r,o,n,t,this._options.request.uuidName,{uploadData:i._uploadData,paramsStore:i._paramsStore,addFileToHandler:function(e,t){i._handler.add(e,t),i._netUploadedOrQueued++,i._trackButton(e)}})},_handleNewFileGeneric:function(e,t,n,i,r,o){var s=this._uploadData.addFile({uuid:n,name:t,size:i,batchId:o});this._handler.add(s,e),this._trackButton(s),this._netUploadedOrQueued++,r.push({id:s,file:e})},_handlePasteSuccess:function(e,t){var n=e.type.split("/")[1],i=t;null==i&&(i=this._options.paste.defaultName),i+="."+n,this.addBlobs({name:i,blob:e})},_initExtraButton:function(e){var t=this._createUploadButton({element:e.element,multiple:e.multiple,accept:e.validation.acceptFiles,folders:e.folders,allowedExtensions:e.validation.allowedExtensions});this._extraButtonSpecs[t.getButtonId()]=e},_initFormSupportAndParams:function(){this._formSupport=qq.FormSupport&&new qq.FormSupport(this._options.form,qq.bind(this.uploadStoredFiles,this),qq.bind(this.log,this)),this._formSupport&&this._formSupport.attachedToForm?(this._paramsStore=this._createStore(this._options.request.params,this._formSupport.getFormInputsAsObject),this._options.autoUpload=this._formSupport.newAutoUpload,this._formSupport.newEndpoint&&(this._options.request.endpoint=this._formSupport.newEndpoint)):this._paramsStore=this._createStore(this._options.request.params)},_isDeletePossible:function(){return!(!qq.DeleteFileAjaxRequester||!this._options.deleteFile.enabled)&&(!this._options.cors.expected||(!!qq.supportedFeatures.deleteFileCorsXhr||!(!qq.supportedFeatures.deleteFileCorsXdr||!this._options.cors.allowXdr)))},_isAllowedExtension:function(e,t){var n=!1;return!e.length||(qq.each(e,function(e,i){if(qq.isString(i)){var r=new RegExp("\\."+i+"$","i");if(null!=t.match(r))return n=!0,!1}}),n)},_itemError:function(e,t,n){var i,r,o=this._options.messages[e],s=[],a=[].concat(t),u=a[0],l=this._getButtonId(n),c=this._getValidationBase(l);function d(e,t){o=o.replace(e,t)}return qq.each(c.allowedExtensions,function(e,t){qq.isString(t)&&s.push(t)}),i=s.join(", ").toLowerCase(),d("{file}",this._options.formatFileName(u)),d("{extensions}",i),d("{sizeLimit}",this._formatSize(c.sizeLimit)),d("{minSizeLimit}",this._formatSize(c.minSizeLimit)),null!==(r=o.match(/(\{\w+\})/g))&&qq.each(r,function(e,t){d(t,a[e])}),this._options.callbacks.onError(null,u,o,void 0),o},_manualRetry:function(e,t){if(this._onBeforeManualRetry(e))return this._netUploadedOrQueued++,this._uploadData.setStatus(e,qq.status.UPLOAD_RETRYING),t?t(e):this._handler.retry(e),!0},_maybeAllComplete:function(e,t){var n=this,i=this._getNotFinished();t===qq.status.UPLOAD_SUCCESSFUL?this._succeededSinceLastAllComplete.push(e):t===qq.status.UPLOAD_FAILED&&this._failedSinceLastAllComplete.push(e),0===i&&(this._succeededSinceLastAllComplete.length||this._failedSinceLastAllComplete.length)&&setTimeout(function(){n._onAllComplete(n._succeededSinceLastAllComplete,n._failedSinceLastAllComplete)},0)},_maybeParseAndSendUploadError:function(e,t,n,i){if(!n.success)if(i&&200!==i.status&&!n.error)this._options.callbacks.onError(e,t,"XHR returned response code "+i.status,i);else{var r=n.error?n.error:this._options.text.defaultResponseError;this._options.callbacks.onError(e,t,r,i)}},_maybeProcessNextItemAfterOnValidateCallback:function(e,t,n,i,r){var o=this;if(t.length>n)if(e||!this._options.validation.stopOnFirstInvalidFile)setTimeout(function(){var e=o._getValidationDescriptor(t[n]);o._handleCheckedCallback({name:"onValidate",callback:qq.bind(o._options.callbacks.onValidate,o,t[n].file),onSuccess:qq.bind(o._onValidateCallbackSuccess,o,t,n,i,r),onFailure:qq.bind(o._onValidateCallbackFailure,o,t,n,i,r),identifier:"Item '"+e.name+"', size: "+e.size})},0);else if(!e)for(;n<t.length;n++)o._fileOrBlobRejected(t[n].id)},_onAllComplete:function(e,t){this._totalProgress&&this._totalProgress.onAllComplete(e,t,this._preventRetries),this._options.callbacks.onAllComplete(qq.extend([],e),qq.extend([],t)),this._succeededSinceLastAllComplete=[],this._failedSinceLastAllComplete=[]},_onAutoRetry:function(e,t,n,i,r){var o=this;if(o._preventRetries[e]=n[o._options.retry.preventRetryResponseProperty],o._shouldAutoRetry(e,t,n))return o._maybeParseAndSendUploadError.apply(o,arguments),o._options.callbacks.onAutoRetry(e,t,o._autoRetries[e]),o._onBeforeAutoRetry(e,t),o._retryTimeouts[e]=setTimeout(function(){o.log("Retrying "+t+"..."),o._uploadData.setStatus(e,qq.status.UPLOAD_RETRYING),r?r(e):o._handler.retry(e)},1e3*o._options.retry.autoAttemptDelay),!0},_onBeforeAutoRetry:function(e,t){this.log("Waiting "+this._options.retry.autoAttemptDelay+" seconds before retrying "+t+"...")},_onBeforeManualRetry:function(e){var t=this._options.validation.itemLimit;if(this._preventRetries[e])return this.log("Retries are forbidden for id "+e,"warn"),!1;if(this._handler.isValid(e)){var n=this.getName(e);return!1!==this._options.callbacks.onManualRetry(e,n)&&(t>0&&this._netUploadedOrQueued+1>t?(this._itemError("retryFailTooManyItems"),!1):(this.log("Retrying upload for '"+n+"' (id: "+e+")..."),!0))}return this.log("'"+e+"' is not a valid file ID","error"),!1},_onCancel:function(e,t){this._netUploadedOrQueued--,clearTimeout(this._retryTimeouts[e]);var n=qq.indexOf(this._storedIds,e);!this._options.autoUpload&&n>=0&&this._storedIds.splice(n,1),this._uploadData.setStatus(e,qq.status.CANCELED)},_onComplete:function(e,t,n,i){return n.success?(n.thumbnailUrl&&(this._thumbnailUrls[e]=n.thumbnailUrl),this._netUploaded++,this._uploadData.setStatus(e,qq.status.UPLOAD_SUCCESSFUL)):(this._netUploadedOrQueued--,this._uploadData.setStatus(e,qq.status.UPLOAD_FAILED),!0===n[this._options.retry.preventRetryResponseProperty]&&(this._preventRetries[e]=!0)),this._maybeParseAndSendUploadError(e,t,n,i),!!n.success},_onDelete:function(e){this._uploadData.setStatus(e,qq.status.DELETING)},_onDeleteComplete:function(e,t,n){var i=this.getName(e);n?(this._uploadData.setStatus(e,qq.status.DELETE_FAILED),this.log("Delete request for '"+i+"' has failed.","error"),void 0===t.withCredentials?this._options.callbacks.onError(e,i,"Delete request failed",t):this._options.callbacks.onError(e,i,"Delete request failed with response code "+t.status,t)):(this._netUploadedOrQueued--,this._netUploaded--,this._handler.expunge(e),this._uploadData.setStatus(e,qq.status.DELETED),this.log("Delete request for '"+i+"' has succeeded."))},_onInputChange:function(e){var t;if(qq.supportedFeatures.ajaxUploading){for(t=0;t<e.files.length;t++)this._annotateWithButtonId(e.files[t],e);this.addFiles(e.files)}else e.value.length>0&&this.addFiles(e);qq.each(this._buttons,function(e,t){t.reset()})},_onProgress:function(e,t,n,i){this._totalProgress&&this._totalProgress.onIndividualProgress(e,n,i)},_onSubmit:function(e,t){},_onSubmitCallbackSuccess:function(e,t){this._onSubmit.apply(this,arguments),this._uploadData.setStatus(e,qq.status.SUBMITTED),this._onSubmitted.apply(this,arguments),this._options.callbacks.onSubmitted.apply(this,arguments),this._options.autoUpload?this._uploadFile(e):this._storeForLater(e)},_onSubmitDelete:function(e,t,n){var i,r=this.getUuid(e);return t&&(i=qq.bind(t,this,e,r,n)),this._isDeletePossible()?(this._handleCheckedCallback({name:"onSubmitDelete",callback:qq.bind(this._options.callbacks.onSubmitDelete,this,e),onSuccess:i||qq.bind(this._deleteHandler.sendDelete,this,e,r,n),identifier:e}),!0):(this.log("Delete request ignored for ID "+e+", delete feature is disabled or request not possible due to CORS on a user agent that does not support pre-flighting.","warn"),!1)},_onSubmitted:function(e){},_onTotalProgress:function(e,t){this._options.callbacks.onTotalProgress(e,t)},_onUploadPrep:function(e){},_onUpload:function(e,t){this._uploadData.setStatus(e,qq.status.UPLOADING)},_onUploadChunk:function(e,t){},_onUploadStatusChange:function(e,t,n){n===qq.status.PAUSED&&clearTimeout(this._retryTimeouts[e])},_onValidateBatchCallbackFailure:function(e){var t=this;qq.each(e,function(e,n){t._fileOrBlobRejected(n.id)})},_onValidateBatchCallbackSuccess:function(e,t,n,i,r){var o,s=this._options.validation.itemLimit,a=this._netUploadedOrQueued;0===s||a<=s?t.length>0?this._handleCheckedCallback({name:"onValidate",callback:qq.bind(this._options.callbacks.onValidate,this,e[0],r),onSuccess:qq.bind(this._onValidateCallbackSuccess,this,t,0,n,i),onFailure:qq.bind(this._onValidateCallbackFailure,this,t,0,n,i),identifier:"Item '"+t[0].file.name+"', size: "+t[0].file.size}):this._itemError("noFilesError"):(this._onValidateBatchCallbackFailure(t),o=this._options.messages.tooManyItemsError.replace(/\{netItems\}/g,a).replace(/\{itemLimit\}/g,s),this._batchError(o))},_onValidateCallbackFailure:function(e,t,n,i){var r=t+1;this._fileOrBlobRejected(e[0].id,e[0].file.name),this._maybeProcessNextItemAfterOnValidateCallback(!1,e,r,n,i)},_onValidateCallbackSuccess:function(e,t,n,i){var r=this,o=t+1,s=this._getValidationDescriptor(e[t]);this._validateFileOrBlobData(e[t],s).then(function(){r._upload(e[t].id,n,i),r._maybeProcessNextItemAfterOnValidateCallback(!0,e,o,n,i)},function(){r._maybeProcessNextItemAfterOnValidateCallback(!1,e,o,n,i)})},_prepareItemsForUpload:function(e,t,n){if(0!==e.length){var i=this._getValidationDescriptors(e),r=this._getButtonId(e[0].file),o=this._getButton(r);this._handleCheckedCallback({name:"onValidateBatch",callback:qq.bind(this._options.callbacks.onValidateBatch,this,i,o),onSuccess:qq.bind(this._onValidateBatchCallbackSuccess,this,i,e,t,n,o),onFailure:qq.bind(this._onValidateBatchCallbackFailure,this,e),identifier:"batch validation"})}else this._itemError("noFilesError")},_preventLeaveInProgress:function(){var e=this;this._disposeSupport.attach(window,"beforeunload",function(t){if(e.getInProgress())return(t=t||window.event).returnValue=e._options.messages.onLeave,e._options.messages.onLeave})},_refreshSessionData:function(){var e=this,t=this._options.session;qq.Session&&null!=this._options.session.endpoint&&(this._session||(qq.extend(t,this._options.cors),t.log=qq.bind(this.log,this),t.addFileRecord=qq.bind(this._addCannedFile,this),this._session=new qq.Session(t)),setTimeout(function(){e._session.refresh().then(function(t,n){e._options.callbacks.onSessionRequestComplete(t,!0,n)},function(t,n){e._options.callbacks.onSessionRequestComplete(t,!1,n)})},0))},_setSize:function(e,t){this._uploadData.updateSize(e,t),this._totalProgress&&this._totalProgress.onNewSize(e)},_shouldAutoRetry:function(e,t,n){var i=this._uploadData.retrieve({id:e});return!!(!this._preventRetries[e]&&this._options.retry.enableAuto&&i.status!==qq.status.PAUSED&&(void 0===this._autoRetries[e]&&(this._autoRetries[e]=0),this._autoRetries[e]<this._options.retry.maxAutoAttempts))&&(this._autoRetries[e]+=1,!0)},_storeForLater:function(e){this._storedIds.push(e)},_trackButton:function(e){var t;(t=qq.supportedFeatures.ajaxUploading?this._handler.getFile(e).qqButtonId:this._getButtonId(this._handler.getInput(e)))&&(this._buttonIdsForFileIds[e]=t)},_upload:function(e,t,n){var i=this.getName(e);t&&this.setParams(t,e),n&&this.setEndpoint(n,e),this._handleCheckedCallback({name:"onSubmit",callback:qq.bind(this._options.callbacks.onSubmit,this,e,i),onSuccess:qq.bind(this._onSubmitCallbackSuccess,this,e,i),onFailure:qq.bind(this._fileOrBlobRejected,this,e,i),identifier:e})},_uploadFile:function(e){this._handler.upload(e)||this._uploadData.setStatus(e,qq.status.QUEUED)},_validateFileOrBlobData:function(e,t){var n=this,i=e.file instanceof qq.BlobProxy?e.file.referenceBlob:e.file,r=t.name,o=t.size,s=this._getButtonId(e.file),a=this._getValidationBase(s),u=new qq.Promise;return u.then(function(){},function(){n._fileOrBlobRejected(e.id,r)}),qq.isFileOrInput(i)&&!this._isAllowedExtension(a.allowedExtensions,r)?(this._itemError("typeError",r,i),u.failure()):0===o?(this._itemError("emptyError",r,i),u.failure()):o>0&&a.sizeLimit&&o>a.sizeLimit?(this._itemError("sizeError",r,i),u.failure()):o>0&&o<a.minSizeLimit?(this._itemError("minSizeError",r,i),u.failure()):(qq.ImageValidation&&qq.supportedFeatures.imagePreviews&&qq.isFile(i)?new qq.ImageValidation(i,qq.bind(n.log,n)).validate(a.image).then(u.success,function(e){n._itemError(e+"ImageError",r,i),u.failure()}):u.success(),u)},_wrapCallbacks:function(){var e,t;for(var n in e=this,t=function(t,n,i){var r;try{return n.apply(e,i)}catch(n){r=n.message||n.toString(),e.log("Caught exception in '"+t+"' callback - "+r,"error")}},this._options.callbacks)!function(){var i,r;i=n,r=e._options.callbacks[i],e._options.callbacks[i]=function(){return t(i,r,arguments)}}()}}}(),function(){"use strict";qq.FineUploaderBasic=function(e){var t=this;this._options={debug:!1,button:null,multiple:!0,maxConnections:3,disableCancelForFormUploads:!1,autoUpload:!0,request:{endpoint:"/server/upload",params:{},paramsInBody:!0,customHeaders:{},forceMultipart:!0,inputName:"qqfile",uuidName:"qquuid",totalFileSizeName:"qqtotalfilesize",filenameParam:"qqfilename"},validation:{allowedExtensions:[],sizeLimit:0,minSizeLimit:0,itemLimit:0,stopOnFirstInvalidFile:!0,acceptFiles:null,image:{maxHeight:0,maxWidth:0,minHeight:0,minWidth:0}},callbacks:{onSubmit:function(e,t){},onSubmitted:function(e,t){},onComplete:function(e,t,n,i){},onAllComplete:function(e,t){},onCancel:function(e,t){},onUpload:function(e,t){},onUploadChunk:function(e,t,n){},onUploadChunkSuccess:function(e,t,n,i){},onResume:function(e,t,n){},onProgress:function(e,t,n,i){},onTotalProgress:function(e,t){},onError:function(e,t,n,i){},onAutoRetry:function(e,t,n){},onManualRetry:function(e,t){},onValidateBatch:function(e){},onValidate:function(e){},onSubmitDelete:function(e){},onDelete:function(e){},onDeleteComplete:function(e,t,n){},onPasteReceived:function(e){},onStatusChange:function(e,t,n){},onSessionRequestComplete:function(e,t,n){}},messages:{typeError:"{file} has an invalid extension. Valid extension(s): {extensions}.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",minSizeError:"{file} is too small, minimum file size is {minSizeLimit}.",emptyError:"{file} is empty, please select files again without it.",noFilesError:"No files to upload.",tooManyItemsError:"Too many items ({netItems}) would be uploaded.  Item limit is {itemLimit}.",maxHeightImageError:"Image is too tall.",maxWidthImageError:"Image is too wide.",minHeightImageError:"Image is not tall enough.",minWidthImageError:"Image is not wide enough.",retryFailTooManyItems:"Retry failed - you have reached your file limit.",onLeave:"The files are being uploaded, if you leave now the upload will be canceled."},retry:{enableAuto:!1,maxAutoAttempts:3,autoAttemptDelay:5,preventRetryResponseProperty:"preventRetry"},classes:{buttonHover:"qq-upload-button-hover",buttonFocus:"qq-upload-button-focus"},chunking:{enabled:!1,concurrent:{enabled:!1},paramNames:{partIndex:"qqpartindex",partByteOffset:"qqpartbyteoffset",chunkSize:"qqchunksize",totalFileSize:"qqtotalfilesize",totalParts:"qqtotalparts"},partSize:2e6,success:{endpoint:null}},resume:{enabled:!1,recordsExpireIn:7,paramNames:{resuming:"qqresume"}},formatFileName:function(e){return void 0!==e&&e.length>33&&(e=e.slice(0,19)+"..."+e.slice(-14)),e},text:{defaultResponseError:"Upload failure reason unknown",sizeSymbols:["kB","MB","GB","TB","PB","EB"]},deleteFile:{enabled:!1,method:"DELETE",endpoint:"/server/upload",customHeaders:{},params:{}},cors:{expected:!1,sendCredentials:!1,allowXdr:!1},blobs:{defaultName:"misc_data"},paste:{targetElement:null,defaultName:"pasted_image"},camera:{ios:!1,button:null},extraButtons:[],session:{endpoint:null,params:{},customHeaders:{},refreshOnReset:!0},form:{element:"qq-form",autoUpload:!1,interceptSubmit:!0},scaling:{sendOriginal:!0,orient:!0,defaultType:null,defaultQuality:80,failureText:"Failed to scale",includeExif:!1,sizes:[]}},qq.extend(this._options,e,!0),this._buttons=[],this._extraButtonSpecs={},this._buttonIdsForFileIds=[],this._wrapCallbacks(),this._disposeSupport=new qq.DisposeSupport,this._storedIds=[],this._autoRetries=[],this._retryTimeouts=[],this._preventRetries=[],this._thumbnailUrls=[],this._netUploadedOrQueued=0,this._netUploaded=0,this._uploadData=this._createUploadDataTracker(),this._initFormSupportAndParams(),this._customHeadersStore=this._createStore(this._options.request.customHeaders),this._deleteFileCustomHeadersStore=this._createStore(this._options.deleteFile.customHeaders),this._deleteFileParamsStore=this._createStore(this._options.deleteFile.params),this._endpointStore=this._createStore(this._options.request.endpoint),this._deleteFileEndpointStore=this._createStore(this._options.deleteFile.endpoint),this._handler=this._createUploadHandler(),this._deleteHandler=qq.DeleteFileAjaxRequester&&this._createDeleteHandler(),this._options.button&&(this._defaultButtonId=this._createUploadButton({element:this._options.button}).getButtonId()),this._generateExtraButtonSpecs(),this._handleCameraAccess(),this._options.paste.targetElement&&(qq.PasteSupport?this._pasteHandler=this._createPasteHandler():this.log("Paste support module not found","error")),this._preventLeaveInProgress(),this._imageGenerator=qq.ImageGenerator&&new qq.ImageGenerator(qq.bind(this.log,this)),this._refreshSessionData(),this._succeededSinceLastAllComplete=[],this._failedSinceLastAllComplete=[],this._scaler=qq.Scaler&&new qq.Scaler(this._options.scaling,qq.bind(this.log,this))||{},this._scaler.enabled&&(this._customNewFileHandler=qq.bind(this._scaler.handleNewFile,this._scaler)),qq.TotalProgress&&qq.supportedFeatures.progressBar&&(this._totalProgress=new qq.TotalProgress(qq.bind(this._onTotalProgress,this),function(e){var n=t._uploadData.retrieve({id:e});return n&&n.size||0}))},qq.FineUploaderBasic.prototype=qq.basePublicApi,qq.extend(qq.FineUploaderBasic.prototype,qq.basePrivateApi)}(),qq.AjaxRequester=function(e){"use strict";var t,n,i=[],r={},o={acceptHeader:null,validMethods:["POST"],method:"POST",contentType:"application/x-www-form-urlencoded",maxConnections:3,customHeaders:{},endpointStore:{},paramsStore:{},mandatedParams:{},allowXRequestedWithAndCacheControl:!0,successfulResponseCodes:{DELETE:[200,202,204],POST:[200,204],GET:[200]},cors:{expected:!1,sendCredentials:!1},log:function(e,t){},onSend:function(e){},onComplete:function(e,t,n){},onProgress:null};if(qq.extend(o,e),t=o.log,qq.indexOf(o.validMethods,o.method)<0)throw new Error("'"+o.method+"' is not a supported method for this type of request!");function s(e){return o.cors.expected&&void 0===e.withCredentials}function a(e,t){var n=r[e].xhr;return n||(n=t||(o.cors.expected?function(){var e;return(window.XMLHttpRequest||window.ActiveXObject)&&void 0===(e=qq.createXhrInstance()).withCredentials&&(e=new XDomainRequest),e}():qq.createXhrInstance()),r[e].xhr=n),n}function u(e){var t=qq.indexOf(i,e),n=o.maxConnections;delete r[e],i.splice(t,1),i.length>=n&&t<n&&c(i[n-1])}function l(e,n){var i,r=a(e),l=o.method,c=!0===n;u(e),c?t(l+" request for "+e+" has failed","error"):s(r)||(i=r.status,qq.indexOf(o.successfulResponseCodes[o.method],i)>=0)||(c=!0,t(l+" request for "+e+" has failed - response code "+r.status,"error")),o.onComplete(e,r,c)}function c(e,i){var u,c=a(e,i),d=o.method,p=function(e){var t,n=r[e].additionalParams,i=o.mandatedParams;return o.paramsStore.get&&(t=o.paramsStore.get(e)),n&&qq.each(n,function(e,n){(t=t||{})[e]=n}),i&&qq.each(i,function(e,n){(t=t||{})[e]=n}),t}(e),h=r[e].payload;return o.onSend(e),u=function(e,t){var i=o.endpointStore.get(e),s=r[e].addToPath;null!=s&&(i+="/"+s);return n&&t?qq.obj2url(t,i):i}(e,p),s(c)?(c.onload=function(e){return function(){l(e)}}(e),c.onerror=function(e){return function(){l(e,!0)}}(e)):c.onreadystatechange=function(e){return function(){4===a(e).readyState&&l(e)}}(e),function(e){var t=o.onProgress;t&&(a(e).upload.onprogress=function(n){n.lengthComputable&&t(e,n.loaded,n.total)})}(e),c.open(d,u,!0),o.cors.expected&&o.cors.sendCredentials&&!s(c)&&(c.withCredentials=!0),function(e){var t=a(e),n=o.customHeaders,i=r[e].additionalHeaders||{},u=o.method,l={};s(t)||(o.acceptHeader&&t.setRequestHeader("Accept",o.acceptHeader),o.allowXRequestedWithAndCacheControl&&(o.cors.expected&&qq.indexOf(["GET","POST","HEAD"],o.method)>=0&&(c=!1,qq.each(c,function(e,t){if(qq.indexOf(["Accept","Accept-Language","Content-Language","Content-Type"],t)<0)return c=!0,!1}),!c)||(t.setRequestHeader("X-Requested-With","XMLHttpRequest"),t.setRequestHeader("Cache-Control","no-cache"))),!o.contentType||"POST"!==u&&"PUT"!==u||t.setRequestHeader("Content-Type",o.contentType),qq.extend(l,qq.isFunction(n)?n(e):n),qq.extend(l,i),qq.each(l,function(e,n){t.setRequestHeader(e,n)}));var c}(e),t("Sending "+d+" request for "+e),h?c.send(h):n||!p?c.send():p&&o.contentType&&o.contentType.toLowerCase().indexOf("application/x-www-form-urlencoded")>=0?c.send(qq.obj2url(p,"")):p&&o.contentType&&o.contentType.toLowerCase().indexOf("application/json")>=0?c.send(JSON.stringify(p)):c.send(p),c}n="GET"===o.method||"DELETE"===o.method,qq.extend(this,{initTransport:function(e){var t,n,s,a,u;return{withPath:function(e){return t=e,this},withParams:function(e){return n=e,this},withHeaders:function(e){return s=e,this},withPayload:function(e){return a=e,this},withCacheBuster:function(){return u=!0,this},send:function(l){return u&&qq.indexOf(["GET","DELETE"],o.method)>=0&&(n.qqtimestamp=(new Date).getTime()),function(e,t,n,s,a,u){if(r[e]={addToPath:n,additionalParams:s,additionalHeaders:a,payload:u},i.push(e)<=o.maxConnections)return c(e,t)}(e,l,t,n,s,a)}}},canceled:function(e){u(e)}})},qq.UploadHandler=function(e){"use strict";var t=e.proxy,n={},i=t.onCancel,r=t.getName;qq.extend(this,{add:function(e,t){n[e]=t,n[e].temp={}},cancel:function(e){var t=this,o=new qq.Promise;i(e,r(e),o).then(function(){t.isValid(e)&&(n[e].canceled=!0,t.expunge(e)),o.success()})},expunge:function(e){delete n[e]},getThirdPartyFileId:function(e){return n[e].key},isValid:function(e){return void 0!==n[e]},reset:function(){n={}},_getFileState:function(e){return n[e]},_setThirdPartyFileId:function(e,t){n[e].key=t},_wasCanceled:function(e){return!!n[e].canceled}})},qq.UploadHandlerController=function(e,t){"use strict";var n,i,r,o,s=this,a=!1,u=!1,l={paramsStore:{},maxConnections:3,chunking:{enabled:!1,multiple:{enabled:!1}},log:function(e,t){},onProgress:function(e,t,n,i){},onComplete:function(e,t,n,i){},onCancel:function(e,t){},onUploadPrep:function(e){},onUpload:function(e,t){},onUploadChunk:function(e,t,n){},onUploadChunkSuccess:function(e,t,n,i){},onAutoRetry:function(e,t,n,i){},onResume:function(e,t,n){},onUuidChanged:function(e,t){},getName:function(e){},setSize:function(e,t){},isQueued:function(e){},getIdsInProxyGroup:function(e){},getIdsInBatch:function(e){}},c={done:function(e,t,n,i){var o=r._getChunkData(e,t);r._getFileState(e).attemptingResume=!1,delete r._getFileState(e).temp.chunkProgress[t],r._getFileState(e).loaded+=o.size,l.onUploadChunkSuccess(e,r._getChunkDataForCallback(o),n,i)},finalize:function(e){var t=l.getSize(e),n=l.getName(e);i("All chunks have been uploaded for "+e+" - finalizing...."),r.finalizeChunks(e).then(function(o,s){i("Finalize successful for "+e);var a=h.normalizeResponse(o,!0);l.onProgress(e,n,t,t),r._maybeDeletePersistedChunkData(e),h.cleanup(e,a,s)},function(t,r){var o=h.normalizeResponse(t,!1);i("Problem finalizing chunks for file ID "+e+" - "+o.error,"error"),o.reset&&c.reset(e),l.onAutoRetry(e,n,o,r)||h.cleanup(e,o,r)})},hasMoreParts:function(e){return!!r._getFileState(e).chunking.remaining.length},nextPart:function(e){var t=r._getFileState(e).chunking.remaining.shift();return t>=r._getTotalChunks(e)&&(t=null),t},reset:function(e){i("Server or callback has ordered chunking effort to be restarted on next attempt for item ID "+e,"error"),r._maybeDeletePersistedChunkData(e),r.reevaluateChunking(e),r._getFileState(e).loaded=0},sendNext:function(e){var t=l.getSize(e),n=l.getName(e),o=c.nextPart(e),s=r._getChunkData(e,o),a=r._getFileState(e).attemptingResume,p=r._getFileState(e).chunking.inProgress||[];null==r._getFileState(e).loaded&&(r._getFileState(e).loaded=0),a&&!1===l.onResume(e,n,s)&&(c.reset(e),o=c.nextPart(e),s=r._getChunkData(e,o),a=!1),null==o&&0===p.length?c.finalize(e):(i("Sending chunked upload request for item "+e+": bytes "+(s.start+1)+"-"+s.end+" of "+t),l.onUploadChunk(e,n,r._getChunkDataForCallback(s)),p.push(o),r._getFileState(e).chunking.inProgress=p,u&&d.open(e,o),u&&d.available()&&r._getFileState(e).chunking.remaining.length&&c.sendNext(e),r.uploadChunk(e,o,a).then(function(t,n){i("Chunked upload request succeeded for "+e+", chunk "+o),r.clearCachedChunk(e,o);var s=r._getFileState(e).chunking.inProgress||[],a=h.normalizeResponse(t,!0),u=qq.indexOf(s,o);i(qq.format("Chunk {} for file {} uploaded successfully.",o,e)),c.done(e,o,a,n),u>=0&&s.splice(u,1),r._maybePersistChunkedState(e),c.hasMoreParts(e)||0!==s.length?c.hasMoreParts(e)&&c.sendNext(e):c.finalize(e)},function(t,s){i("Chunked upload request failed for "+e+", chunk "+o),r.clearCachedChunk(e,o);var a=h.normalizeResponse(t,!1);if(a.reset)c.reset(e);else{var p=qq.indexOf(r._getFileState(e).chunking.inProgress,o);p>=0&&(r._getFileState(e).chunking.inProgress.splice(p,1),r._getFileState(e).chunking.remaining.unshift(o))}r._getFileState(e).temp.ignoreFailure||(u&&(r._getFileState(e).temp.ignoreFailure=!0,qq.each(r._getXhrs(e),function(e,t){t.abort()}),r.moveInProgressToRemaining(e),d.free(e,!0)),l.onAutoRetry(e,n,a,s)||h.cleanup(e,a,s))}).done(function(){r.clearXhr(e,o)}))}},d={_open:[],_openChunks:{},_waiting:[],available:function(){var e=l.maxConnections,t=0,n=0;return qq.each(d._openChunks,function(e,i){t++,n+=i.length}),e-(d._open.length-t+n)},free:function(e,t){var n,o=!t,s=qq.indexOf(d._waiting,e),a=qq.indexOf(d._open,e);delete d._openChunks[e],h.getProxyOrBlob(e)instanceof qq.BlobProxy&&(i("Generated blob upload has ended for "+e+", disposing generated blob."),delete r._getFileState(e).file),s>=0?d._waiting.splice(s,1):o&&a>=0&&(d._open.splice(a,1),(n=d._waiting.shift())>=0&&(d._open.push(n),h.start(n)))},getWaitingOrConnected:function(){var e=[];return qq.each(e,d._open),qq.each(e,d._waiting)},isUsingConnection:function(e){return qq.indexOf(d._open,e)>=0},open:function(e,t){return null==t&&d._waiting.push(e),!!d.available()&&(null==t?(d._waiting.pop(),d._open.push(e)):((n=d._openChunks[e]||[]).push(t),d._openChunks[e]=n),!0);var n},reset:function(){d._waiting=[],d._open=[]}},p=function(e,t){r._getFileState(e).loaded=0,i("Sending simple upload request for "+e),r.uploadFile(e).then(function(n,r){i("Simple upload request succeeded for "+e);var o=h.normalizeResponse(n,!0),s=l.getSize(e);l.onProgress(e,t,s,s),h.maybeNewUuid(e,o),h.cleanup(e,o,r)},function(n,r){i("Simple upload request failed for "+e);var o=h.normalizeResponse(n,!1);l.onAutoRetry(e,t,o,r)||h.cleanup(e,o,r)})},h={cancel:function(e){i("Cancelling "+e),l.paramsStore.remove(e),d.free(e)},cleanup:function(e,t,n){var i=l.getName(e);l.onComplete(e,i,t,n),r._getFileState(e)&&r._clearXhrs&&r._clearXhrs(e),d.free(e)},getProxyOrBlob:function(e){return r.getProxy&&r.getProxy(e)||r.getFile&&r.getFile(e)},initHandler:function(){var e=t?qq[t]:qq.traditional,n=qq.supportedFeatures.ajaxUploading?"Xhr":"Form";(r=new e[n+"UploadHandler"](l,{getDataByUuid:l.getDataByUuid,getName:l.getName,getSize:l.getSize,getUuid:l.getUuid,log:i,onCancel:l.onCancel,onProgress:l.onProgress,onUuidChanged:l.onUuidChanged}))._removeExpiredChunkingRecords&&r._removeExpiredChunkingRecords()},isDeferredEligibleForUpload:function(e){return l.isQueued(e)},maybeDefer:function(e,t){return t&&!r.getFile(e)&&t instanceof qq.BlobProxy?(l.onUploadPrep(e),i("Attempting to generate a blob on-demand for "+e),t.create().then(function(t){i("Generated an on-demand blob for "+e),r.updateBlob(e,t),l.setSize(e,t.size),r.reevaluateChunking(e),h.maybeSendDeferredFiles(e)},function(t){var r={};t&&(r.error=t),i(qq.format("Failed to generate blob for ID {}.  Error message: {}.",e,t),"error"),l.onComplete(e,l.getName(e),qq.extend(r,n),null),h.maybeSendDeferredFiles(e),d.free(e)}),!1):h.maybeSendDeferredFiles(e)},maybeSendDeferredFiles:function(e){var t=l.getIdsInProxyGroup(e),n=!1;return t&&t.length?(i("Maybe ready to upload proxy group file "+e),qq.each(t,function(t,i){if(h.isDeferredEligibleForUpload(i)&&r.getFile(i))n=i===e,h.now(i);else if(h.isDeferredEligibleForUpload(i))return!1})):(n=!0,h.now(e)),n},maybeNewUuid:function(e,t){void 0!==t.newUuid&&l.onUuidChanged(e,t.newUuid)},normalizeResponse:function(e,t){var n=e;return qq.isObject(e)||(n={},qq.isString(e)&&!t&&(n.error=e)),n.success=t,n},now:function(e){var t=l.getName(e);if(!s.isValid(e))throw new qq.Error(e+" is not a valid file ID to upload!");l.onUpload(e,t),a&&r._shouldChunkThisFile(e)?c.sendNext(e):p(e,t)},start:function(e){var t=h.getProxyOrBlob(e);return t?h.maybeDefer(e,t):(h.now(e),!0)}};qq.extend(this,{add:function(e,t){r.add.apply(this,arguments)},upload:function(e){return!!d.open(e)&&h.start(e)},retry:function(e){return u&&(r._getFileState(e).temp.ignoreFailure=!1),d.isUsingConnection(e)?h.start(e):s.upload(e)},cancel:function(e){var t=r.cancel(e);qq.isGenericPromise(t)?t.then(function(){h.cancel(e)}):!1!==t&&h.cancel(e)},cancelAll:function(){var e=d.getWaitingOrConnected();qq.each(e,function(e,t){s.cancel(t)}),d.reset()},getFile:function(e){return r.getProxy&&r.getProxy(e)?r.getProxy(e).referenceBlob:r.getFile&&r.getFile(e)},isProxied:function(e){return!(!r.getProxy||!r.getProxy(e))},getInput:function(e){if(r.getInput)return r.getInput(e)},reset:function(){i("Resetting upload handler"),s.cancelAll(),d.reset(),r.reset()},expunge:function(e){if(s.isValid(e))return r.expunge(e)},isValid:function(e){return r.isValid(e)},getResumableFilesData:function(){return r.getResumableFilesData?r.getResumableFilesData():[]},getThirdPartyFileId:function(e){if(s.isValid(e))return r.getThirdPartyFileId(e)},pause:function(e){return!!(s.isResumable(e)&&r.pause&&s.isValid(e)&&r.pause(e))&&(d.free(e),r.moveInProgressToRemaining(e),!0)},isResumable:function(e){return!!r.isResumable&&r.isResumable(e)}}),qq.extend(l,e),i=l.log,a=l.chunking.enabled&&qq.supportedFeatures.chunking,u=a&&l.chunking.concurrent.enabled,(o={})[l.preventRetryParam]=!0,n=o,h.initHandler()},qq.FormUploadHandler=function(e){"use strict";var t=e.options,n=this,i=e.proxy,r=qq.getUniqueId(),o={},s={},a={},u=t.isCors,l=t.inputName,c=i.getUuid,d=i.log,p=new qq.WindowReceiveMessage({log:d});function h(e){return e.split("_")[0]}qq.extend(this,new qq.UploadHandler(e)),qq.override(this,function(e){return{add:function(t,n){e.add(t,{input:n}),n.setAttribute("name",l),n.parentNode&&qq(n).remove()},expunge:function(t){!function(e){delete s[e],u&&(clearTimeout(a[e]),delete a[e],p.stopReceivingMessages(e));var t=document.getElementById(n._getIframeName(e));t&&(t.setAttribute("src","javascript:false;"),qq(t).remove())}(t),e.expunge(t)},isValid:function(t){return e.isValid(t)&&void 0!==n._getFileState(t).input}}}),qq.extend(this,{_attachLoadEvent:function(e,t){var i;u?function(e,t){var i=e.id,r=h(i),u=c(r);o[u]=t,s[r]=qq(e).attach("load",function(){n.getInput(r)&&(d("Received iframe load event for CORS upload request (iframe name "+i+")"),a[i]=setTimeout(function(){var e="No valid message received from loaded iframe for iframe name "+i;d(e,"error"),t({error:e})},1e3))}),p.receiveMessage(i,function(e){d("Received the following window message: '"+e+"'");var t,r=h(i),s=n._parseJsonResponse(r,e),u=s.uuid;u&&o[u]?(d("Handling response for iframe name "+i),clearTimeout(a[i]),delete a[i],n._detachLoadEvent(i),t=o[u],delete o[u],p.stopReceivingMessages(i),t(s)):u||d("'"+e+"' does not contain a UUID - ignoring.")})}(e,t):s[e.id]=qq(e).attach("load",function(){if(d("Received response for "+e.id),e.parentNode){try{if(e.contentDocument&&e.contentDocument.body&&"false"==e.contentDocument.body.innerHTML)return}catch(e){d("Error when attempting to access iframe during handling of upload response ("+e.message+")","error"),i={success:!1}}t(i)}})},_createIframe:function(e){var t,i,r=n._getIframeName(e);return t=r,(i=qq.toElement("<iframe src='javascript:false;' name='"+t+"' />")).setAttribute("id",t),i.style.display="none",document.body.appendChild(i),i},_detachLoadEvent:function(e){void 0!==s[e]&&(s[e](),delete s[e])},_getIframeName:function(e){return e+"_"+r},getInput:function(e){return n._getFileState(e).input},_initFormForUpload:function(e){var t=e.method,n=e.endpoint,i=e.params,r=e.paramsInBody,o=e.targetName,s=qq.toElement("<form method='"+t+"' enctype='multipart/form-data'></form>"),a=n;return r?qq.obj2Inputs(i,s):a=qq.obj2url(i,n),s.setAttribute("action",a),s.setAttribute("target",o),s.style.display="none",document.body.appendChild(s),s}})},qq.XhrUploadHandler=function(e){"use strict";var t=this,n=e.options.namespace,i=e.proxy,r=e.options.chunking,o=e.options.resume,s=r&&e.options.chunking.enabled&&qq.supportedFeatures.chunking,a=o&&e.options.resume.enabled&&s&&qq.supportedFeatures.resume,u=i.getName,l=i.getSize,c=i.getUuid,d=i.getEndpoint,p=i.getDataByUuid,h=i.onUuidChanged,f=i.onProgress,q=i.log;function g(e){qq.each(t._getXhrs(e),function(n,i){var r=t._getAjaxRequester(e,n);i.onreadystatechange=null,i.upload.onprogress=null,i.abort(),r&&r.canceled&&r.canceled(e)})}qq.extend(this,new qq.UploadHandler(e)),qq.override(this,function(e){return{add:function(n,i){if(qq.isFile(i)||qq.isBlob(i))e.add(n,{file:i});else{if(!(i instanceof qq.BlobProxy))throw new Error("Passed obj is not a File, Blob, or proxy");e.add(n,{proxy:i})}t._initTempState(n),a&&t._maybePrepareForResume(n)},expunge:function(n){g(n),t._maybeDeletePersistedChunkData(n),t._clearXhrs(n),e.expunge(n)}}}),qq.extend(this,{clearCachedChunk:function(e,n){delete t._getFileState(e).temp.cachedChunks[n]},clearXhr:function(e,n){var i=t._getFileState(e).temp;i.xhrs&&delete i.xhrs[n],i.ajaxRequesters&&delete i.ajaxRequesters[n]},finalizeChunks:function(e,n){var i=t._getTotalChunks(e)-1,r=t._getXhr(e,i);return n?(new qq.Promise).success(n(r),r):(new qq.Promise).success({},r)},getFile:function(e){return t.isValid(e)&&t._getFileState(e).file},getProxy:function(e){return t.isValid(e)&&t._getFileState(e).proxy},getResumableFilesData:function(){var e=[];return t._iterateResumeRecords(function(n,i){t.moveInProgressToRemaining(null,i.chunking.inProgress,i.chunking.remaining);var r={name:i.name,remaining:i.chunking.remaining,size:i.size,uuid:i.uuid};i.key&&(r.key=i.key),e.push(r)}),e},isResumable:function(e){return!!r&&t.isValid(e)&&!t._getFileState(e).notResumable},moveInProgressToRemaining:function(e,n,i){var r=n||t._getFileState(e).chunking.inProgress,o=i||t._getFileState(e).chunking.remaining;r&&(r.reverse(),qq.each(r,function(e,t){o.unshift(t)}),r.length=0)},pause:function(e){if(t.isValid(e))return q(qq.format("Aborting XHR upload for {} '{}' due to pause instruction.",e,u(e))),t._getFileState(e).paused=!0,g(e),!0},reevaluateChunking:function(e){if(r&&t.isValid(e)){var n,i=t._getFileState(e);if(delete i.chunking,i.chunking={},(n=t._getTotalChunks(e))>1){i.chunking.enabled=!0,i.chunking.parts=n,i.chunking.remaining=[];for(var o=0;o<n;o++)i.chunking.remaining.push(o);t._initTempState(e)}else i.chunking.enabled=!1}},updateBlob:function(e,n){t.isValid(e)&&(t._getFileState(e).file=n)},_clearXhrs:function(e){var n=t._getFileState(e).temp;qq.each(n.ajaxRequesters,function(e){delete n.ajaxRequesters[e]}),qq.each(n.xhrs,function(e){delete n.xhrs[e]})},_createXhr:function(e,n){return t._registerXhr(e,n,qq.createXhrInstance())},_getAjaxRequester:function(e,n){var i=null==n?-1:n;return t._getFileState(e).temp.ajaxRequesters[i]},_getChunkData:function(e,n){var i=r.partSize,o=l(e),s=t.getFile(e),a=i*n,u=a+i>=o?o:a+i,c=t._getTotalChunks(e),d=this._getFileState(e).temp.cachedChunks,p=d[n]||qq.sliceBlob(s,a,u);return d[n]=p,{part:n,start:a,end:u,count:c,blob:p,size:u-a}},_getChunkDataForCallback:function(e){return{partIndex:e.part,startByte:e.start+1,endByte:e.end,totalParts:e.count}},_getLocalStorageId:function(e){var t=u(e),i=l(e),o=r.partSize,s=d(e);return qq.format("qq{}resume{}-{}-{}-{}-{}",n,"5.0",t,i,o,s)},_getMimeType:function(e){return t.getFile(e).type},_getPersistableData:function(e){return t._getFileState(e).chunking},_getTotalChunks:function(e){if(r){var t=l(e),n=r.partSize;return Math.ceil(t/n)}},_getXhr:function(e,n){var i=null==n?-1:n;return t._getFileState(e).temp.xhrs[i]},_getXhrs:function(e){return t._getFileState(e).temp.xhrs},_iterateResumeRecords:function(e){a&&qq.each(localStorage,function(t,i){if(0===t.indexOf(qq.format("qq{}resume-",n))){var r=JSON.parse(i);e(t,r)}})},_initTempState:function(e){t._getFileState(e).temp={ajaxRequesters:{},chunkProgress:{},xhrs:{},cachedChunks:{}}},_markNotResumable:function(e){t._getFileState(e).notResumable=!0},_maybeDeletePersistedChunkData:function(e){var n;return!!(a&&t.isResumable(e)&&(n=t._getLocalStorageId(e))&&localStorage.getItem(n))&&(localStorage.removeItem(n),!0)},_maybePrepareForResume:function(e){var n,i,r=t._getFileState(e);a&&void 0===r.key&&(n=t._getLocalStorageId(e),(i=localStorage.getItem(n))&&(i=JSON.parse(i),p(i.uuid)?t._markNotResumable(e):(q(qq.format("Identified file with ID {} and name of {} as resumable.",e,u(e))),h(e,i.uuid),r.key=i.key,r.chunking=i.chunking,r.loaded=i.loaded,r.attemptingResume=!0,t.moveInProgressToRemaining(e))))},_maybePersistChunkedState:function(e){var n,i,r=t._getFileState(e);a&&t.isResumable(e)&&(n=t._getLocalStorageId(e),i={name:u(e),size:l(e),uuid:c(e),key:r.key,chunking:r.chunking,loaded:r.loaded,lastUpdated:Date.now()},localStorage.setItem(n,JSON.stringify(i)))},_registerProgressHandler:function(e,n,i){var r=t._getXhr(e,n),o={simple:function(t,n){var i=l(e);f(e,name,t===n?i:t>=i?i-1:t,i)},chunked:function(r,o){var s=t._getFileState(e).temp.chunkProgress,a=t._getFileState(e).loaded,u=r,c=o,d=l(e),p=u-(c-i),h=a;s[n]=p,qq.each(s,function(e,t){h+=t}),f(e,name,h,d)}};r.upload.onprogress=function(e){e.lengthComputable&&o[null==i?"simple":"chunked"](e.loaded,e.total)}},_registerXhr:function(e,n,i,r){var o=null==n?-1:n,s=t._getFileState(e).temp;return s.xhrs=s.xhrs||{},s.ajaxRequesters=s.ajaxRequesters||{},s.xhrs[o]=i,r&&(s.ajaxRequesters[o]=r),i},_removeExpiredChunkingRecords:function(){var e=o.recordsExpireIn;t._iterateResumeRecords(function(t,n){var i=new Date(n.lastUpdated);i.setDate(i.getDate()+e),i.getTime()<=Date.now()&&(q("Removing expired resume record with key "+t),localStorage.removeItem(t))})},_shouldChunkThisFile:function(e){var n=t._getFileState(e);return n.chunking||t.reevaluateChunking(e),n.chunking.enabled}})},qq.WindowReceiveMessage=function(e){"use strict";var t={};qq.extend({log:function(e,t){}},e),qq.extend(this,{receiveMessage:function(e,n){window.postMessage?t[e]=qq(window).attach("message",function(e){n(e.data)}):log("iframe message passing not supported in this browser!","error")},stopReceivingMessages:function(e){if(window.postMessage){var n=t[e];n&&n()}}})},qq.traditional=qq.traditional||{},qq.traditional.FormUploadHandler=function(e,t){"use strict";var n=this,i=t.getName,r=t.getUuid,o=t.log;function s(e,t){var n;try{var i=t.contentDocument||t.contentWindow.document,r=i.body.innerHTML;o("converting iframe's innerHTML to JSON"),o("innerHTML = "+r),r&&r.match(/^<pre/i)&&(r=i.body.firstChild.firstChild.nodeValue),n=function(e){var t={};try{t=qq.parseJson(e)}catch(e){o("Error when attempting to parse iframe upload response ("+e.message+")","error")}return t}(r)}catch(e){o("Error when attempting to parse form upload response ("+e.message+")","error"),n={success:!1}}return n}this.uploadFile=function(t){var a,u=n.getInput(t),l=n._createIframe(t),c=new qq.Promise;return(a=function(t,o){var s=e.paramsStore.get(t),a=e.demoMode?"GET":"POST",u=e.endpointStore.get(t),l=i(t);return s[e.uuidName]=r(t),s[e.filenameParam]=l,n._initFormForUpload({method:a,endpoint:u,params:s,paramsInBody:e.paramsInBody,targetName:o.name})}(t,l)).appendChild(u),n._attachLoadEvent(l,function(i){o("iframe loaded");var r=i||s(0,l);n._detachLoadEvent(t),e.cors.expected||qq(l).remove(),r.success?c.success(r):c.failure(r)}),o("Sending upload request for "+t),a.submit(),qq(a).remove(),c},qq.extend(this,new qq.FormUploadHandler({options:{isCors:e.cors.expected,inputName:e.inputName},proxy:{onCancel:e.onCancel,getName:i,getUuid:r,log:o}}))},qq.traditional=qq.traditional||{},qq.traditional.XhrUploadHandler=function(e,t){"use strict";var n=this,i=t.getName,r=t.getSize,o=t.getUuid,s=t.log,a=e.forceMultipart||e.paramsInBody,u=new qq.traditional.AllChunksDoneAjaxRequester({cors:e.cors,endpoint:e.chunking.success.endpoint,log:s}),l=function(e,t){var n=new qq.Promise;return t.onreadystatechange=function(){if(4===t.readyState){var i=d(e,t);i.success?n.success(i.response,t):n.failure(i.response,t)}},n},c=function(e,t){return 200!==e.status||!t.success||t.reset},d=function(e,t){var n;return s("xhr - server response received for "+e),s("responseText = "+t.responseText),n=p(!0,t),{success:!c(t,n),response:n}},p=function(e,t){var n={};try{s(qq.format("Received response status {} with body: {}",t.status,t.responseText)),n=qq.parseJson(t.responseText)}catch(t){e&&s("Error when attempting to parse xhr response text ("+t.message+")","error")}return n},h=function(t){var s=new qq.Promise;return u.complete(t,n._createXhr(t),function(t){var s=e.paramsStore.get(t),a=i(t),u=r(t);return s[e.uuidName]=o(t),s[e.filenameParam]=a,s[e.totalFileSizeName]=u,s[e.chunking.paramNames.totalParts]=n._getTotalChunks(t),s}(t),e.customHeaders.get(t)).then(function(e){s.success(p(!1,e),e)},function(e){s.failure(p(!1,e),e)}),s},f=function(t,n,s,u){var l=new FormData,c=e.demoMode?"GET":"POST",d=e.endpointStore.get(u),p=i(u),h=r(u);return t[e.uuidName]=o(u),t[e.filenameParam]=p,a&&(t[e.totalFileSizeName]=h),e.paramsInBody||(a||(t[e.inputName]=p),d=qq.obj2url(t,d)),n.open(c,d,!0),e.cors.expected&&e.cors.sendCredentials&&(n.withCredentials=!0),a?(e.paramsInBody&&qq.obj2FormData(t,l),l.append(e.inputName,s),l):s},q=function(t,i){var r=e.customHeaders.get(t),o=n.getFile(t);i.setRequestHeader("Accept","application/json"),i.setRequestHeader("X-Requested-With","XMLHttpRequest"),i.setRequestHeader("Cache-Control","no-cache"),a||(i.setRequestHeader("Content-Type","application/octet-stream"),i.setRequestHeader("X-Mime-Type",o.type)),qq.each(r,function(e,t){i.setRequestHeader(e,t)})};qq.extend(this,{uploadChunk:function(t,o,s){var u,c,d,p=n._getChunkData(t,o),h=n._createXhr(t,o);r(t);return u=l(t,h),n._registerProgressHandler(t,o,p.size),function(t,n,o){var s=r(t),u=i(t);n[e.chunking.paramNames.partIndex]=o.part,n[e.chunking.paramNames.partByteOffset]=o.start,n[e.chunking.paramNames.chunkSize]=o.size,n[e.chunking.paramNames.totalParts]=o.count,n[e.totalFileSizeName]=s,a&&(n[e.filenameParam]=u)}(t,d=e.paramsStore.get(t),p),s&&(d[e.resume.paramNames.resuming]=!0),c=f(d,h,p.blob,t),q(t,h),h.send(c),u},uploadFile:function(t){var i,r,o,s,a=n.getFile(t);return r=n._createXhr(t),n._registerProgressHandler(t),i=l(t,r),o=e.paramsStore.get(t),s=f(o,r,a,t),q(t,r),r.send(s),i}}),qq.extend(this,new qq.XhrUploadHandler({options:qq.extend({namespace:"traditional"},e),proxy:qq.extend({getEndpoint:e.endpointStore.get},t)})),qq.override(this,function(t){return{finalizeChunks:function(n){return e.chunking.success.endpoint?h(n):t.finalizeChunks(n,qq.bind(p,this,!0))}}})},qq.traditional.AllChunksDoneAjaxRequester=function(e){"use strict";var t,n,i={cors:{allowXdr:!1,expected:!1,sendCredentials:!1},endpoint:null,log:function(e,t){}},r={},o={get:function(e){return i.endpoint}};qq.extend(i,e),t=qq.extend(this,new qq.AjaxRequester({acceptHeader:"application/json",validMethods:["POST"],method:"POST",successfulResponseCodes:(n={POST:[200,201,202]},n),endpointStore:o,allowXRequestedWithAndCacheControl:!1,cors:i.cors,log:i.log,onComplete:function(e,t,n){var i=r[e];delete r[e],n?i.failure(t):i.success(t)}})),qq.extend(this,{complete:function(e,n,o,s){var a=new qq.Promise;return i.log("Submitting All Chunks Done request for "+e),r[e]=a,t.initTransport(e).withParams(o).withHeaders(s).send(n),a}})},function(){"use strict";qq.uiPublicApi={clearStoredFiles:function(){this._parent.prototype.clearStoredFiles.apply(this,arguments),this._templating.clearFiles()},addExtraDropzone:function(e){this._dnd&&this._dnd.setupExtraDropzone(e)},removeExtraDropzone:function(e){if(this._dnd)return this._dnd.removeDropzone(e)},getItemByFileId:function(e){return this._templating.getFileContainer(e)},reset:function(){this._parent.prototype.reset.apply(this,arguments),this._templating.reset(),!this._options.button&&this._templating.getButton()&&(this._defaultButtonId=this._createUploadButton({element:this._templating.getButton()}).getButtonId()),this._dnd&&(this._dnd.dispose(),this._dnd=this._setupDragAndDrop()),this._totalFilesInBatch=0,this._filesInBatchAddedToUi=0,this._setupClickAndEditEventHandlers()},setName:function(e,t){var n=this._options.formatFileName(t);this._parent.prototype.setName.apply(this,arguments),this._templating.updateFilename(e,n)},pauseUpload:function(e){var t=this._parent.prototype.pauseUpload.apply(this,arguments);return t&&this._templating.uploadPaused(e),t},continueUpload:function(e){var t=this._parent.prototype.continueUpload.apply(this,arguments);return t&&this._templating.uploadContinued(e),t},getId:function(e){return this._templating.getFileId(e)},getDropTarget:function(e){return this.getFile(e).qqDropTarget}},qq.uiPrivateApi={_getButton:function(e){var t=this._parent.prototype._getButton.apply(this,arguments);return t||e===this._defaultButtonId&&(t=this._templating.getButton()),t},_removeFileItem:function(e){this._templating.removeFile(e)},_setupClickAndEditEventHandlers:function(){this._fileButtonsClickHandler=qq.FileButtonsClickHandler&&this._bindFileButtonsClickEvent(),this._focusinEventSupported=!qq.firefox(),this._isEditFilenameEnabled()&&(this._filenameClickHandler=this._bindFilenameClickEvent(),this._filenameInputFocusInHandler=this._bindFilenameInputFocusInEvent(),this._filenameInputFocusHandler=this._bindFilenameInputFocusEvent())},_setupDragAndDrop:function(){var e=this,t=this._options.dragAndDrop.extraDropzones,n=this._templating,i=n.getDropZone();return i&&t.push(i),new qq.DragAndDrop({dropZoneElements:t,allowMultipleItems:this._options.multiple,classes:{dropActive:this._options.classes.dropActive},callbacks:{processingDroppedFiles:function(){n.showDropProcessing()},processingDroppedFilesComplete:function(t,i){n.hideDropProcessing(),qq.each(t,function(e,t){t.qqDropTarget=i}),t.length&&e.addFiles(t,null,null)},dropError:function(t,n){e._itemError(t,n)},dropLog:function(t,n){e.log(t,n)}}})},_bindFileButtonsClickEvent:function(){var e=this;return new qq.FileButtonsClickHandler({templating:this._templating,log:function(t,n){e.log(t,n)},onDeleteFile:function(t){e.deleteFile(t)},onCancel:function(t){e.cancel(t)},onRetry:function(t){qq(e._templating.getFileContainer(t)).removeClass(e._classes.retryable),e._templating.hideRetry(t),e.retry(t)},onPause:function(t){e.pauseUpload(t)},onContinue:function(t){e.continueUpload(t)},onGetName:function(t){return e.getName(t)}})},_isEditFilenameEnabled:function(){return this._templating.isEditFilenamePossible()&&!this._options.autoUpload&&qq.FilenameClickHandler&&qq.FilenameInputFocusHandler&&qq.FilenameInputFocusHandler},_filenameEditHandler:function(){var e=this,t=this._templating;return{templating:t,log:function(t,n){e.log(t,n)},onGetUploadStatus:function(t){return e.getUploads({id:t}).status},onGetName:function(t){return e.getName(t)},onSetName:function(t,n){e.setName(t,n)},onEditingStatusChange:function(e,n){var i=qq(t.getEditInput(e)),r=qq(t.getFileContainer(e));n?(i.addClass("qq-editing"),t.hideFilename(e),t.hideEditIcon(e)):(i.removeClass("qq-editing"),t.showFilename(e),t.showEditIcon(e)),r.addClass("qq-temp").removeClass("qq-temp")}}},_onUploadStatusChange:function(e,t,n){this._parent.prototype._onUploadStatusChange.apply(this,arguments),this._isEditFilenameEnabled()&&this._templating.getFileContainer(e)&&n!==qq.status.SUBMITTED&&(this._templating.markFilenameEditable(e),this._templating.hideEditIcon(e))},_bindFilenameInputFocusInEvent:function(){var e=qq.extend({},this._filenameEditHandler());return new qq.FilenameInputFocusInHandler(e)},_bindFilenameInputFocusEvent:function(){var e=qq.extend({},this._filenameEditHandler());return new qq.FilenameInputFocusHandler(e)},_bindFilenameClickEvent:function(){var e=qq.extend({},this._filenameEditHandler());return new qq.FilenameClickHandler(e)},_storeForLater:function(e){this._parent.prototype._storeForLater.apply(this,arguments),this._templating.hideSpinner(e)},_onAllComplete:function(e,t){this._parent.prototype._onAllComplete.apply(this,arguments),this._templating.resetTotalProgress()},_onSubmit:function(e,t){var n=this.getFile(e);n&&n.qqPath&&this._options.dragAndDrop.reportDirectoryPaths&&this._paramsStore.addReadOnly(e,{qqpath:n.qqPath}),this._parent.prototype._onSubmit.apply(this,arguments),this._addToList(e,t)},_onSubmitted:function(e){this._isEditFilenameEnabled()&&(this._templating.markFilenameEditable(e),this._templating.showEditIcon(e),this._focusinEventSupported||this._filenameInputFocusHandler.addHandler(this._templating.getEditInput(e)))},_onProgress:function(e,t,n,i){this._parent.prototype._onProgress.apply(this,arguments),this._templating.updateProgress(e,n,i),100===Math.round(n/i*100)?(this._templating.hideCancel(e),this._templating.hidePause(e),this._templating.hideProgress(e),this._templating.setStatusText(e,this._options.text.waitingForResponse),this._displayFileSize(e)):this._displayFileSize(e,n,i)},_onTotalProgress:function(e,t){this._parent.prototype._onTotalProgress.apply(this,arguments),this._templating.updateTotalProgress(e,t)},_onComplete:function(e,t,n,i){var r=this._parent.prototype._onComplete.apply(this,arguments),o=this._templating,s=o.getFileContainer(e),a=this;function u(t){s&&(o.setStatusText(e),qq(s).removeClass(a._classes.retrying),o.hideProgress(e),a._options.disableCancelForFormUploads&&!qq.supportedFeatures.ajaxUploading||o.hideCancel(e),o.hideSpinner(e),t.success?a._markFileAsSuccessful(e):(qq(s).addClass(a._classes.fail),o.isRetryPossible()&&!a._preventRetries[e]&&(qq(s).addClass(a._classes.retryable),o.showRetry(e)),a._controlFailureTextDisplay(e,t)))}return r instanceof qq.Promise?r.done(function(e){u(e)}):u(n),r},_markFileAsSuccessful:function(e){var t=this._templating;this._isDeletePossible()&&t.showDeleteButton(e),qq(t.getFileContainer(e)).addClass(this._classes.success),this._maybeUpdateThumbnail(e)},_onUploadPrep:function(e){this._parent.prototype._onUploadPrep.apply(this,arguments),this._templating.showSpinner(e)},_onUpload:function(e,t){var n=this._parent.prototype._onUpload.apply(this,arguments);return this._templating.showSpinner(e),n},_onUploadChunk:function(e,t){this._parent.prototype._onUploadChunk.apply(this,arguments),t.partIndex>0&&this._handler.isResumable(e)&&this._templating.allowPause(e)},_onCancel:function(e,t){this._parent.prototype._onCancel.apply(this,arguments),this._removeFileItem(e),0===this._getNotFinished()&&this._templating.resetTotalProgress()},_onBeforeAutoRetry:function(e){var t,n,i;this._parent.prototype._onBeforeAutoRetry.apply(this,arguments),this._showCancelLink(e),this._options.retry.showAutoRetryNote&&(t=this._autoRetries[e],n=this._options.retry.maxAutoAttempts,i=(i=this._options.retry.autoRetryNote.replace(/\{retryNum\}/g,t)).replace(/\{maxAuto\}/g,n),this._templating.setStatusText(e,i),qq(this._templating.getFileContainer(e)).addClass(this._classes.retrying))},_onBeforeManualRetry:function(e){return this._parent.prototype._onBeforeManualRetry.apply(this,arguments)?(this._templating.resetProgress(e),qq(this._templating.getFileContainer(e)).removeClass(this._classes.fail),this._templating.setStatusText(e),this._templating.showSpinner(e),this._showCancelLink(e),!0):(qq(this._templating.getFileContainer(e)).addClass(this._classes.retryable),this._templating.showRetry(e),!1)},_onSubmitDelete:function(e){var t=qq.bind(this._onSubmitDeleteSuccess,this);this._parent.prototype._onSubmitDelete.call(this,e,t)},_onSubmitDeleteSuccess:function(e,t,n){this._options.deleteFile.forceConfirm?this._showDeleteConfirm.apply(this,arguments):this._sendDeleteRequest.apply(this,arguments)},_onDeleteComplete:function(e,t,n){this._parent.prototype._onDeleteComplete.apply(this,arguments),this._templating.hideSpinner(e),n?(this._templating.setStatusText(e,this._options.deleteFile.deletingFailedText),this._templating.showDeleteButton(e)):this._removeFileItem(e)},_sendDeleteRequest:function(e,t,n){this._templating.hideDeleteButton(e),this._templating.showSpinner(e),this._templating.setStatusText(e,this._options.deleteFile.deletingStatusText),this._deleteHandler.sendDelete.apply(this,arguments)},_showDeleteConfirm:function(e,t,n){var i,r=this.getName(e),o=this._options.deleteFile.confirmMessage.replace(/\{filename\}/g,r),s=(t=this.getUuid(e),arguments),a=this;i=this._options.showConfirm(o),qq.isGenericPromise(i)?i.then(function(){a._sendDeleteRequest.apply(a,s)}):!1!==i&&a._sendDeleteRequest.apply(a,s)},_addToList:function(e,t,n){var i,r=0;this._handler.isProxied(e)&&this._options.scaling.hideScaled||(this._options.display.prependFiles&&(this._totalFilesInBatch>1&&this._filesInBatchAddedToUi>0&&(r=this._filesInBatchAddedToUi-1),i={index:r}),n||(this._options.disableCancelForFormUploads&&!qq.supportedFeatures.ajaxUploading&&this._templating.disableCancel(),this._options.multiple||(this._handler.cancelAll(),this._clearList())),this._templating.addFile(e,this._options.formatFileName(t),i),n?this._thumbnailUrls[e]&&this._templating.updateThumbnail(e,this._thumbnailUrls[e],!0):this._templating.generatePreview(e,this.getFile(e)),this._filesInBatchAddedToUi+=1,(n||this._options.display.fileSizeOnSubmit&&qq.supportedFeatures.ajaxUploading)&&this._displayFileSize(e))},_clearList:function(){this._templating.clearFiles(),this.clearStoredFiles()},_displayFileSize:function(e,t,n){var i=this.getSize(e),r=this._formatSize(i);i>=0&&(void 0!==t&&void 0!==n&&(r=this._formatProgress(t,n)),this._templating.updateSize(e,r))},_formatProgress:function(e,t){var n=this._options.text.formatProgress;function i(e,t){n=n.replace(e,t)}return i("{percent}",Math.round(e/t*100)),i("{total_size}",this._formatSize(t)),n},_controlFailureTextDisplay:function(e,t){var n,i,r,o,s;n=this._options.failedUploadTextDisplay.mode,i=this._options.failedUploadTextDisplay.maxChars,r=this._options.failedUploadTextDisplay.responseProperty,"custom"===n?((o=t[r])?o.length>i&&(s=o.substring(0,i)+"..."):o=this._options.text.failUpload,this._templating.setStatusText(e,s||o),this._options.failedUploadTextDisplay.enableTooltip&&this._showTooltip(e,o)):"default"===n?this._templating.setStatusText(e,this._options.text.failUpload):"none"!==n&&this.log("failedUploadTextDisplay.mode value of '"+n+"' is not valid","warn")},_showTooltip:function(e,t){this._templating.getFileContainer(e).title=t},_showCancelLink:function(e){this._options.disableCancelForFormUploads&&!qq.supportedFeatures.ajaxUploading||this._templating.showCancel(e)},_itemError:function(e,t,n){var i=this._parent.prototype._itemError.apply(this,arguments);this._options.showMessage(i)},_batchError:function(e){this._parent.prototype._batchError.apply(this,arguments),this._options.showMessage(e)},_setupPastePrompt:function(){var e=this;this._options.callbacks.onPasteReceived=function(){var t=e._options.paste.namePromptMessage,n=e._options.paste.defaultName;return e._options.showPrompt(t,n)}},_fileOrBlobRejected:function(e,t){this._totalFilesInBatch-=1,this._parent.prototype._fileOrBlobRejected.apply(this,arguments)},_prepareItemsForUpload:function(e,t,n){this._totalFilesInBatch=e.length,this._filesInBatchAddedToUi=0,this._parent.prototype._prepareItemsForUpload.apply(this,arguments)},_maybeUpdateThumbnail:function(e){var t=this._thumbnailUrls[e];this._templating.updateThumbnail(e,t)},_addCannedFile:function(e){var t=this._parent.prototype._addCannedFile.apply(this,arguments);return this._addToList(t,this.getName(t),!0),this._templating.hideSpinner(t),this._templating.hideCancel(t),this._markFileAsSuccessful(t),t},_setSize:function(e,t){this._parent.prototype._setSize.apply(this,arguments),this._templating.updateSize(e,this._formatSize(t))}}}(),qq.FineUploader=function(e,t){"use strict";this._parent=t?qq[t].FineUploaderBasic:qq.FineUploaderBasic,this._parent.apply(this,arguments),qq.extend(this._options,{element:null,button:null,listElement:null,dragAndDrop:{extraDropzones:[],reportDirectoryPaths:!1},text:{formatProgress:"{percent}% of {total_size}",failUpload:"Upload failed",waitingForResponse:"Processing...",paused:"Paused"},template:"qq-template",classes:{retrying:"qq-upload-retrying",retryable:"qq-upload-retryable",success:"qq-upload-success",fail:"qq-upload-fail",editable:"qq-editable",hide:"qq-hide",dropActive:"qq-upload-drop-area-active"},failedUploadTextDisplay:{mode:"default",maxChars:50,responseProperty:"error",enableTooltip:!0},messages:{tooManyFilesError:"You may only drop one file",unsupportedBrowser:"Unrecoverable error - this browser does not permit file uploading of any kind."},retry:{showAutoRetryNote:!0,autoRetryNote:"Retrying {retryNum}/{maxAuto}..."},deleteFile:{forceConfirm:!1,confirmMessage:"Are you sure you want to delete {filename}?",deletingStatusText:"Deleting...",deletingFailedText:"Delete failed"},display:{fileSizeOnSubmit:!1,prependFiles:!1},paste:{promptForName:!1,namePromptMessage:"Please name this image"},thumbnails:{placeholders:{waitUntilResponse:!1,notAvailablePath:null,waitingPath:null}},scaling:{hideScaled:!1},showMessage:function(e){setTimeout(function(){window.alert(e)},0)},showConfirm:function(e){return window.confirm(e)},showPrompt:function(e,t){return window.prompt(e,t)}},!0),qq.extend(this._options,e,!0),this._templating=new qq.Templating({log:qq.bind(this.log,this),templateIdOrEl:this._options.template,containerEl:this._options.element,fileContainerEl:this._options.listElement,button:this._options.button,imageGenerator:this._imageGenerator,classes:{hide:this._options.classes.hide,editable:this._options.classes.editable},placeholders:{waitUntilUpdate:this._options.thumbnails.placeholders.waitUntilResponse,thumbnailNotAvailable:this._options.thumbnails.placeholders.notAvailablePath,waitingForThumbnail:this._options.thumbnails.placeholders.waitingPath},text:this._options.text}),!qq.supportedFeatures.uploading||this._options.cors.expected&&!qq.supportedFeatures.uploadCors?this._templating.renderFailure(this._options.messages.unsupportedBrowser):(this._wrapCallbacks(),this._templating.render(),this._classes=this._options.classes,!this._options.button&&this._templating.getButton()&&(this._defaultButtonId=this._createUploadButton({element:this._templating.getButton()}).getButtonId()),this._setupClickAndEditEventHandlers(),qq.DragAndDrop&&qq.supportedFeatures.fileDrop&&(this._dnd=this._setupDragAndDrop()),this._options.paste.targetElement&&this._options.paste.promptForName&&(qq.PasteSupport?this._setupPastePrompt():this.log("Paste support module not found.","error")),this._totalFilesInBatch=0,this._filesInBatchAddedToUi=0)},qq.extend(qq.FineUploader.prototype,qq.basePublicApi),qq.extend(qq.FineUploader.prototype,qq.basePrivateApi),qq.extend(qq.FineUploader.prototype,qq.uiPublicApi),qq.extend(qq.FineUploader.prototype,qq.uiPrivateApi),qq.Templating=function(e){"use strict";var t,n,i,r,o,s,a,u,l="qq-file-id-",c="qq-max-size",d="qq-server-scale",p="qq-hide-dropzone",h=!1,f=-1,q={log:null,templateIdOrEl:"qq-template",containerEl:null,fileContainerEl:null,button:null,imageGenerator:null,classes:{hide:"qq-hide",editable:"qq-editable"},placeholders:{waitUntilUpdate:!1,thumbnailNotAvailable:null,waitingForThumbnail:null},text:{paused:"Paused"}},g={button:"qq-upload-button-selector",drop:"qq-upload-drop-area-selector",list:"qq-upload-list-selector",progressBarContainer:"qq-progress-bar-container-selector",progressBar:"qq-progress-bar-selector",totalProgressBarContainer:"qq-total-progress-bar-container-selector",totalProgressBar:"qq-total-progress-bar-selector",file:"qq-upload-file-selector",spinner:"qq-upload-spinner-selector",size:"qq-upload-size-selector",cancel:"qq-upload-cancel-selector",pause:"qq-upload-pause-selector",continueButton:"qq-upload-continue-selector",deleteButton:"qq-upload-delete-selector",retry:"qq-upload-retry-selector",statusText:"qq-upload-status-text-selector",editFilenameInput:"qq-edit-filename-selector",editNameIcon:"qq-edit-filename-icon-selector",dropProcessing:"qq-drop-processing-selector",dropProcessingSpinner:"qq-drop-processing-spinner-selector",thumbnail:"qq-thumbnail-selector"},m={},_=new qq.Promise,v=new qq.Promise;function y(e){return qq(s).getByClass(l+e)[0]}function b(e,t){return e&&qq(e).getByClass(t)[0]}function S(e){return b(y(e),g.cancel)}function C(e){return b(y(e),g.pause)}function w(e){return b(y(e),g.continueButton)}function x(e){return null==e?b(o,g.totalProgressBarContainer)||b(o,g.totalProgressBar):b(y(e),g.progressBarContainer)||b(y(e),g.progressBar)}function E(e){return b(y(e),g.spinner)}function P(e){return b(y(e),g.editNameIcon)}function F(e){return b(y(e),g.size)}function I(e){return b(y(e),g.deleteButton)}function A(e){return b(y(e),g.retry)}function T(e){return b(y(e),g.file)}function D(){return b(o,g.dropProcessing)}function U(e){return a&&b(y(e),g.thumbnail)}function R(e){e&&qq(e).addClass(q.classes.hide)}function k(e){e&&qq(e).removeClass(q.classes.hide)}function B(e,t){var n=x(e),i=null==e?g.totalProgressBar:g.progressBar;n&&!qq(n).hasClass(i)&&(n=qq(n).getByClass(i)[0]),n&&qq(n).css({width:t+"%"})}function N(e){var t=new qq.Promise;return v.then(function(n){L(n,e),e.src?t.success():(e.src=n.src,e.onload=function(){k(e),t.success()})},function(){R(e),t.success()}),t}function O(e,t){var n=m[e]||(new qq.Promise).failure(),i=new qq.Promise;return _.then(function(e){n.then(function(){i.success()},function(){L(e,t),t.onload=function(){i.success()},t.src=e.src,k(t)})}),i}function L(e,t){var n=e.style.maxWidth,i=e.style.maxHeight;i&&n&&!t.style.maxWidth&&!t.style.maxHeight&&qq(t).css({maxWidth:n,maxHeight:i})}qq.extend(q,e),t=q.log,o=q.containerEl,a=void 0!==q.imageGenerator,r=function(){var e,r,o,s,l,h,m,_,v;if(t("Parsing template"),null==q.templateIdOrEl)throw new Error("You MUST specify either a template element or ID!");if(qq.isString(q.templateIdOrEl)){if(null===(e=document.getElementById(q.templateIdOrEl)))throw new Error(qq.format("Cannot find template script at ID '{}'!",q.templateIdOrEl));r=e.innerHTML}else{if(void 0===q.templateIdOrEl.innerHTML)throw new Error("You have specified an invalid value for the template option!  It must be an ID or an Element.");r=q.templateIdOrEl.innerHTML}if(r=qq.trimStr(r),(s=document.createElement("div")).appendChild(qq.toElement(r)),q.button&&(h=qq(s).getByClass(g.button)[0])&&qq(h).remove(),qq.DragAndDrop&&qq.supportedFeatures.fileDrop||(v=qq(s).getByClass(g.dropProcessing)[0])&&qq(v).remove(),(m=qq(s).getByClass(g.drop)[0])&&!qq.DragAndDrop&&(t("DnD module unavailable.","info"),qq(m).remove()),m&&!qq.supportedFeatures.fileDrop&&qq(m).hasAttribute(p)&&qq(m).css({display:"none"}),_=qq(s).getByClass(g.thumbnail)[0],a?_&&(f=(f=parseInt(_.getAttribute(c)))>0?f:null,u=qq(_).hasAttribute(d)):_&&qq(_).remove(),a=a&&_,n=qq(s).getByClass(g.editFilenameInput).length>0,i=qq(s).getByClass(g.retry).length>0,null==(o=qq(s).getByClass(g.list)[0]))throw new Error("Could not find the file list container in the template!");return l=o.innerHTML,o.innerHTML="",t("Template parsing complete"),{template:qq.trimStr(s.innerHTML),fileTemplate:qq.trimStr(l)}}(),function(){var e=q.placeholders.thumbnailNotAvailable,n=q.placeholders.waitingForThumbnail,i={maxSize:f,scale:u};a&&(e?q.imageGenerator.generate(e,new Image,i).then(function(e){_.success(e)},function(){_.failure(),t("Problem loading 'not available' placeholder image at "+e,"error")}):_.failure(),n?q.imageGenerator.generate(n,new Image,i).then(function(e){v.success(e)},function(){v.failure(),t("Problem loading 'waiting for thumbnail' placeholder image at "+n,"error")}):v.failure())}(),qq.extend(this,{render:function(){t("Rendering template in DOM."),o.innerHTML=r.template,R(D()),this.hideTotalProgress(),s=q.fileContainerEl||b(o,g.list),t("Template rendering complete")},renderFailure:function(e){var t=qq.toElement(e);o.innerHTML="",o.appendChild(t)},reset:function(){this.render()},clearFiles:function(){s.innerHTML=""},disableCancel:function(){h=!0},addFile:function(e,t,n){var i,o,a,u,c=qq.toElement(r.fileTemplate),d=b(c,g.file);qq(c).addClass(l+e),d&&qq(d).setText(t),c.setAttribute("qq-file-id",e),n?(i=c,o=n.index,u=(a=s).firstChild,o>0&&(u=qq(a).children()[o].nextSibling),a.insertBefore(i,u)):s.appendChild(c),R(x(e)),R(F(e)),R(I(e)),R(A(e)),R(C(e)),R(w(e)),h&&this.hideCancel(e)},removeFile:function(e){qq(y(e)).remove()},getFileId:function(e){var t=e;if(t){for(;null==t.getAttribute("qq-file-id");)t=t.parentNode;return parseInt(t.getAttribute("qq-file-id"))}},getFileList:function(){return s},markFilenameEditable:function(e){var t=T(e);t&&qq(t).addClass(q.classes.editable)},updateFilename:function(e,t){var n=T(e);n&&qq(n).setText(t)},hideFilename:function(e){R(T(e))},showFilename:function(e){k(T(e))},isFileName:function(e){return qq(e).hasClass(g.file)},getButton:function(){return q.button||b(o,g.button)},hideDropProcessing:function(){R(D())},showDropProcessing:function(){k(D())},getDropZone:function(){return b(o,g.drop)},isEditFilenamePossible:function(){return n},hideRetry:function(e){R(A(e))},isRetryPossible:function(){return i},showRetry:function(e){k(A(e))},getFileContainer:function(e){return y(e)},showEditIcon:function(e){var t=P(e);t&&qq(t).addClass(q.classes.editable)},hideEditIcon:function(e){var t=P(e);t&&qq(t).removeClass(q.classes.editable)},isEditIcon:function(e){return qq(e).hasClass(g.editNameIcon)},getEditInput:function(e){return b(y(e),g.editFilenameInput)},isEditInput:function(e){return qq(e).hasClass(g.editFilenameInput)},updateProgress:function(e,t,n){var i,r=x(e);r&&(100===(i=Math.round(t/n*100))?R(r):k(r),B(e,i))},updateTotalProgress:function(e,t){this.updateProgress(null,e,t)},hideProgress:function(e){var t=x(e);t&&R(t)},hideTotalProgress:function(){this.hideProgress()},resetProgress:function(e){B(e,0)},resetTotalProgress:function(){this.resetProgress()},showCancel:function(e){if(!h){var t=S(e);t&&qq(t).removeClass(q.classes.hide)}},hideCancel:function(e){R(S(e))},isCancel:function(e){return qq(e).hasClass(g.cancel)},allowPause:function(e){k(C(e)),R(w(e))},uploadPaused:function(e){this.setStatusText(e,q.text.paused),this.allowContinueButton(e),R(E(e))},hidePause:function(e){R(C(e))},isPause:function(e){return qq(e).hasClass(g.pause)},isContinueButton:function(e){return qq(e).hasClass(g.continueButton)},allowContinueButton:function(e){k(w(e)),R(C(e))},uploadContinued:function(e){this.setStatusText(e,""),this.allowPause(e),k(E(e))},showDeleteButton:function(e){k(I(e))},hideDeleteButton:function(e){R(I(e))},isDeleteButton:function(e){return qq(e).hasClass(g.deleteButton)},isRetry:function(e){return qq(e).hasClass(g.retry)},updateSize:function(e,t){var n=F(e);n&&(k(n),qq(n).setText(t))},setStatusText:function(e,t){var n=b(y(e),g.statusText);n&&(null==t?qq(n).clearText():qq(n).setText(t))},hideSpinner:function(e){R(E(e))},showSpinner:function(e){k(E(e))},generatePreview:function(e,n){var i=n&&n.qqThumbnailId,r=U(e),o={maxSize:f,scale:!0,orient:!0};qq.supportedFeatures.imagePreviews?r&&N(r).done(function(){var r,s,a,u;m[e]=new qq.Promise,null!=i?(s=i,a=U(r=e),u=U(s),t(qq.format("ID {} is the same file as ID {}.  Will use generated thumbnail from ID {} instead.",r,s,s)),m[s].then(function(){m[r].success(),t(qq.format("Now using previously generated thumbnail created for ID {} on ID {}.",s,r)),a.src=u.src,k(a)},function(){m[r].failure(),q.placeholders.waitUntilUpdate||O(r,a)})):function(e,n,i){var r=U(e);t("Generating new thumbnail for "+e),n.qqThumbnailId=e,q.imageGenerator.generate(n,r,i).then(function(){k(r),m[e].success()},function(){m[e].failure(),q.placeholders.waitUntilUpdate||O(e,r)})}(e,n,o)}):r&&N(r)},updateThumbnail:function(e,t,n){var i=U(e),r={maxSize:f,scale:u};if(i){if(t)return n&&N(i),q.imageGenerator.generate(t,i,r).then(function(){k(i)},function(){O(e,i)});O(e,i)}}})},qq.s3=qq.s3||{},qq.s3.util=qq.s3.util||function(){"use strict";return{AWS_PARAM_PREFIX:"x-amz-meta-",SESSION_TOKEN_PARAM_NAME:"x-amz-security-token",REDUCED_REDUNDANCY_PARAM_NAME:"x-amz-storage-class",REDUCED_REDUNDANCY_PARAM_VALUE:"REDUCED_REDUNDANCY",SERVER_SIDE_ENCRYPTION_PARAM_NAME:"x-amz-server-side-encryption",SERVER_SIDE_ENCRYPTION_PARAM_VALUE:"AES256",getBucket:function(e){var t;return qq.each([/^(?:https?:\/\/)?([a-z0-9.\-_]+)\.s3(?:-[a-z0-9\-]+)?\.amazonaws\.com/i,/^(?:https?:\/\/)?s3(?:-[a-z0-9\-]+)?\.amazonaws\.com\/([a-z0-9.\-_]+)/i,/^(?:https?:\/\/)?([a-z0-9.\-_]+)/i],function(n,i){var r=i.exec(e);if(r)return t=r[1],!1}),t},getPolicy:function(e){var t={},n=[],i=qq.s3.util.getBucket(e.endpoint),r=e.key,o=e.acl,s=e.type,a=new Date,u=e.expectedStatus,l=e.sessionToken,c=e.params,d=qq.s3.util.getSuccessRedirectAbsoluteUrl(e.successRedirectUrl),p=e.minFileSize,h=e.maxFileSize,f=e.reducedRedundancy,q=e.serverSideEncryption;return t.expiration=qq.s3.util.getPolicyExpirationDate(a),n.push({acl:o}),n.push({bucket:i}),s&&n.push({"Content-Type":s}),u&&n.push({success_action_status:u.toString()}),d&&n.push({success_action_redirect:d}),f&&(n.push({}),n[n.length-1][qq.s3.util.REDUCED_REDUNDANCY_PARAM_NAME]=qq.s3.util.REDUCED_REDUNDANCY_PARAM_VALUE),l&&(n.push({}),n[n.length-1][qq.s3.util.SESSION_TOKEN_PARAM_NAME]=l),q&&(n.push({}),n[n.length-1][qq.s3.util.SERVER_SIDE_ENCRYPTION_PARAM_NAME]=qq.s3.util.SERVER_SIDE_ENCRYPTION_PARAM_VALUE),n.push({key:r}),qq.each(c,function(e,t){var i={};i[qq.s3.util.AWS_PARAM_PREFIX+e]=encodeURIComponent(t),n.push(i)}),t.conditions=n,qq.s3.util.enforceSizeLimits(t,p,h),t},refreshPolicyCredentials:function(e,t){var n=!1;qq.each(e.conditions,function(e,i){qq.each(i,function(e,r){e===qq.s3.util.SESSION_TOKEN_PARAM_NAME&&(i[e]=t,n=!0)})}),n||(e.conditions.push({}),e.conditions[e.conditions.length-1][qq.s3.util.SESSION_TOKEN_PARAM_NAME]=t)},generateAwsParams:function(e,t){var n={},i=e.params,r=new qq.Promise,o=qq.s3.util.getPolicy(e),s=e.sessionToken,a=e.type,u=e.key,l=e.accessKey,c=e.acl,d=e.expectedStatus,p=qq.s3.util.getSuccessRedirectAbsoluteUrl(e.successRedirectUrl),h=e.reducedRedundancy,f=e.serverSideEncryption,q=e.log;return n.key=u,n.AWSAccessKeyId=l,a&&(n["Content-Type"]=a),d&&(n.success_action_status=d),p&&(n.success_action_redirect=p),h&&(n[qq.s3.util.REDUCED_REDUNDANCY_PARAM_NAME]=qq.s3.util.REDUCED_REDUNDANCY_PARAM_VALUE),f&&(n[qq.s3.util.SERVER_SIDE_ENCRYPTION_PARAM_NAME]=qq.s3.util.SERVER_SIDE_ENCRYPTION_PARAM_VALUE),s&&(n[qq.s3.util.SESSION_TOKEN_PARAM_NAME]=s),n.acl=c,qq.each(i,function(e,t){var i=qq.s3.util.AWS_PARAM_PREFIX+e;n[i]=encodeURIComponent(t)}),t(o).then(function(e,t,i){n.policy=e.policy,n.signature=e.signature,t&&(n.AWSAccessKeyId=t),i&&(n[qq.s3.util.SESSION_TOKEN_PARAM_NAME]=i),r.success(n)},function(e){q("Policy signing failed.  "+(e=e||"Can't continue further with request to S3 as we did not receive a valid signature and policy from the server."),"error"),r.failure(e)}),r},enforceSizeLimits:function(e,t,n){var i=t<0?0:t,r=n<=0?9007199254740992:n;(t>0||n>0)&&e.conditions.push(["content-length-range",i.toString(),r.toString()])},getPolicyExpirationDate:function(e){if(e.setMinutes(e.getMinutes()+5),Date.prototype.toISOString)return e.toISOString();var t=function(e){var t=String(e);return 1===t.length&&(t="0"+t),t};return e.getUTCFullYear()+"-"+t(e.getUTCMonth()+1)+"-"+t(e.getUTCDate())+"T"+t(e.getUTCHours())+":"+t(e.getUTCMinutes())+":"+t(e.getUTCSeconds())+"."+String((e.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z"},parseIframeResponse:function(e){var t=(e.contentDocument||e.contentWindow.document).location.search,n=/bucket=(.+)&key=(.+)&etag=(.+)/.exec(t);if(n)return{bucket:n[1],key:n[2],etag:n[3].replace(/%22/g,"")}},getSuccessRedirectAbsoluteUrl:function(e){if(e){var t,n=document.createElement("div");return qq.ie7()?(n.innerHTML="<a href='"+e+"'></a>",(t=n.firstChild).href):((t=document.createElement("a")).href=e,t.href=t.href,t.href)}},encodeQueryStringParam:function(e){var t=encodeURIComponent(e);return(t=(t=t.replace(/[!'()]/g,escape)).replace(/\*/g,"%2A")).replace(/%20/g,"+")}}}(),function(){"use strict";qq.nonTraditionalBasePublicApi={setUploadSuccessParams:function(e,t){this._uploadSuccessParamsStore.set(e,t)}},qq.nonTraditionalBasePrivateApi={_onComplete:function(e,t,n,i){var r,o,s=!!n.success,a=this,u=arguments,l=this._options.uploadSuccess.endpoint,c=this._options.uploadSuccess.customHeaders,d=this._options.cors,p=new qq.Promise,h=this._uploadSuccessParamsStore.get(e),f=function(t){delete a._failedSuccessRequestCallbacks[e],qq.extend(n,t),qq.FineUploaderBasic.prototype._onComplete.apply(a,u),p.success(t)},q=function(o){var s=r;qq.extend(n,o),n&&n.reset&&(s=null),s?a._failedSuccessRequestCallbacks[e]=s:delete a._failedSuccessRequestCallbacks[e],a._onAutoRetry(e,t,n,i,s)||(qq.FineUploaderBasic.prototype._onComplete.apply(a,u),p.failure(o))};return s&&l?(o=new qq.UploadSuccessAjaxRequester({endpoint:l,customHeaders:c,cors:d,log:qq.bind(this.log,this)}),qq.extend(h,a._getEndpointSpecificParams(e,n,i),!0),(r=qq.bind(function(){o.sendSuccessRequest(e,h).then(f,q)},a))(),p):qq.FineUploaderBasic.prototype._onComplete.apply(this,arguments)},_manualRetry:function(e){var t=this._failedSuccessRequestCallbacks[e];return qq.FineUploaderBasic.prototype._manualRetry.call(this,e,t)}}}(),function(){"use strict";qq.s3.FineUploaderBasic=function(e){var t={request:{accessKey:null},objectProperties:{acl:"private",key:"uuid",reducedRedundancy:!1,serverSideEncryption:!1},credentials:{accessKey:null,secretKey:null,expiration:null,sessionToken:null},signature:{endpoint:null,customHeaders:{}},uploadSuccess:{endpoint:null,params:{},customHeaders:{}},iframeSupport:{localBlankPagePath:null},chunking:{partSize:5242880},cors:{allowXdr:!0},callbacks:{onCredentialsExpired:function(){}}};qq.extend(t,e,!0),this.setCredentials(t.credentials,!0)||(this._currentCredentials.accessKey=t.request.accessKey),this._aclStore=this._createStore(t.objectProperties.acl),qq.FineUploaderBasic.call(this,t),this._uploadSuccessParamsStore=this._createStore(this._options.uploadSuccess.params),this._failedSuccessRequestCallbacks={},this._cannedKeys={}},qq.extend(qq.s3.FineUploaderBasic.prototype,qq.basePublicApi),qq.extend(qq.s3.FineUploaderBasic.prototype,qq.basePrivateApi),qq.extend(qq.s3.FineUploaderBasic.prototype,qq.nonTraditionalBasePublicApi),qq.extend(qq.s3.FineUploaderBasic.prototype,qq.nonTraditionalBasePrivateApi),qq.extend(qq.s3.FineUploaderBasic.prototype,{getKey:function(e){return null==this._cannedKeys[e]?this._handler.getThirdPartyFileId(e):this._cannedKeys[e]},reset:function(){qq.FineUploaderBasic.prototype.reset.call(this),this._failedSuccessRequestCallbacks=[]},setUploadSuccessParams:function(e,t){this._uploadSuccessParamsStore.set(e,t)},setCredentials:function(e,t){if(e&&e.secretKey){if(!e.accessKey)throw new qq.Error("Invalid credentials: no accessKey");if(!e.expiration)throw new qq.Error("Invalid credentials: no expiration");return this._currentCredentials=qq.extend({},e),qq.isString(e.expiration)&&(this._currentCredentials.expiration=new Date(e.expiration)),!0}if(!t)throw new qq.Error("Invalid credentials parameter!");this._currentCredentials={}},setAcl:function(e,t){this._aclStore.set(e,t)},_createUploadHandler:function(){var e=this,t={objectProperties:this._options.objectProperties,aclStore:this._aclStore,signature:this._options.signature,iframeSupport:this._options.iframeSupport,getKeyName:qq.bind(this._determineKeyName,this),validation:{minSizeLimit:this._options.validation.minSizeLimit,maxSizeLimit:this._options.validation.sizeLimit}};return qq.override(this._endpointStore,function(e){return{get:function(t){var n=e.get(t);return n.indexOf("http")<0?"http://"+n:n}}}),qq.override(this._paramsStore,function(e){return{get:function(t){var n=e.get(t),i={};return qq.each(n,function(e,t){i[e.toLowerCase()]=qq.isFunction(t)?t():t}),i}}}),t.signature.credentialsProvider={get:function(){return e._currentCredentials},onExpired:function(){var t=new qq.Promise,n=e._options.callbacks.onCredentialsExpired();return qq.isGenericPromise(n)?n.then(function(n){try{e.setCredentials(n),t.success()}catch(n){e.log("Invalid credentials returned from onCredentialsExpired callback! ("+n.message+")","error"),t.failure("onCredentialsExpired did not return valid credentials.")}},function(n){e.log("onCredentialsExpired callback indicated failure! ("+n+")","error"),t.failure("onCredentialsExpired callback failed.")}):(e.log("onCredentialsExpired callback did not return a promise!","error"),t.failure("Unexpected return value for onCredentialsExpired.")),t}},qq.FineUploaderBasic.prototype._createUploadHandler.call(this,t,"s3")},_determineKeyName:function(e,t){var n=new qq.Promise,i=this._options.objectProperties.key,r=qq.getExtension(t),o=n.failure,s=function(e,t){var i=e;void 0!==t&&(i+="."+t),n.success(i)};switch(i){case"uuid":s(this.getUuid(e),r);break;case"filename":s(t);break;default:qq.isFunction(i)?this._handleKeynameFunction(i,e,s,o):(this.log(i+" is not a valid value for the s3.keyname option!","error"),o())}return n},_handleKeynameFunction:function(e,t,n,i){var r=this,o=function(e){n(e)},s=function(e){r.log(qq.format("Failed to retrieve key name for {}.  Reason: {}",t,e||"null"),"error"),i(e)},a=e.call(this,t);qq.isGenericPromise(a)?a.then(o,s):null==a?s():o(a)},_getEndpointSpecificParams:function(e,t,n){var i={key:this.getKey(e),uuid:this.getUuid(e),name:this.getName(e),bucket:qq.s3.util.getBucket(this._endpointStore.get(e))};return n&&n.getResponseHeader("ETag")?i.etag=n.getResponseHeader("ETag"):t.etag&&(i.etag=t.etag),i},_onSubmitDelete:function(e,t){var n={key:this.getKey(e),bucket:qq.s3.util.getBucket(this._endpointStore.get(e))};return qq.FineUploaderBasic.prototype._onSubmitDelete.call(this,e,t,n)},_addCannedFile:function(e){var t;if(null==e.s3Key)throw new qq.Error("Did not find s3Key property in server session response.  This is required!");return t=qq.FineUploaderBasic.prototype._addCannedFile.apply(this,arguments),this._cannedKeys[t]=e.s3Key,t}})}(),qq.s3.RequestSigner=function(e){"use strict";var t,n,i=this,r={},o={expectingPolicy:!1,method:"POST",signatureSpec:{credentialsProvider:{},endpoint:null,customHeaders:{}},maxConnections:3,paramsStore:{},cors:{expected:!1,sendCredentials:!1},log:function(e,t){}};function s(e,t,i,r){var o;e.signatureConstructor?(r&&((o=e.signatureConstructor.getHeaders())[qq.s3.util.SESSION_TOKEN_PARAM_NAME]=r,e.signatureConstructor.withHeaders(o)),function(e,t){var i=CryptoJS.enc.Utf8.parse(e),r=CryptoJS.HmacSHA1(i,n.get().secretKey),o=CryptoJS.enc.Base64.stringify(r);t.success({signature:o})}(e.signatureConstructor.getToSign().stringToSign,t)):(r&&qq.s3.util.refreshPolicyCredentials(e,r),function(e,t,i,r){var o=JSON.stringify(e),s=CryptoJS.enc.Utf8.parse(o),a=CryptoJS.enc.Base64.stringify(s),u=CryptoJS.HmacSHA1(a,n.get().secretKey),l=CryptoJS.enc.Base64.stringify(u);t.success({policy:a,signature:l},i,r)}(e,t,i,r))}qq.extend(o,e,!0),n=o.signatureSpec.credentialsProvider,t=qq.extend(this,new qq.AjaxRequester({acceptHeader:"application/json",method:o.method,contentType:"application/json; charset=utf-8",endpointStore:{get:function(){return o.signatureSpec.endpoint}},paramsStore:o.paramsStore,maxConnections:o.maxConnections,customHeaders:o.signatureSpec.customHeaders,log:o.log,onComplete:function(e,t,n){var i,s,a=t.responseText,u=r[e].promise;if(delete r[e],a)try{s=qq.parseJson(a)}catch(e){o.log("Error attempting to parse signature response: "+e,"error")}s&&s.invalid?(n=!0,i="Invalid policy document or request headers!"):s?o.expectingPolicy&&!s.policy?(n=!0,i="Response does not include the base64 encoded policy!"):s.signature||(n=!0,i="Response does not include the signature!"):(n=!0,i="Received an empty or invalid response from the server!"),n?(i&&o.log(i,"error"),u.failure(i)):u.success(s)},cors:o.cors,successfulResponseCodes:{POST:[200]}})),qq.extend(this,{getSignature:function(e,i){var a=i,u=new qq.Promise;return n.get().secretKey&&window.CryptoJS?n.get().expiration.getTime()>Date.now()?s(i,u):n.onExpired().then(function(){s(i,u,n.get().accessKey,n.get().sessionToken)},function(e){o.log("Attempt to update expired credentials apparently failed! Unable to sign request.  ","error"),u.failure("Unable to sign request - expired credentials.")}):(o.log("Submitting S3 signature request for "+e),a.signatureConstructor&&(a={headers:a.signatureConstructor.getToSign().stringToSign}),t.initTransport(e).withParams(a).send(),r[e]={promise:u}),u},constructStringToSign:function(e,t,r){var o,s,a,u,l={};return{withHeaders:function(e){return l=e,this},withUploadId:function(e){return o=e,this},withContentType:function(e){return s=e,this},withPartNum:function(e){return a=e,this},getToSign:function(){var c=n.get().sessionToken;return l["x-amz-date"]=(new Date).toUTCString(),c&&(l[qq.s3.util.SESSION_TOKEN_PARAM_NAME]=c),u=function(e,t,n,r,o,s,a){var u,l="POST",c=[],d="";switch(e){case i.REQUEST_TYPE.MULTIPART_ABORT:l="DELETE",u=qq.format("uploadId={}",s);break;case i.REQUEST_TYPE.MULTIPART_INITIATE:u="uploads";break;case i.REQUEST_TYPE.MULTIPART_COMPLETE:u=qq.format("uploadId={}",s);break;case i.REQUEST_TYPE.MULTIPART_UPLOAD:l="PUT",u=qq.format("partNumber={}&uploadId={}",a,s)}return u=n+"?"+u,qq.each(o,function(e){c.push(e)}),c.sort(),qq.each(c,function(e,t){d+=t+":"+o[t]+"\n"}),{toSign:qq.format("{}\n\n{}\n\n{}/{}/{}",l,r||"",d||"\n",t,u),endOfUrl:u}}(e,t,r,s,l,o,a),{headers:(s&&(l["Content-Type"]=s),l),endOfUrl:u.endOfUrl,stringToSign:u.toSign}},getHeaders:function(){return qq.extend({},l)},getEndOfUrl:function(){return u&&u.endOfUrl}}}})},qq.s3.RequestSigner.prototype.REQUEST_TYPE={MULTIPART_INITIATE:"multipart_initiate",MULTIPART_COMPLETE:"multipart_complete",MULTIPART_ABORT:"multipart_abort",MULTIPART_UPLOAD:"multipart_upload"},qq.UploadSuccessAjaxRequester=function(e){"use strict";var t,n=[],i={method:"POST",endpoint:null,maxConnections:3,customHeaders:{},paramsStore:{},cors:{expected:!1,sendCredentials:!1},log:function(e,t){}};qq.extend(i,e),t=qq.extend(this,new qq.AjaxRequester({acceptHeader:"application/json",method:i.method,endpointStore:{get:function(){return i.endpoint}},paramsStore:i.paramsStore,maxConnections:i.maxConnections,customHeaders:i.customHeaders,log:i.log,onComplete:function(e,t,r){var o,s=n[e],a=t.responseText,u={success:!0},l={success:!1};delete n[e],i.log(qq.format("Received the following response body to an upload success request for id {}: {}",e,a));try{o=qq.parseJson(a),r||o&&(o.error||!1===o.success)?(i.log("Upload success request was rejected by the server.","error"),s.failure(qq.extend(o,l))):(i.log("Upload success was acknowledged by the server."),s.success(qq.extend(o,u)))}catch(t){r?(i.log(qq.format("Your server indicated failure in its upload success request response for id {}!",e),"error"),s.failure(l)):(i.log("Upload success was acknowledged by the server."),s.success(u))}},cors:i.cors,successfulResponseCodes:{POST:[200]}})),qq.extend(this,{sendSuccessRequest:function(e,r){var o=new qq.Promise;return i.log("Submitting upload success request/notification for "+e),t.initTransport(e).withParams(r).send(),n[e]=o,o}})},qq.s3.InitiateMultipartAjaxRequester=function(e){"use strict";var t,n,i={},r={filenameParam:"qqfilename",method:"POST",endpointStore:null,paramsStore:null,signatureSpec:null,aclStore:null,reducedRedundancy:!1,serverSideEncryption:!1,maxConnections:3,getContentType:function(e){},getKey:function(e){},getName:function(e){},log:function(e,t){}};qq.extend(r,e),n=new qq.s3.RequestSigner({signatureSpec:r.signatureSpec,cors:r.cors,log:r.log}),t=qq.extend(this,new qq.AjaxRequester({method:r.method,contentType:null,endpointStore:r.endpointStore,maxConnections:r.maxConnections,allowXRequestedWithAndCacheControl:!1,log:r.log,onComplete:function(e,t,n){var o,s,a,u,l,c=i[e],d=(new DOMParser).parseFromString(t.responseText,"application/xml");delete i[e],n?(l=t.status,(s=d.getElementsByTagName("Message")).length>0&&(u=s[0].textContent)):(o=d.getElementsByTagName("UploadId")).length>0?a=o[0].textContent:u="Upload ID missing from request",void 0===a?(u?r.log(qq.format("Specific problem detected initiating multipart upload request for {}: '{}'.",e,u),"error"):r.log(qq.format("Unexplained error with initiate multipart upload request for {}.  Status code {}.",e,l),"error"),c.failure("Problem initiating upload request with Amazon.",t)):(r.log(qq.format("Initiate multipart upload request successful for {}.  Upload ID is {}",e,a)),c.success(a,t))},successfulResponseCodes:{POST:[200]}})),qq.extend(this,{send:function(e){var o=new qq.Promise;return function(e){var t,i=qq.s3.util.getBucket(r.endpointStore.get(e)),o={},s=new qq.Promise,a=r.getKey(e);return o["x-amz-acl"]=r.aclStore.get(e),r.reducedRedundancy&&(o[qq.s3.util.REDUCED_REDUNDANCY_PARAM_NAME]=qq.s3.util.REDUCED_REDUNDANCY_PARAM_VALUE),r.serverSideEncryption&&(o[qq.s3.util.SERVER_SIDE_ENCRYPTION_PARAM_NAME]=qq.s3.util.SERVER_SIDE_ENCRYPTION_PARAM_VALUE),o[qq.s3.util.AWS_PARAM_PREFIX+r.filenameParam]=encodeURIComponent(r.getName(e)),qq.each(r.paramsStore.get(e),function(e,t){o[qq.s3.util.AWS_PARAM_PREFIX+e]=encodeURIComponent(t)}),t=n.constructStringToSign(n.REQUEST_TYPE.MULTIPART_INITIATE,i,a).withContentType(r.getContentType(e)).withHeaders(o),n.getSignature(e,{signatureConstructor:t}).then(function(e){(o=t.getHeaders()).Authorization="AWS "+r.signatureSpec.credentialsProvider.get().accessKey+":"+e.signature,s.success(o,t.getEndOfUrl())},s.failure),s}(e).then(function(n,s){r.log("Submitting S3 initiate multipart upload request for "+e),i[e]=o,t.initTransport(e).withPath(s).withHeaders(n).send()},o.failure),o}})},qq.s3.CompleteMultipartAjaxRequester=function(e){"use strict";var t,n,i={},r={method:"POST",contentType:"text/xml",endpointStore:null,signatureSpec:null,maxConnections:3,getKey:function(e){},log:function(e,t){}};qq.extend(r,e),n=new qq.s3.RequestSigner({signatureSpec:r.signatureSpec,cors:r.cors,log:r.log}),t=qq.extend(this,new qq.AjaxRequester({method:r.method,contentType:"application/xml; charset=UTF-8",endpointStore:r.endpointStore,maxConnections:r.maxConnections,allowXRequestedWithAndCacheControl:!1,log:r.log,onComplete:function(e,t,n){var o=i[e],s=new DOMParser,a=r.endpointStore.get(e),u=qq.s3.util.getBucket(a),l=(r.getKey(e),s.parseFromString(t.responseText,"application/xml")),c=l.getElementsByTagName("Bucket"),d=l.getElementsByTagName("Key");delete i[e],r.log(qq.format("Complete response status {}, body = {}",t.status,t.responseText)),n?r.log(qq.format("Complete Multipart Upload request for {} failed with status {}.",e,t.status),"error"):c.length&&d.length?c[0].textContent!==u&&(n=!0,r.log(qq.format("Wrong bucket in response to Complete Multipart Upload request for {}.",e),"error")):(n=!0,r.log(qq.format("Missing bucket and/or key in response to Complete Multipart Upload request for {}.",e),"error")),n?o.failure("Problem asking Amazon to combine the parts!",t):o.success({},t)},successfulResponseCodes:{POST:[200]}})),qq.extend(this,{send:function(e,o,s){var a=new qq.Promise;return function(e,t){var i={},o=new qq.Promise,s=r.endpointStore.get(e),a=qq.s3.util.getBucket(s),u=n.constructStringToSign(n.REQUEST_TYPE.MULTIPART_COMPLETE,a,r.getKey(e)).withUploadId(t).withContentType("application/xml; charset=UTF-8");return n.getSignature(e,{signatureConstructor:u}).then(function(e){(i=u.getHeaders()).Authorization="AWS "+r.signatureSpec.credentialsProvider.get().accessKey+":"+e.signature,o.success(i,u.getEndOfUrl())},o.failure),o}(e,o).then(function(n,o){var u=function(e){var t=document.implementation.createDocument(null,"CompleteMultipartUpload",null);return e.sort(function(e,t){return e.part-t.part}),qq.each(e,function(e,n){var i=n.part,r=n.etag,o=t.createElement("Part"),s=t.createElement("PartNumber"),a=t.createTextNode(i),u=t.createTextNode(r),l=t.createElement("ETag");l.appendChild(u),s.appendChild(a),o.appendChild(s),o.appendChild(l),qq(t).children()[0].appendChild(o)}),(new XMLSerializer).serializeToString(t)}(s);r.log("Submitting S3 complete multipart upload request for "+e),i[e]=a,delete n["Content-Type"],t.initTransport(e).withPath(o).withHeaders(n).withPayload(u).send()},a.failure),a}})},qq.s3.AbortMultipartAjaxRequester=function(e){"use strict";var t,n,i={method:"DELETE",endpointStore:null,signatureSpec:null,maxConnections:3,getKey:function(e){},log:function(e,t){}};qq.extend(i,e),n=new qq.s3.RequestSigner({signatureSpec:i.signatureSpec,cors:i.cors,log:i.log}),t=qq.extend(this,new qq.AjaxRequester({validMethods:["DELETE"],method:i.method,contentType:null,endpointStore:i.endpointStore,maxConnections:i.maxConnections,allowXRequestedWithAndCacheControl:!1,log:i.log,onComplete:function(e,t,n){var r,o=(new DOMParser).parseFromString(t.responseText,"application/xml"),s=o.getElementsByTagName("Error");i.log(qq.format("Abort response status {}, body = {}",t.status,t.responseText)),n?i.log(qq.format("Abort Multipart Upload request for {} failed with status {}.",e,t.status),"error"):s.length?(n=!0,r=o.getElementsByTagName("Message")[0].textContent,i.log(qq.format("Failed to Abort Multipart Upload request for {}.  Error: {}",e,r),"error")):i.log(qq.format("Abort MPU request succeeded for file ID {}.",e))},successfulResponseCodes:{DELETE:[204]}})),qq.extend(this,{send:function(e,r){(function(e,t){var r={},o=new qq.Promise,s=i.endpointStore.get(e),a=qq.s3.util.getBucket(s),u=n.constructStringToSign(n.REQUEST_TYPE.MULTIPART_ABORT,a,i.getKey(e)).withUploadId(t);return n.getSignature(e,{signatureConstructor:u}).then(function(e){(r=u.getHeaders()).Authorization="AWS "+i.signatureSpec.credentialsProvider.get().accessKey+":"+e.signature,o.success(r,u.getEndOfUrl())},o.failure),o})(e,r).then(function(n,r){i.log("Submitting S3 Abort multipart upload request for "+e),t.initTransport(e).withPath(r).withHeaders(n).send()})}})},qq.s3.XhrUploadHandler=function(e,t){"use strict";var n=t.getName,i=t.log,r=e.getKeyName,o=e.filenameParam,s=e.paramsStore,a=e.endpointStore,u=e.aclStore,l=e.objectProperties.reducedRedundancy,c=e.objectProperties.serverSideEncryption,d=e.validation,p=e.signature,h=this,f=e.signature.credentialsProvider,q={combine:function(e){var t=h._getPersistableData(e).uploadId,n=h._getPersistableData(e).etags,i=new qq.Promise;return g.completeMultipart.send(e,t,n).then(i.success,function(t,n){i.failure(_.done(e,n).response,n)}),i},done:function(e,t,n){var i;_.response.parse(e,t).success&&(i=t.getResponseHeader("ETag"),h._getPersistableData(e).etags||(h._getPersistableData(e).etags=[]),h._getPersistableData(e).etags.push({part:n+1,etag:i}))},initHeaders:function(t,n){var i={},r=e.endpointStore.get(t),o=qq.s3.util.getBucket(r),s=_.key.urlSafe(t),a=new qq.Promise,u=g.restSignature.constructStringToSign(g.restSignature.REQUEST_TYPE.MULTIPART_UPLOAD,o,s).withPartNum(n+1).withUploadId(h._getPersistableData(t).uploadId);return g.restSignature.getSignature(t+"."+n,{signatureConstructor:u}).then(function(e){(i=u.getHeaders()).Authorization="AWS "+f.get().accessKey+":"+e.signature,a.success(i,u.getEndOfUrl())},a.failure),a},put:function(t,n){var i=h._createXhr(t,n),r=h._getChunkData(t,n),o=e.endpointStore.get(t),s=new qq.Promise;return q.initHeaders(t,n).then(function(e,a){var u=o+"/"+a;h._registerProgressHandler(t,n,r.size),_.track(t,i,n).then(s.success,s.failure),i.open("PUT",u,!0),qq.each(e,function(e,t){i.setRequestHeader(e,t)}),i.send(r.blob)},function(){s.failure({error:"Problem signing the chunk!"},i)}),s},send:function(e,t){var n=new qq.Promise;return q.setup(e).then(function(){q.put(e,t).then(n.success,n.failure)},function(e,t){n.failure({error:e},t)}),n},setup:function(e){var t=new qq.Promise,n=h._getPersistableData(e).uploadId,i=new qq.Promise;return n?n instanceof qq.Promise?n.then(function(e){t.success(e)}):t.success(n):(h._getPersistableData(e).uploadId=i,g.initiateMultipart.send(e).then(function(n){h._getPersistableData(e).uploadId=n,i.success(n),t.success(n)},function(n){h._getPersistableData(e).uploadId=null,t.failure(n),i.failure(n)})),t}},g={abortMultipart:new qq.s3.AbortMultipartAjaxRequester({endpointStore:a,signatureSpec:p,cors:e.cors,log:i,getKey:function(e){return _.key.urlSafe(e)}}),completeMultipart:new qq.s3.CompleteMultipartAjaxRequester({endpointStore:a,signatureSpec:p,cors:e.cors,log:i,getKey:function(e){return _.key.urlSafe(e)}}),initiateMultipart:new qq.s3.InitiateMultipartAjaxRequester({filenameParam:o,endpointStore:a,paramsStore:s,signatureSpec:p,aclStore:u,reducedRedundancy:l,serverSideEncryption:c,cors:e.cors,log:i,getContentType:function(e){return h._getMimeType(e)},getKey:function(e){return _.key.urlSafe(e)},getName:function(e){return n(e)}}),policySignature:new qq.s3.RequestSigner({expectingPolicy:!0,signatureSpec:p,cors:e.cors,log:i}),restSignature:new qq.s3.RequestSigner({signatureSpec:p,cors:e.cors,log:i})},m={initParams:function(e){var t=s.get(e);return t[o]=n(e),qq.s3.util.generateAwsParams({endpoint:a.get(e),params:t,type:h._getMimeType(e),key:h.getThirdPartyFileId(e),accessKey:f.get().accessKey,sessionToken:f.get().sessionToken,acl:u.get(e),expectedStatus:200,minFileSize:d.minSizeLimit,maxFileSize:d.maxSizeLimit,reducedRedundancy:l,serverSideEncryption:c,log:i},qq.bind(g.policySignature.getSignature,this,e))},send:function(e){var t=new qq.Promise,n=h._createXhr(e),r=h.getFile(e);return h._registerProgressHandler(e),_.track(e,n).then(t.success,t.failure),m.setup(e,n,r).then(function(t){i("Sending upload request for "+e),n.send(t)},t.failure),t},setup:function(e,t,n){var i=new FormData,r=a.get(e),o=new qq.Promise;return m.initParams(e).then(function(e){t.open("POST",r,!0),qq.obj2FormData(e,i),i.append("file",n),o.success(i)},function(e){o.failure({error:e})}),o}},_={done:function(e,t){var n=_.response.parse(e,t),r=!0!==n.success;return r&&_.response.shouldReset(n.code)&&(i("This is an unrecoverable error, we must restart the upload entirely on the next retry attempt.","error"),n.reset=!0),{success:!r,response:n}},key:{promise:function(e){var t=new qq.Promise,i=h.getThirdPartyFileId(e);return null==i?(i=new qq.Promise,h._setThirdPartyFileId(e,i),r(e,n(e)).then(function(n){h._setThirdPartyFileId(e,n),t.success(n)},function(n){h._setThirdPartyFileId(e,null),t.failure(n)})):qq.isGenericPromise(i)?t.then(i.success,i.failure):t.success(i),t},urlSafe:function(e){return encodeURIComponent(h.getThirdPartyFileId(e))}},response:{parse:function(e,t){var n,r={};try{i(qq.format("Received response status {} with body: {}",t.status,t.responseText)),200===t.status?r.success=!0:(n=_.response.parseError(t.responseText))&&(r.error=n.message,r.code=n.code)}catch(e){i("Error when attempting to parse xhr response text ("+e.message+")","error")}return r},parseError:function(e){var t,n,i=(new DOMParser).parseFromString(e,"application/xml"),r={};if(i.getElementsByTagName("Error").length)return t=i.getElementsByTagName("Code"),(n=i.getElementsByTagName("Message")).length&&(r.message=n[0].textContent),t.length&&(r.code=t[0].textContent),r},shouldReset:function(e){return"EntityTooSmall"===e||"InvalidPart"===e||"InvalidPartOrder"===e||"NoSuchUpload"===e}},start:function(e,t){var n=new qq.Promise;return _.key.promise(e).then(function(){null==t?m.send(e).then(n.success,n.failure):q.send(e,t).then(n.success,n.failure)},function(e){n.failure({error:e})}),n},track:function(e,t,n){var i=new qq.Promise;return t.onreadystatechange=function(){var r;4===t.readyState&&(null==n?(r=_.done(e,t),i[r.success?"success":"failure"](r.response,t)):(q.done(e,t,n),r=_.done(e,t),i[r.success?"success":"failure"](r.response,t)))},i}};qq.extend(this,{uploadChunk:_.start,uploadFile:_.start}),qq.extend(this,new qq.XhrUploadHandler({options:qq.extend({namespace:"s3"},e),proxy:qq.extend({getEndpoint:e.endpointStore.get},t)})),qq.override(this,function(e){return{expunge:function(t){var n=h._getPersistableData(t)&&h._getPersistableData(t).uploadId,i=h._maybeDeletePersistedChunkData(t);void 0!==n&&i&&g.abortMultipart.send(t,n),e.expunge(t)},finalizeChunks:function(e){return q.combine(e)},_getLocalStorageId:function(t){var n=e._getLocalStorageId(t),i=a.get(t);return n+"-"+qq.s3.util.getBucket(i)}}})},qq.s3.FormUploadHandler=function(e,t){"use strict";var n=this,i=t.onUuidChanged,r=t.getName,o=t.getUuid,s=t.log,a=e.getKeyName,u=e.filenameParam,l=e.paramsStore,c=e.endpointStore,d=e.aclStore,p=e.objectProperties.reducedRedundancy,h=e.objectProperties.serverSideEncryption,f=e.validation,q=e.signature,g=e.iframeSupport.localBlankPagePath,m=e.signature.credentialsProvider,_=new qq.s3.RequestSigner({signatureSpec:q,cors:e.cors,log:s});if(void 0===g)throw new Error("successRedirectEndpoint MUST be defined if you intend to use browsers that do not support the File API!");function v(t,i){var o=new qq.Promise,a=e.demoMode?"GET":"POST",q=e.endpointStore.get(t);r(t);return function(e){var t=l.get(e);return t[u]=r(e),qq.s3.util.generateAwsParams({endpoint:c.get(e),params:t,key:n.getThirdPartyFileId(e),accessKey:m.get().accessKey,sessionToken:m.get().sessionToken,acl:d.get(e),minFileSize:f.minSizeLimit,maxFileSize:f.maxSizeLimit,successRedirectUrl:g,reducedRedundancy:p,serverSideEncryption:h,log:s},qq.bind(_.getSignature,this,e))}(t).then(function(e){var t=n._initFormForUpload({method:a,endpoint:q,params:e,paramsInBody:!0,targetName:i.name});o.success(t)},function(e){o.failure(e),b(t,i)}),o}function y(t){var i=n._createIframe(t),r=n.getInput(t),o=new qq.Promise;return v(t,i).then(function(a){a.appendChild(r),n._attachLoadEvent(i,function(r){s("iframe loaded"),r?!1===r.success&&(s("Amazon likely rejected the upload request","error"),o.failure(r)):((r={}).success=function(t,i){var r=e.endpointStore.get(t),o=qq.s3.util.getBucket(r);try{(i.contentDocument||i.contentWindow.document).body.innerHTML;var a=qq.s3.util.parseIframeResponse(i);if(a.bucket===o&&a.key===qq.s3.util.encodeQueryStringParam(n.getThirdPartyFileId(t)))return!0;s("Response from AWS included an unexpected bucket or key name.","error")}catch(e){s("Error when attempting to parse form upload response ("+e.message+")","error")}return!1}(t,i),!1===r.success?(s("A success response was received by Amazon, but it was invalid in some way.","error"),o.failure(r)):(qq.extend(r,qq.s3.util.parseIframeResponse(i)),o.success(r))),b(t,i)}),s("Sending upload request for "+t),a.submit(),qq(a).remove()},o.failure),o}function b(e,t){n._detachLoadEvent(e),t&&qq(t).remove()}qq.extend(this,new qq.FormUploadHandler({options:{isCors:!1,inputName:"file"},proxy:{onCancel:e.onCancel,onUuidChanged:i,getName:r,getUuid:o,log:s}})),qq.extend(this,{uploadFile:function(e){var t=r(e),i=new qq.Promise;return n.getThirdPartyFileId(e)?y(e).then(i.success,i.failure):a(e,t).then(function(t){n._setThirdPartyFileId(e,t),y(e).then(i.success,i.failure)},function(e){i.failure({error:e})}),i}})},function(){"use strict";qq.s3.FineUploader=function(e){var t={failedUploadTextDisplay:{mode:"custom"}};qq.extend(t,e,!0),qq.FineUploader.call(this,t,"s3"),qq.supportedFeatures.ajaxUploading||void 0!==t.iframeSupport.localBlankPagePath||(this._options.element.innerHTML="<div>You MUST set the <code>localBlankPagePath</code> property of the <code>iframeSupport</code> option since this browser does not support the File API!</div>")},qq.extend(qq.s3.FineUploader.prototype,qq.s3.FineUploaderBasic.prototype),qq.extend(qq.s3.FineUploader.prototype,qq.uiPublicApi),qq.extend(qq.s3.FineUploader.prototype,qq.uiPrivateApi)}(),qq.DeleteFileAjaxRequester=function(e){"use strict";var t,n={method:"DELETE",uuidParamName:"qquuid",endpointStore:{},maxConnections:3,customHeaders:function(e){return{}},paramsStore:{},demoMode:!1,cors:{expected:!1,sendCredentials:!1},log:function(e,t){},onDelete:function(e){},onDeleteComplete:function(e,t,n){}};qq.extend(n,e),t=qq.extend(this,new qq.AjaxRequester({acceptHeader:"application/json",validMethods:["POST","DELETE"],method:n.method,endpointStore:n.endpointStore,paramsStore:n.paramsStore,mandatedParams:"POST"===n.method.toUpperCase()?{_method:"DELETE"}:{},maxConnections:n.maxConnections,customHeaders:function(e){return n.customHeaders.get(e)},demoMode:n.demoMode,log:n.log,onSend:n.onDelete,onComplete:n.onDeleteComplete,cors:n.cors})),qq.extend(this,{sendDelete:function(e,i,r){var o=r||{};n.log("Submitting delete file request for "+e),"DELETE"===n.method?t.initTransport(e).withPath(i).withParams(o).send():(o[n.uuidParamName]=i,t.initTransport(e).withParams(o).send())}})},qq.PasteSupport=function(e){"use strict";var t,n;t={targetElement:null,callbacks:{log:function(e,t){},pasteReceived:function(e){}}},qq.extend(t,e),qq(t.targetElement).attach("paste",function(e){var n=e.clipboardData;n&&qq.each(n.items,function(e,n){if(function(e){return e.type&&0===e.type.indexOf("image/")}(n)){var i=n.getAsFile();t.callbacks.pasteReceived(i)}})}),qq.extend(this,{reset:function(){n&&n()}})},qq.DragAndDrop=function(e){"use strict";var t,n,i,r="qq-hidezones",o="qq-hide-dropzone",s=[],a=[],u=new qq.DisposeSupport;function l(e){var n=new qq.Promise;return e.isFile?e.file(function(t){var i=e.name,r=e.fullPath,o=r.indexOf(i);"/"===(r=r.substr(0,o)).charAt(0)&&(r=r.substr(1)),t.qqPath=r,a.push(t),n.success()},function(i){t.callbacks.dropLog("Problem parsing '"+e.fullPath+"'.  FileError code "+i.code+".","error"),n.failure()}):e.isDirectory&&function e(t,n,i,r){var o=r||new qq.Promise,s=n||t.createReader();s.readEntries(function(n){var r=i?i.concat(n):n;n.length?setTimeout(function(){e(t,s,r,o)},0):o.success(r)},o.failure);return o}(e).then(function(e){var t=e.length;qq.each(e,function(e,i){l(i).done(function(){0===(t-=1)&&n.success()})}),e.length||n.success()},function(i){t.callbacks.dropLog("Problem parsing '"+e.fullPath+"'.  FileError code "+i.code+".","error"),n.failure()}),n}function c(e){var n=new qq.UploadDropZone({HIDE_ZONES_EVENT_NAME:r,element:e,onEnter:function(n){qq(e).addClass(t.classes.dropActive),n.stopPropagation()},onLeaveNotDescendants:function(n){qq(e).removeClass(t.classes.dropActive)},onDrop:function(e){var i,r,o,s;(i=e.dataTransfer,r=n,o=[],s=new qq.Promise,t.callbacks.processingDroppedFiles(),r.dropDisabled(!0),i.files.length>1&&!t.allowMultipleItems?(t.callbacks.processingDroppedFilesComplete([]),t.callbacks.dropError("tooManyFilesError",""),r.dropDisabled(!1),s.failure()):(a=[],qq.isFolderDropSupported(i)?qq.each(i.items,function(e,t){var n=t.webkitGetAsEntry();n&&(n.isFile?a.push(t.getAsFile()):o.push(l(n).done(function(){o.pop(),0===o.length&&s.success()})))}):a=i.files,0===o.length&&s.success()),s).then(function(){var e,i,r;e=a,i=n,r=Array.prototype.slice.call(e),t.callbacks.dropLog("Grabbed "+e.length+" dropped files."),i.dropDisabled(!1),t.callbacks.processingDroppedFilesComplete(r,i.getElement())},function(){t.callbacks.dropLog("Drop event DataTransfer parsing failed.  No files will be uploaded.","error")})}});return u.addDisposer(function(){n.dispose()}),qq(e).hasAttribute(o)&&qq(e).hide(),s.push(n),n}t={dropZoneElements:[],allowMultipleItems:!0,classes:{dropActive:null},callbacks:new qq.DragAndDrop.callbacks},qq.extend(t,e,!0),n=t.dropZoneElements,i=function(){setTimeout(function(){qq.each(n,function(e,n){qq(n).hasAttribute(o)&&qq(n).hide(),qq(n).removeClass(t.classes.dropActive)})},10)},qq.each(n,function(e,t){var i=c(t);!n.length||qq.ie()&&!qq.ie10()||u.attach(document,"dragenter",function(e){var t,r;!i.dropDisabled()&&(t=e,qq.each(t.dataTransfer.types,function(e,t){if("Files"===t)return r=!0,!1}),r)&&qq.each(n,function(e,t){t instanceof HTMLElement&&qq(t).css({display:"block"})})})}),u.attach(document,"dragleave",function(e){(function(e){return qq.firefox()?!e.relatedTarget:qq.safari()?e.x<0||e.y<0:0===e.x&&0===e.y})(e)&&i()}),u.attach(qq(document).children()[0],"mouseenter",function(e){i()}),u.attach(document,"drop",function(e){e.preventDefault(),i()}),u.attach(document,r,i),qq.extend(this,{setupExtraDropzone:function(e){t.dropZoneElements.push(e),c(e)},removeDropzone:function(e){var n,i=t.dropZoneElements;for(n in i)if(i[n]===e)return i.splice(n,1)},dispose:function(){u.dispose(),qq.each(s,function(e,t){t.dispose()})}})},qq.DragAndDrop.callbacks=function(){"use strict";return{processingDroppedFiles:function(){},processingDroppedFilesComplete:function(e,t){},dropError:function(e,t){qq.log("Drag & drop error code '"+e+" with these specifics: '"+t+"'","error")},dropLog:function(e,t){qq.log(e,t)}}},qq.UploadDropZone=function(e){"use strict";var t,n,i,r,o=new qq.DisposeSupport;function s(e){if(qq.ie()&&!qq.ie10())return!1;var t,n=e.dataTransfer,i=qq.safari();return t=!(!qq.ie10()&&!qq.ie11())||"none"!==n.effectAllowed,n&&t&&(n.files||!i&&n.types.contains&&n.types.contains("Files"))}function a(e){return void 0!==e&&(i=e),i}t={element:null,onEnter:function(e){},onLeave:function(e){},onLeaveNotDescendants:function(e){},onDrop:function(e){}},qq.extend(t,e),n=t.element,r||(function(){return qq.safari()||qq.firefox()&&qq.windows()}?o.attach(document,"dragover",function(e){e.preventDefault()}):o.attach(document,"dragover",function(e){e.dataTransfer&&(e.dataTransfer.dropEffect="none",e.preventDefault())}),r=!0),o.attach(n,"dragover",function(e){if(s(e)){var t=qq.ie()||qq.ie11()?null:e.dataTransfer.effectAllowed;e.dataTransfer.dropEffect="move"===t||"linkMove"===t?"move":"copy",e.stopPropagation(),e.preventDefault()}}),o.attach(n,"dragenter",function(e){if(!a()){if(!s(e))return;t.onEnter(e)}}),o.attach(n,"dragleave",function(e){if(s(e)){t.onLeave(e);var n=document.elementFromPoint(e.clientX,e.clientY);qq(this).contains(n)||t.onLeaveNotDescendants(e)}}),o.attach(n,"drop",function(e){if(!a()){if(!s(e))return;e.preventDefault(),e.stopPropagation(),t.onDrop(e),function(){var e;function n(){(e=document.createEvent("Event")).initEvent(t.HIDE_ZONES_EVENT_NAME,!0,!0)}if(window.CustomEvent)try{e=new CustomEvent(t.HIDE_ZONES_EVENT_NAME)}catch(e){n()}else n();document.dispatchEvent(e)}()}}),qq.extend(this,{dropDisabled:function(e){return a(e)},dispose:function(){o.dispose()},getElement:function(){return n}})},qq.UiEventHandler=function(e,t){"use strict";var n=new qq.DisposeSupport,i={eventType:"click",attachTo:null,onHandled:function(e,t){}};function r(e){n.attach(e,i.eventType,function(e){var t=(e=e||window.event).target||e.srcElement;i.onHandled(t,e)})}qq.extend(this,{addHandler:function(e){r(e)},dispose:function(){n.dispose()}}),qq.extend(t,{getFileIdFromItem:function(e){return e.qqFileId},getDisposeSupport:function(){return n}}),qq.extend(i,e),i.attachTo&&r(i.attachTo)},qq.FileButtonsClickHandler=function(e){"use strict";var t={templating:null,log:function(e,t){},onDeleteFile:function(e){},onCancel:function(e){},onRetry:function(e){},onPause:function(e){},onContinue:function(e){},onGetName:function(e){}},n={cancel:function(e){t.onCancel(e)},retry:function(e){t.onRetry(e)},deleteButton:function(e){t.onDeleteFile(e)},pause:function(e){t.onPause(e)},continueButton:function(e){t.onContinue(e)}};qq.extend(t,e),t.eventType="click",t.onHandled=function(e,i){qq.each(n,function(n,r){var o,s=n.charAt(0).toUpperCase()+n.slice(1);if(t.templating["is"+s](e))return o=t.templating.getFileId(e),qq.preventDefault(i),t.log(qq.format("Detected valid file button click event on file '{}', ID: {}.",t.onGetName(o),o)),r(o),!1})},t.attachTo=t.templating.getFileList(),qq.extend(this,new qq.UiEventHandler(t,{}))},qq.FilenameClickHandler=function(e){"use strict";var t={},n={templating:null,log:function(e,t){},classes:{file:"qq-upload-file",editNameIcon:"qq-edit-filename-icon"},onGetUploadStatus:function(e){},onGetName:function(e){}};qq.extend(n,e),n.eventType="click",n.onHandled=function(e,i){if(n.templating.isFileName(e)||n.templating.isEditIcon(e)){var r=n.templating.getFileId(e);n.onGetUploadStatus(r)===qq.status.SUBMITTED&&(n.log(qq.format("Detected valid filename click event on file '{}', ID: {}.",n.onGetName(r),r)),qq.preventDefault(i),t.handleFilenameEdit(r,e,!0))}},qq.extend(this,new qq.FilenameEditHandler(n,t))},qq.FilenameInputFocusInHandler=function(e,t){"use strict";var n={templating:null,onGetUploadStatus:function(e){},log:function(e,t){}};t||(t={}),n.eventType="focusin",n.onHandled=function(e,i){if(n.templating.isEditInput(e)){var r=n.templating.getFileId(e);n.onGetUploadStatus(r)===qq.status.SUBMITTED&&(n.log(qq.format("Detected valid filename input focus event on file '{}', ID: {}.",n.onGetName(r),r)),t.handleFilenameEdit(r,e))}},qq.extend(n,e),qq.extend(this,new qq.FilenameEditHandler(n,t))},qq.FilenameInputFocusHandler=function(e){"use strict";e.eventType="focus",e.attachTo=null,qq.extend(this,new qq.FilenameInputFocusInHandler(e,{}))},qq.FilenameEditHandler=function(e,t){"use strict";var n={templating:null,log:function(e,t){},onGetUploadStatus:function(e){},onGetName:function(e){},onSetName:function(e,t){},onEditingStatusChange:function(e,t){}};function i(e,t){var i,r=e.value;void 0!==r&&qq.trimStr(r).length>0&&(void 0!==(i=function(e){var t=n.onGetName(e);return qq.getExtension(t)}(t))&&(r=r+"."+i),n.onSetName(t,r)),n.onEditingStatusChange(t,!1)}qq.extend(n,e),n.attachTo=n.templating.getFileList(),qq.extend(this,new qq.UiEventHandler(n,t)),qq.extend(t,{handleFilenameEdit:function(e,r,o){var s,a,u,l=n.templating.getEditInput(e);n.onEditingStatusChange(e,!0),l.value=(s=e,a=n.onGetName(s),(u=a.lastIndexOf("."))>0&&(a=a.substr(0,u)),a),o&&l.focus(),function(e,n){t.getDisposeSupport().attach(e,"blur",function(){i(e,n)})}(l,e),function(e,n){t.getDisposeSupport().attach(e,"keyup",function(t){13===(t.keyCode||t.which)&&i(e,n)})}(l,e)}})},function(){function e(e,t,n,i){var r=e.naturalWidth,o=e.naturalHeight,s=n.width,a=n.height,u=t.getContext("2d");if(u.save(),!qq.supportedFeatures.unlimitedScaledImageSize){var l=function(e){if(!qq.ios())throw new qq.Error("Downsampled dimensions can only be reliably calculated for iOS!");if(e.origHeight*e.origWidth>5241e3)return{newHeight:Math.round(Math.sqrt(e.origHeight/e.origWidth*5241e3)),newWidth:Math.round(Math.sqrt(e.origWidth/e.origHeight*5241e3))}}({origWidth:s,origHeight:a});l&&(qq.log(qq.format("Had to reduce dimensions due to device limitations from {}w / {}h to {}w / {}h",s,a,l.newWidth,l.newHeight),"warn"),s=l.newWidth,a=l.newHeight)}if(function(e,t,n,i){switch(i){case 5:case 6:case 7:case 8:e.width=n,e.height=t;break;default:e.width=t,e.height=n}var r=e.getContext("2d");switch(i){case 2:r.translate(t,0),r.scale(-1,1);break;case 3:r.translate(t,n),r.rotate(Math.PI);break;case 4:r.translate(0,n),r.scale(1,-1);break;case 5:r.rotate(.5*Math.PI),r.scale(1,-1);break;case 6:r.rotate(.5*Math.PI),r.translate(0,-n);break;case 7:r.rotate(.5*Math.PI),r.translate(t,-n),r.scale(-1,1);break;case 8:r.rotate(-.5*Math.PI),r.translate(-t,0)}}(t,s,a,n.orientation),qq.ios()){(function(e){var t=e.naturalWidth;if(t*e.naturalHeight>1048576){var n=document.createElement("canvas");n.width=n.height=1;var i=n.getContext("2d");return i.drawImage(e,1-t,0),0===i.getImageData(0,0,1,1).data[3]}return!1})(e)&&(r/=2,o/=2);var c=1024,d=document.createElement("canvas");d.width=d.height=c;for(var p=d.getContext("2d"),h=i?function(e,t,n){var i=document.createElement("canvas");i.width=1,i.height=n;var r=i.getContext("2d");r.drawImage(e,0,0);for(var o=r.getImageData(0,0,1,n).data,s=0,a=n,u=n;u>s;)0===o[4*(u-1)+3]?a=u:s=u,u=a+s>>1;var l=u/n;return 0===l?1:l}(e,0,o):1,f=Math.ceil(c*s/r),q=Math.ceil(c*a/o/h),g=0,m=0;g<o;){for(var _=0,v=0;_<r;)p.clearRect(0,0,c,c),p.drawImage(e,-_,-g),u.drawImage(d,0,0,c,c,v,m,f,q),_+=c,v+=f;g+=c,m+=q}u.restore(),d=p=null}else u.drawImage(e,0,0,s,a);t.qqImageRendered&&t.qqImageRendered()}function t(e,t){if(window.Blob&&e instanceof Blob){var n=new Image,i=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;if(!i)throw Error("No createObjectURL function found to create blob url");n.src=i.createObjectURL(e),this.blob=e,e=n}if(!e.naturalWidth&&!e.naturalHeight){var r=this;e.onload=function(){var e=r.imageLoadListeners;e&&(r.imageLoadListeners=null,setTimeout(function(){for(var t=0,n=e.length;t<n;t++)e[t]()},0))},e.onerror=t,this.imageLoadListeners=[]}this.srcImage=e}t.prototype.render=function(t,n){if(this.imageLoadListeners){var i=this;this.imageLoadListeners.push(function(){i.render(t,n)})}else{n=n||{};var r=this.srcImage.naturalWidth,o=this.srcImage.naturalHeight,s=n.width,a=n.height,u=n.maxWidth,l=n.maxHeight,c=!this.blob||"image/jpeg"===this.blob.type;s&&!a?a=o*s/r<<0:a&&!s?s=r*a/o<<0:(s=r,a=o),u&&s>u&&(a=o*(s=u)/r<<0),l&&a>l&&(s=r*(a=l)/o<<0);var d={width:s,height:a};for(var p in n)d[p]=n[p];var h=t.tagName.toLowerCase();"img"===h?t.src=function(t,n,i){var r=document.createElement("canvas"),o=n.mime||"image/jpeg";return e(t,r,n,i),r.toDataURL(o,n.quality||.8)}(this.srcImage,d,c):"canvas"===h&&e(this.srcImage,t,d,c),"function"==typeof this.onrender&&this.onrender(t)}},qq.MegaPixImage=t}(),qq.ImageGenerator=function(e){"use strict";function t(e){return"img"===e.tagName.toLowerCase()}function n(e){return"canvas"===e.tagName.toLowerCase()}function i(e){var t=e.split("/"),n=t[t.length-1],i=qq.getExtension(n);switch(i=i&&i.toLowerCase()){case"jpeg":case"jpg":return"image/jpeg";case"png":return"image/png";case"bmp":return"image/bmp";case"gif":return"image/gif";case"tiff":case"tif":return"image/tiff"}}function r(e){var t,n,i,r=document.createElement("a");return r.href=e,t=r.protocol,i=r.port,n=r.hostname,t.toLowerCase()!==window.location.protocol.toLowerCase()||(n.toLowerCase()!==window.location.hostname.toLowerCase()||i!==window.location.port&&!qq.ie())}function o(i,r){var o=t(i)||n(i);return t(i)?function(t,n){t.onload=function(){t.onload=null,t.onerror=null,n.success(t)},t.onerror=function(){t.onload=null,t.onerror=null,e("Problem drawing thumbnail!","error"),n.failure(t,"Problem drawing thumbnail!")}}(i,r):n(i)?function(e,t){e.qqImageRendered=function(){t.success(e)}}(i,r):(r.failure(i),e(qq.format("Element container of type {} is not supported!",i.tagName),"error")),o}function s(e,t,n,s){var a=new Image,u=new qq.Promise;o(a,u),r(e)&&(a.crossOrigin="anonymous"),a.src=e,u.then(function(){o(t,n),new qq.MegaPixImage(a).render(t,{maxWidth:s,maxHeight:s,mime:i(e)})})}function a(e,t,n,i){o(t,n),qq(t).css({maxWidth:i+"px",maxHeight:i+"px"}),t.src=e}function u(e,i,u){var l,c=new qq.Promise,d=u.scale,p=d?u.maxSize:null;return d&&t(i)?(l=document.createElement("canvas")).getContext&&l.getContext("2d")?r(e)&&void 0===(new Image).crossOrigin?a(e,i,c,p):s(e,i,c,p):a(e,i,c,p):n(i)?s(e,i,c,p):o(i,c)&&(i.src=e),c}qq.extend(this,{generate:function(t,n,i){return qq.isString(t)?(e("Attempting to update thumbnail based on server response."),u(t,n,i||{})):(e("Attempting to draw client-side image preview."),function(t,n,i){var r=new qq.Promise,s=new qq.Identify(t,e),a=i.maxSize,u=null==i.orient||i.orient,l=function(){n.onerror=null,n.onload=null,e("Could not render preview, file may be too large!","error"),r.failure(n,"Browser cannot render image!")};return s.isPreviewable().then(function(i){var s={parse:function(){return(new qq.Promise).success()}},c=u?new qq.Exif(t,e):s,d=new qq.MegaPixImage(t,l);o(n,r)&&c.parse().then(function(e){var t=e&&e.Orientation;d.render(n,{maxWidth:a,maxHeight:a,orientation:t,mime:i})},function(t){e(qq.format("EXIF data could not be parsed ({}).  Assuming orientation = 1.",t)),d.render(n,{maxWidth:a,maxHeight:a,mime:i})})},function(){e("Not previewable"),r.failure(n,"Not previewable")}),r}(t,n,i||{}))}}),this._testing={},this._testing.isImg=t,this._testing.isCanvas=n,this._testing.isCrossOrigin=r,this._testing.determineMimeOfFileName=i},qq.Exif=function(e,t){"use strict";var n=[274],i={274:{name:"Orientation",bytes:2}};function r(e){for(var t=0,n=0;e.length>0;)t+=parseInt(e.substring(0,2),16)*Math.pow(2,n),e=e.substring(2,e.length),n+=8;return t}function o(){var t=new qq.Promise;return qq.readBlobToHex(e,0,6).then(function(n){0!==n.indexOf("ffd8")?t.failure("Not a valid JPEG!"):function t(n,i){var r=n,o=i;return void 0===r&&(r=2,o=new qq.Promise),qq.readBlobToHex(e,r,4).then(function(e){var n=/^ffe([0-9])/.exec(e);if(n)if("1"!==n[1]){var i=parseInt(e.slice(4,8),16);t(r+i+2,o)}else o.success(r);else o.failure("No EXIF header to be found!")}),o}().then(function(e){t.success(e)},function(e){t.failure(e)})}),t}qq.extend(this,{parse:function(){var s=new qq.Promise,a=function(e){t(qq.format("EXIF header parse failed: '{}' ",e)),s.failure(e)};return o().then(function(o){var u,l;t(qq.format("Moving forward with EXIF header parsing for '{}'",void 0===e.name?"blob":e.name)),(u=o,l=new qq.Promise,qq.readBlobToHex(e,u+10,2).then(function(e){l.success("4949"===e)}),l).then(function(u){t(qq.format("EXIF Byte order is {} endian",u?"little":"big")),function(t,n){var i=new qq.Promise;return qq.readBlobToHex(e,t+18,2).then(function(e){if(n)return i.success(r(e));i.success(parseInt(e,16))}),i}(o,u).then(function(l){var c,d,p,h;t(qq.format("Found {} APP1 directory entries",l)),(c=o,d=l,p=c+20,h=12*d,qq.readBlobToHex(e,p,h)).then(function(e){var o=function(e){for(var t=[],n=0;n+24<=e.length;)t.push(e.slice(n,n+24)),n+=24;return t}(e),a=function(e,t){var o=qq.extend([],n),s={};return qq.each(t,function(t,n){var a,u,l,c=n.slice(0,4),d=e?r(c):parseInt(c,16),p=o.indexOf(d);if(p>=0&&(u=i[d].name,l=i[d].bytes,a=n.slice(16,16+2*l),s[u]=e?r(a):parseInt(a,16),o.splice(p,1)),0===o.length)return!1}),s}(u,o);t("Successfully parsed some EXIF tags"),s.success(a)},a)},a)},a)},a),s}}),this._testing={},this._testing.parseLittleEndian=r},qq.Identify=function(e,t){"use strict";qq.extend(this,{isPreviewable:function(){var n=this,i=new qq.Promise,r=!1,o=void 0===e.name?"blob":e.name;return t(qq.format("Attempting to determine if {} can be rendered in this browser",o)),t("First pass: check type attribute of blob object."),this.isPreviewableSync()?(t("Second pass: check for magic bytes in file header."),qq.readBlobToHex(e,0,4).then(function(e){qq.each(n.PREVIEWABLE_MIME_TYPES,function(t,n){if(o=e,s=!1,a=[].concat(n),qq.each(a,function(e,t){if(0===o.indexOf(t))return s=!0,!1}),s)return("image/tiff"!==t||qq.supportedFeatures.tiffPreviews)&&(r=!0,i.success(t)),!1;var o,s,a}),t(qq.format("'{}' is {} able to be rendered in this browser",o,r?"":"NOT")),r||i.failure()},function(){t("Error reading file w/ name '"+o+"'.  Not able to be rendered in this browser."),i.failure()})):i.failure(),i},isPreviewableSync:function(){var n=e.type,i=qq.indexOf(Object.keys(this.PREVIEWABLE_MIME_TYPES),n)>=0,r=!1,o=void 0===e.name?"blob":e.name;return i&&(r="image/tiff"!==n||qq.supportedFeatures.tiffPreviews),!r&&t(o+" is not previewable in this browser per the blob's type attr"),r}})},qq.Identify.prototype.PREVIEWABLE_MIME_TYPES={"image/jpeg":"ffd8ff","image/gif":"474946","image/png":"89504e","image/bmp":"424d","image/tiff":["49492a00","4d4d002a"]},qq.ImageValidation=function(e,t){"use strict";this.validate=function(n){var i,r=new qq.Promise;return t("Attempting to validate image."),!function(e){var t=!1;return qq.each(e,function(e,n){if(n>0)return t=!0,!1}),t}(n)?r.success():(i=new qq.Promise,new qq.Identify(e,t).isPreviewable().then(function(){var n=new Image,r=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;r?(n.onerror=function(){t("Cannot determine dimensions for image.  May be too large.","error"),i.failure()},n.onload=function(){i.success({width:this.width,height:this.height})},n.src=r.createObjectURL(e)):(t("No createObjectURL function available to generate image URL!","error"),i.failure())},i.failure),i).then(function(e){var t=function(e,t){var n;return qq.each(e,function(e,i){if(i>0){var r=/(max|min)(Width|Height)/.exec(e),o=r[2].charAt(0).toLowerCase()+r[2].slice(1),s=t[o];switch(r[1]){case"min":if(s<i)return n=e,!1;break;case"max":if(s>i)return n=e,!1}}}),n}(n,e);t?r.failure(t):r.success()},r.success),r}},qq.Session=function(e){"use strict";var t={endpoint:null,params:{},customHeaders:{},cors:{},addFileRecord:function(e){},log:function(e,t){}};function n(e,n,i,r){var o=!1;(n=n&&function(e){if(qq.isArray(e))return!0;t.log("Session response is not an array.","error")}(e))&&qq.each(e,function(e,n){if(null==n.uuid)o=!0,t.log(qq.format("Session response item {} did not include a valid UUID - ignoring.",e),"error");else if(null==n.name)o=!0,t.log(qq.format("Session response item {} did not include a valid name - ignoring.",e),"error");else try{return t.addFileRecord(n),!0}catch(e){o=!0,t.log(e.message,"error")}return!1}),r[n&&!o?"success":"failure"](e,i)}qq.extend(t,e,!0),this.refresh=function(){var e=new qq.Promise,i=qq.extend({},t);return new qq.SessionAjaxRequester(qq.extend(i,{onComplete:function(t,i,r){n(t,i,r,e)}})).queryServer(),e}},qq.SessionAjaxRequester=function(e){"use strict";var t,n={endpoint:null,customHeaders:{},params:{},cors:{expected:!1,sendCredentials:!1},onComplete:function(e,t,n){},log:function(e,t){}};qq.extend(n,e),t=qq.extend(this,new qq.AjaxRequester({acceptHeader:"application/json",validMethods:["GET"],method:"GET",endpointStore:{get:function(){return n.endpoint}},customHeaders:n.customHeaders,log:n.log,onComplete:function(e,t,i){var r=null;if(null!=t.responseText)try{r=qq.parseJson(t.responseText)}catch(e){n.log("Problem parsing session response: "+e.message,"error"),i=!0}n.onComplete(r,!i,t)},cors:n.cors})),qq.extend(this,{queryServer:function(){var e=qq.extend({},n.params);n.log("Session query request."),t.initTransport("sessionRefresh").withParams(e).withCacheBuster().send()}})},qq.FormSupport=function(e,t,n){"use strict";var i=this,r=e.interceptSubmit,o=e.element,s=e.autoUpload;function a(e,t){if(!e.checkValidity||e.checkValidity())return!0;n("Form did not pass validation checks - will not upload.","error"),t()}qq.extend(this,{newEndpoint:null,newAutoUpload:s,attachedToForm:!1,getFormInputsAsObject:function(){return null==o?null:i._form2Obj(o)}}),o=function(e){return e&&(qq.isString(e)&&(e=document.getElementById(e)),e&&(n("Attaching to form element."),function(e){e.getAttribute("action")&&(i.newEndpoint=e.getAttribute("action"))}(e),r&&function(e){var n=e.submit;qq(e).attach("submit",function(i){(i=i||window.event).preventDefault?i.preventDefault():i.returnValue=!1,a(e,n)&&t()}),e.submit=function(){a(e,n)&&t()}}(e))),e}(o),this.attachedToForm=!!o},qq.extend(qq.FormSupport.prototype,{_form2Obj:function(e){"use strict";var t={},n=function(e){return t=e.type,qq.indexOf(["checkbox","radio"],t.toLowerCase())>=0&&!e.checked||e.disabled&&"hidden"!==e.type.toLowerCase();var t};return qq.each(e.elements,function(e,i){if((qq.isInput(i,!0)||"textarea"===i.tagName.toLowerCase())&&(o=i.type,qq.indexOf(["button","image","reset","submit"],o.toLowerCase())<0)&&!n(i))t[i.name]=i.value;else if("select"===i.tagName.toLowerCase()&&!n(i)){var r=function(e){var t=null;return qq.each(qq(e).children(),function(e,n){if("option"===n.tagName.toLowerCase()&&n.selected)return t=n.value,!1}),t}(i);null!==r&&(t[i.name]=r)}var o}),t}}),qq.Scaler=function(e,t){"use strict";var n=e.sendOriginal,i=e.orient,r=e.defaultType,o=e.defaultQuality/100,s=e.failureText,a=e.includeExif,u=this._getSortedSizes(e.sizes);qq.extend(this,{enabled:qq.supportedFeatures.scaling&&u.length>0,getFileRecords:function(e,l,c){var d=this,p=[],h=c.blob?c.blob:c;return new qq.Identify(h,t).isPreviewableSync()?(qq.each(u,function(e,n){var u=d._determineOutputType({defaultType:r,requestedType:n.type,refType:h.type});p.push({uuid:qq.getUniqueId(),name:d._getName(l,{name:n.name,type:u,refType:h.type}),blob:new qq.BlobProxy(h,qq.bind(d._generateScaledImage,d,{maxSize:n.maxSize,orient:i,type:u,quality:o,failedText:s,includeExif:a,log:t}))})}),n&&p.push({uuid:e,name:l,blob:h})):p.push({uuid:e,name:l,blob:h}),p},handleNewFile:function(e,t,n,i,r,o,s,a){e.qqButtonId||e.blob&&e.blob.qqButtonId;var u,l=[],c=null,d=a.addFileToHandler,p=a.uploadData,h=a.paramsStore,f=qq.getUniqueId();qq.each(this.getFileRecords(n,t,e),function(t,n){var o,a=e,u=i;n.blob instanceof qq.BlobProxy&&(a=n.blob,u=-1),o=p.addFile({uuid:n.uuid,name:n.name,size:u,batchId:s,proxyGroupId:f}),n.blob instanceof qq.BlobProxy?l.push(o):c=o,d(o,a),r.push({id:o,file:a})}),null!==c&&(qq.each(l,function(e,t){var n={qqparentuuid:p.retrieve({id:c}).uuid,qqparentsize:p.retrieve({id:c}).size};n[o]=p.retrieve({id:t}).uuid,p.setParentId(t,c),h.addReadOnly(t,n)}),l.length&&((u={})[o]=p.retrieve({id:c}).uuid,h.addReadOnly(c,u)))}})},qq.extend(qq.Scaler.prototype,{scaleImage:function(e,t,n){"use strict";if(!qq.supportedFeatures.scaling)throw new qq.Error("Scaling is not supported in this browser!");var i=new qq.Promise,r=n.log,o=n.getFile(e),s=n.uploadData.retrieve({id:e}),a=s&&s.name,u=s&&s.uuid,l={sendOriginal:!1,orient:t.orient,defaultType:t.type||null,defaultQuality:t.quality,failedToScaleText:"Unable to scale",sizes:[{name:"",maxSize:t.maxSize}]},c=new qq.Scaler(l,r);return qq.Scaler&&qq.supportedFeatures.imagePreviews&&o?qq.bind(function(){var t=c.getFileRecords(u,a,o)[0];t&&t.blob instanceof qq.BlobProxy?t.blob.create().then(i.success,i.failure):(r(e+" is not a scalable image!","error"),i.failure())},this)():(i.failure(),r("Could not generate requested scaled image for "+e+".  Scaling is either not possible in this browser, or the file could not be located.","error")),i},_determineOutputType:function(e){"use strict";var t=e.requestedType,n=e.defaultType,i=e.refType;return n||t?t&&qq.indexOf(Object.keys(qq.Identify.prototype.PREVIEWABLE_MIME_TYPES),t)>=0?"image/tiff"===t?qq.supportedFeatures.tiffPreviews?t:n:t:n:"image/jpeg"!==i?"image/png":i},_getName:function(e,t){"use strict";var n=e.lastIndexOf("."),i=" ("+t.name+")",r=t.type||"image/png",o=t.refType,s="",a=qq.getExtension(e);return n>=0?(s=e.substr(0,n),o!==r&&(a=r.split("/")[1]),s+=i+"."+a):s=e+i,s},_getSortedSizes:function(e){"use strict";return(e=qq.extend([],e)).sort(function(e,t){return e.maxSize>t.maxSize?1:e.maxSize<t.maxSize?-1:0})},_generateScaledImage:function(e,t){"use strict";var n=this,i=e.log,r=e.maxSize,o=e.orient,s=e.type,a=e.quality,u=e.failedText,l=e.includeExif&&"image/jpeg"===t.type&&"image/jpeg"===s,c=new qq.Promise,d=new qq.ImageGenerator(i),p=document.createElement("canvas");return i("Attempting to generate scaled version for "+t.name),d.generate(t,p,{maxSize:r,orient:o}).then(function(){var e=p.toDataURL(s,a),r=function(){i("Success generating scaled version for "+t.name);var r=n._dataUriToBlob(e);c.success(r)};l?n._insertExifHeader(t,e,i).then(function(t){e=t,r()},function(){i("Problem inserting EXIF header into scaled image.  Using scaled image w/out EXIF data.","error"),r()}):r()},function(){i("Failed attempt to generate scaled version for "+t.name,"error"),c.failure(u)}),c},_insertExifHeader:function(e,t,n){"use strict";var i=new FileReader,r=new qq.Promise,o="";return i.onload=function(){o=i.result,r.success(ExifRestorer.restore(o,t))},i.onerror=function(){n("Problem reading "+e.name+" during attempt to transfer EXIF data to scaled version.","error"),r.failure()},i.readAsDataURL(e),r},_dataUriToBlob:function(e){"use strict";var t,n,i,r;return t=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):decodeURI(e.split(",")[1]),n=e.split(",")[0].split(":")[1].split(";")[0],i=new ArrayBuffer(t.length),r=new Uint8Array(i),qq.each(t,function(e,t){r[e]=t.charCodeAt(0)}),this._createBlob(i,n)},_createBlob:function(e,t){"use strict";var n=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,i=n&&new n;return i?(i.append(e),i.getBlob(t)):new Blob([e],{type:t})}});var ExifRestorer=function(){var e={KEY_STR:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode64:function(e){var t,n,i,r,o,s="",a="",u="",l=0;do{i=(t=e[l++])>>2,r=(3&t)<<4|(n=e[l++])>>4,o=(15&n)<<2|(a=e[l++])>>6,u=63&a,isNaN(n)?o=u=64:isNaN(a)&&(u=64),s=s+this.KEY_STR.charAt(i)+this.KEY_STR.charAt(r)+this.KEY_STR.charAt(o)+this.KEY_STR.charAt(u),t=n=a="",i=r=o=u=""}while(l<e.length);return s},restore:function(e,t){if(!e.match("data:image/jpeg;base64,"))return t;var n=this.decode64(e.replace("data:image/jpeg;base64,","")),i=this.slice2Segments(n),r=this.exifManipulation(t,i);return"data:image/jpeg;base64,"+this.encode64(r)},exifManipulation:function(e,t){var n=this.getExifArray(t),i=this.insertExif(e,n);return new Uint8Array(i)},getExifArray:function(e){for(var t,n=0;n<e.length;n++)if(255==(t=e[n])[0]&225==t[1])return t;return[]},insertExif:function(e,t){var n=e.replace("data:image/jpeg;base64,",""),i=this.decode64(n),r=i.indexOf(255,3),o=i.slice(0,r),s=i.slice(r),a=o;return a=(a=a.concat(t)).concat(s)},slice2Segments:function(e){for(var t=0,n=[];!(255==e[t]&218==e[t+1]);){if(255==e[t]&216==e[t+1])t+=2;else{var i=t+(256*e[t+2]+e[t+3])+2,r=e.slice(t,i);n.push(r),t=i}if(t>e.length)break}return n},decode64:function(e){var t,n,i,r,o="",s="",a=0,u=[];if(/[^A-Za-z0-9\+\/\=]/g.exec(e))throw new Error("There were invalid base64 characters in the input text.  Valid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='");e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{t=this.KEY_STR.indexOf(e.charAt(a++))<<2|(i=this.KEY_STR.indexOf(e.charAt(a++)))>>4,n=(15&i)<<4|(r=this.KEY_STR.indexOf(e.charAt(a++)))>>2,o=(3&r)<<6|(s=this.KEY_STR.indexOf(e.charAt(a++))),u.push(t),64!=r&&u.push(n),64!=s&&u.push(o),t=n=o="",i=r=s=""}while(a<e.length);return u}};return e}();qq.TotalProgress=function(e,t){"use strict";var n={},i=0,r=0,o=-1,s=-1,a=function(t,n){t===o&&n===s||e(t,n),o=t,s=n},u=function(e){var i=t(e);i>0&&(l(e,0,i),n[e]={loaded:0,total:i})},l=function(e,t,o){var s=n[e]?n[e].loaded:0,u=n[e]?n[e].total:0;-1===t&&-1===o?(i-=s,r-=u):(t&&(i+=t-s),o&&(r+=o-u)),a(i,r)};qq.extend(this,{onAllComplete:function(e,t,n){(0===t.length||function(e,t){var n=!0;return qq.each(e,function(e,i){if(qq.indexOf(t,i)>=0)return n=!1,!1}),n}(t,n))&&(a(r,r),this.reset())},onStatusChange:function(e,t,i){i===qq.status.CANCELED||i===qq.status.REJECTED?function(e){l(e,-1,-1),delete n[e]}(e):i===qq.status.SUBMITTING&&u(e)},onIndividualProgress:function(e,t,i){l(e,t,i),n[e]={loaded:t,total:i}},onNewSize:function(e){u(e)},reset:function(){n={},i=0,r=0}})},function(e){"use strict";var t,n=["uploaderType","endpointType"];function i(n){var i,r,l,c=a(n||{}),d=(i=c,r=s("uploaderType"),l=s("endpointType"),r?(r=r.charAt(0).toUpperCase()+r.slice(1).toLowerCase(),l?new qq[l]["FineUploader"+r](i):new qq["FineUploader"+r](i)):l?new qq[l].FineUploader(i):new qq.FineUploader(i));return o(d),function(n,i){var r=n.callbacks={};e.each(i._options.callbacks,function(n,i){var o,s;o=(o=/^on(\w+)/.exec(n)[1]).substring(0,1).toLowerCase()+o.substring(1),s=t,r[n]=function(){var t,n,r=Array.prototype.slice.call(arguments),a=[];e.each(r,function(e,t){a.push(u(t))}),t=i.apply(this,r);try{n=s.triggerHandler(o,a)}catch(e){qq.log("Caught error in Fine Uploader jQuery event handler: "+e.message,"error")}return null!=t?t:n}}),i._options.callbacks=r}(c,d),t}function r(e,n){var i=t.data("fineuploader");if(!n)return void 0===i?null:i[e];void 0===i&&(i={}),i[e]=n,t.data("fineuploader",i)}function o(e){return r("uploader",e)}function s(e,t){return r(e,t)}function a(i,r){var o,u;if(o=void 0===r?"basic"!==i.uploaderType?{element:t[0]}:{}:r,e.each(i,function(t,i){e.inArray(t,n)>=0?s(t,i):i instanceof e?o[t]=i[0]:e.isPlainObject(i)?(o[t]={},a(i,o[t])):e.isArray(i)?(u=[],e.each(i,function(t,n){var i={};n instanceof e?e.merge(u,n):e.isPlainObject(n)?(a(n,i),u.push(i)):u.push(n)}),o[t]=u):o[t]=i}),void 0===r)return o}function u(t){var n=t;return null==t||"object"!=typeof t||1!==t.nodeType&&9!==t.nodeType||!t.cloneNode||(n=e(t)),n}e.fn.fineUploader=function(n){var r=this,s=arguments,l=[];return this.each(function(c,d){if(t=e(d),o()&&(p=n,"string"===e.type(p)&&!p.match(/^_/)&&void 0!==o()[p])){if(l.push(function(e){var t=[];return a(Array.prototype.slice.call(arguments,1),t),u(o()[e].apply(o(),t))}.apply(r,s)),1===r.length)return!1}else"object"!=typeof n&&n?e.error("Method "+n+" does not exist on jQuery.fineUploader"):i.apply(r,s);var p}),1===l.length?l[0]:l.length>1?l:this}}(jQuery),function(e){"use strict";e.fn.fineUploaderS3=function(t){return"object"==typeof t&&(t.endpointType="s3"),e.fn.fineUploader.apply(this,arguments)}}(jQuery),function(e){"use strict";var t,n="fineUploaderDnd";function i(n){n||(n={}),n.dropZoneElements=[t];var i,s=o(n);return i=s.callbacks={},e.each(new qq.DragAndDrop.callbacks,function(e,n){var r,o=e;r=t,i[e]=function(){var e=Array.prototype.slice.call(arguments),t=r.triggerHandler(o,e);return t}}),r(new qq.DragAndDrop(s)),t}function r(e){return function(e,i){var r=t.data(n);if(!i)return void 0===r?null:r[e];void 0===r&&(r={}),r[e]=i,t.data(n,r)}("dndInstance",e)}function o(t,n){var i,r;if(i=void 0===n?{}:n,e.each(t,function(t,n){n instanceof e?i[t]=n[0]:e.isPlainObject(n)?(i[t]={},o(n,i[t])):e.isArray(n)?(r=[],e.each(n,function(t,n){n instanceof e?e.merge(r,n):r.push(n)}),i[t]=r):i[t]=n}),void 0===n)return i}e.fn.fineUploaderDnd=function(n){var s=this,a=arguments,u=[];return this.each(function(l,c){if(t=e(c),r()&&(d=n,"string"===e.type(d)&&"dispose"===d&&void 0!==r()[d])){if(u.push(function(e){var t=[];return o(Array.prototype.slice.call(arguments,1),t),r()[e].apply(r(),t)}.apply(s,a)),1===s.length)return!1}else"object"!=typeof n&&n?e.error("Method "+n+" does not exist in Fine Uploader's DnD module."):i.apply(s,a);var d}),1===u.length?u[0]:u.length>1?u:this}}(jQuery),module.exports=qq},728:function(e,t){function n(){this.p={}}function i(){this.p={},this.items=[],this.tag="iframe"}n.prototype={setSku:function(e){return this.p.sku=e,this},setCat:function(e){return this.p.cat=e,this},setQty:function(e){return this.p.qty=e,this},setAmt:function(e){return this.p.amt=e,this},setName:function(e){return this.p.nme=e,this},setRebate:function(e){return this.p.rbt=e,this},addCustomParam:function(e,t){return this.advParams=this.advParams?this.advParams+"&":"",this.advParams+=encodeURIComponent(e)+"="+encodeURIComponent(t),this}},i.prototype={setDomain:function(e){return this.domain=e,this},enableImg:function(){return this.tag="img",this},setCampaignId:function(e){return this.p.cid=e,this},setChannel:function(e){return this.p.irchannel=e,this},setOrderId:function(e){return this.p.oid=e,this},setPromoCode:function(e){return this.p.promocode=e,this},setCustomerId:function(e){return this.p.custid=e,this},setStatus:function(e){return this.p.status=e,this},setPostcode:function(e){return this.p.postcode=e,this},setNote:function(e){return this.p.note=e,this},setRebate:function(e){return this.p.rebate=e,this},setSubTotal:function(e){return this.p.subtot=e,this},setDisposition:function(e){return this.p.disp=e,this},setCurrency:function(e){return this.p.currency=e,this},setExchangeRate:function(e){return this.p.exch=e,this},setDate1:function(e){return this.p.date1=e,this},setDate2:function(e){return this.p.date2=e,this},setString1:function(e){return this.p.str1=e,this},setString2:function(e){return this.p.str2=e,this},setMargin:function(e){return this.p.margin=e,this},setClickId:function(e){return this.p.clickid=e,this},addCustomParam:function(e,t){return this.advCustParams=this.advCustParams?this.advCustParams+"&":"",this.advCustParams+=encodeURIComponent(e)+"="+encodeURIComponent(t),this},addPassThroughParam:function(e,t){return this.passThroughParams=this.passThroughParams?this.passThroughParams+"&":"",this.passThroughParams+="p."+encodeURIComponent(e)+"="+encodeURIComponent(t),this},addItem:function(e,t,i,r,o,s){var a=new n;return a.setCat(e),a.setSku(t),a.setAmt(i),a.setQty(r),o&&a.setName(o),s&&a.setRebate(s),this.items.push(a),a},setAmount:function(e){return this.addItem("","",e,1).id="autoamount",this},domReady:function(){if(!document.addEventListener){try{if(!document.body)throw"continue";window.document.documentElement.doScroll("left")}catch(e){return!1}return!0}if(navigator.userAgent.indexOf("AppleWebKit/")>-1){if(/loaded|complete/.test(document.readyState))return!0}else if(/interactive|loaded|complete/.test(document.readyState))return!0;return!1},getQueryString:function(){var e=this,t="";0===e.items.length&&(e.addItem("","",0,1).id="autogenerated");for(var n in e.p)t+=n+"="+encodeURIComponent(e.p[n])+"&";e.passThroughParams&&(t+=e.passThroughParams+"&"),e.advCustParams&&(t+="cparam="+encodeURIComponent(e.advCustParams)+"&");for(var i=0,r=e.items.length;i<r;i++){var o=e.items[i],s=o.id||i+1;for(var a in o.p)t+=a+s+"="+encodeURIComponent(o.p[a])+"&",o.advCustParams&&(t+="cup"+s+"="+encodeURIComponent(o.advCustParams)+"&")}return t},fire:function(){var e=this,t=document.createElement(e.tag);t.width=t.height="0","iframe"==e.tag?(t.frameBorder=0,t.src="//"+e.domain+"/jifconv/?"+e.getQueryString()):(t.border="0",t.src="//"+e.domain+"/jconv/?"+e.getQueryString()),t.style.position="absolute",t.style.visibility="hidden";var n=window.setInterval(function(){e.domReady()&&(clearInterval(n),document.body.insertBefore(t,document.body.firstChild))},30)}};var r=new i;r.setCampaignId("4650"),r.setChannel("10615"),r.setDomain("skillshare.evyy.net"),e.exports=r},732:function(e,t,n){(function(i){var r,o;r=[n(9)],void 0===(o=function(e){return t=e,n=function(){"use strict";return{isMsie:function(){return!!/(msie|trident)/i.test(navigator.userAgent)&&navigator.userAgent.match(/(msie |rv:)(\d+(.\d+)?)/i)[2]},isBlankString:function(e){return!e||/^\s*$/.test(e)},escapeRegExChars:function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isArray:t.isArray,isFunction:t.isFunction,isObject:t.isPlainObject,isUndefined:function(e){return void 0===e},isElement:function(e){return!(!e||1!==e.nodeType)},isJQuery:function(e){return e instanceof t},toStr:function(e){return n.isUndefined(e)||null===e?"":e+""},bind:t.proxy,each:function(e,n){t.each(e,function(e,t){return n(t,e)})},map:t.map,filter:t.grep,every:function(e,n){var i=!0;return e?(t.each(e,function(t,r){if(!(i=n.call(null,r,t,e)))return!1}),!!i):i},some:function(e,n){var i=!1;return e?(t.each(e,function(t,r){if(i=n.call(null,r,t,e))return!1}),!!i):i},mixin:t.extend,identity:function(e){return e},clone:function(e){return t.extend(!0,{},e)},getIdGenerator:function(){var e=0;return function(){return e++}},templatify:function(e){return t.isFunction(e)?e:function(){return String(e)}},defer:function(e){setTimeout(e,0)},debounce:function(e,t,n){var i,r;return function(){var o,s,a=this,u=arguments;return o=function(){i=null,n||(r=e.apply(a,u))},s=n&&!i,clearTimeout(i),i=setTimeout(o,t),s&&(r=e.apply(a,u)),r}},throttle:function(e,t){var n,i,r,o,s,a;return s=0,a=function(){s=new Date,r=null,o=e.apply(n,i)},function(){var u=new Date,l=t-(u-s);return n=this,i=arguments,l<=0?(clearTimeout(r),r=null,s=u,o=e.apply(n,i)):r||(r=setTimeout(a,l)),o}},stringify:function(e){return n.isString(e)?e:JSON.stringify(e)},noop:function(){}}}(),r=function(){"use strict";var e={wrapper:"twitter-typeahead",input:"tt-input",hint:"tt-hint",menu:"tt-menu",dataset:"tt-dataset",suggestion:"tt-suggestion",selectable:"tt-selectable",empty:"tt-empty",open:"tt-open",cursor:"tt-cursor",highlight:"tt-highlight"};return function(i){var r,o,s,a;return o=n.mixin({},e,i),{css:(r={css:(s={wrapper:{display:"inline-block"},hint:{position:"absolute",top:"0",left:"0",borderColor:"transparent",boxShadow:"none",opacity:"1"},input:{position:"relative",verticalAlign:"top",backgroundColor:"transparent"},inputWithNoHint:{position:"relative",verticalAlign:"top"},menu:{position:"absolute",zIndex:"100",display:"none"},ltr:{left:"0",right:"auto"},rtl:{left:"auto",right:" 0"}},n.isMsie()&&n.mixin(s.input,{backgroundImage:"url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)"}),s),classes:o,html:(a=o,{wrapper:'<span class="'+a.wrapper+'"></span>',menu:'<div class="'+a.menu+'"></div>'}),selectors:t(o)}).css,html:r.html,classes:r.classes,selectors:r.selectors,mixin:function(e){n.mixin(e,r)}}};function t(e){var t={};return n.each(e,function(e,n){t[n]="."+e}),t}}(),o=function(){"use strict";var e;function i(e){e&&e.el||t.error("EventBus initialized without el"),this.$el=t(e.el)}return e={render:"rendered",cursorchange:"cursorchanged",select:"selected",autocomplete:"autocompleted"},n.mixin(i.prototype,{_trigger:function(e,n){var i;return i=t.Event("typeahead:"+e),(n=n||[]).unshift(i),this.$el.trigger.apply(this.$el,n),i},before:function(e){var t;return t=[].slice.call(arguments,1),this._trigger("before"+e,t).isDefaultPrevented()},trigger:function(t){var n;this._trigger(t,[].slice.call(arguments,1)),(n=e[t])&&this._trigger(n,[].slice.call(arguments,1))}}),i}(),s=function(){"use strict";var e=/\s+/,t=window.setImmediate?function(e){i(function(){e()})}:function(e){setTimeout(function(){e()},0)};return{onSync:function(e,t,i){return n.call(this,"sync",e,t,i)},onAsync:function(e,t,i){return n.call(this,"async",e,t,i)},off:function(t){var n;if(!this._callbacks)return this;for(t=t.split(e);n=t.shift();)delete this._callbacks[n];return this},trigger:function(n){var i,o,s,a,u;if(!this._callbacks)return this;for(n=n.split(e),s=[].slice.call(arguments,1);(i=n.shift())&&(o=this._callbacks[i]);)a=r(o.sync,this,[i].concat(s)),u=r(o.async,this,[i].concat(s)),a()&&t(u);return this}};function n(t,n,i,r){var o;if(!i)return this;for(n=n.split(e),i=r?function(e,t){return e.bind?e.bind(t):function(){e.apply(t,[].slice.call(arguments,0))}}(i,r):i,this._callbacks=this._callbacks||{};o=n.shift();)this._callbacks[o]=this._callbacks[o]||{sync:[],async:[]},this._callbacks[o][t].push(i);return this}function r(e,t,n){return function(){for(var i,r=0,o=e.length;!i&&r<o;r+=1)i=!1===e[r].apply(t,n);return!i}}}(),a=function(e){"use strict";var t={node:null,pattern:null,tagName:"span",className:null,wordsOnly:!1,caseSensitive:!1};return function(i){var r;(i=n.mixin({},t,i)).node&&i.pattern&&(i.pattern=n.isArray(i.pattern)?i.pattern:[i.pattern],r=function(e,t,i){for(var r,o=[],s=0,a=e.length;s<a;s++)o.push(n.escapeRegExChars(e[s]));return r=i?"\\b("+o.join("|")+")\\b":"("+o.join("|")+")",t?new RegExp(r):new RegExp(r,"i")}(i.pattern,i.caseSensitive,i.wordsOnly),function e(t,n){for(var i,r=0;r<t.childNodes.length;r++)3===(i=t.childNodes[r]).nodeType?r+=n(i)?1:0:e(i,n)}(i.node,function(t){var n,o,s;return(n=r.exec(t.data))&&(s=e.createElement(i.tagName),i.className&&(s.className=i.className),(o=t.splitText(n.index)).splitText(n[0].length),s.appendChild(o.cloneNode(!0)),t.parentNode.replaceChild(s,o)),!!n}))}}(window.document),u=function(){"use strict";var e;function i(e,i){var r;(e=e||{}).input||t.error("input is missing"),i.mixin(this),this.$hint=t(e.hint),this.$input=t(e.input),this.query=this.$input.val(),this.queryWhenFocused=this.hasFocus()?this.query:null,this.$overflowHelper=(r=this.$input,t('<pre aria-hidden="true"></pre>').css({position:"absolute",visibility:"hidden",whiteSpace:"pre",fontFamily:r.css("font-family"),fontSize:r.css("font-size"),fontStyle:r.css("font-style"),fontVariant:r.css("font-variant"),fontWeight:r.css("font-weight"),wordSpacing:r.css("word-spacing"),letterSpacing:r.css("letter-spacing"),textIndent:r.css("text-indent"),textRendering:r.css("text-rendering"),textTransform:r.css("text-transform")}).insertAfter(r)),this._checkLanguageDirection(),0===this.$hint.length&&(this.setHint=this.getHint=this.clearHint=this.clearHintIfInvalid=n.noop)}return e={9:"tab",27:"esc",37:"left",39:"right",13:"enter",38:"up",40:"down"},i.normalizeQuery=function(e){return n.toStr(e).replace(/^\s*/g,"").replace(/\s{2,}/g," ")},n.mixin(i.prototype,s,{_onBlur:function(){this.resetInputValue(),this.trigger("blurred")},_onFocus:function(){this.queryWhenFocused=this.query,this.trigger("focused")},_onKeydown:function(t){var n=e[t.which||t.keyCode];this._managePreventDefault(n,t),n&&this._shouldTrigger(n,t)&&this.trigger(n+"Keyed",t)},_onInput:function(){this._setQuery(this.getInputValue()),this.clearHintIfInvalid(),this._checkLanguageDirection()},_managePreventDefault:function(e,t){var n;switch(e){case"up":case"down":n=!r(t);break;default:n=!1}n&&t.preventDefault()},_shouldTrigger:function(e,t){var n;switch(e){case"tab":n=!r(t);break;default:n=!0}return n},_checkLanguageDirection:function(){var e=(this.$input.css("direction")||"ltr").toLowerCase();this.dir!==e&&(this.dir=e,this.$hint.attr("dir",e),this.trigger("langDirChanged",e))},_setQuery:function(e,t){var n,r,o,s;o=e,s=this.query,n=i.normalizeQuery(o)===i.normalizeQuery(s),r=!!n&&this.query.length!==e.length,this.query=e,t||n?!t&&r&&this.trigger("whitespaceChanged",this.query):this.trigger("queryChanged",this.query)},bind:function(){var t,i,r,o,s=this;return t=n.bind(this._onBlur,this),i=n.bind(this._onFocus,this),r=n.bind(this._onKeydown,this),o=n.bind(this._onInput,this),this.$input.on("blur.tt",t).on("focus.tt",i).on("keydown.tt",r),!n.isMsie()||n.isMsie()>9?this.$input.on("input.tt",o):this.$input.on("keydown.tt keypress.tt cut.tt paste.tt",function(t){e[t.which||t.keyCode]||n.defer(n.bind(s._onInput,s,t))}),this},focus:function(){this.$input.focus()},blur:function(){this.$input.blur()},getLangDir:function(){return this.dir},getQuery:function(){return this.query||""},setQuery:function(e,t){this.setInputValue(e),this._setQuery(e,t)},hasQueryChangedSinceLastFocus:function(){return this.query!==this.queryWhenFocused},getInputValue:function(){return this.$input.val()},setInputValue:function(e){this.$input.val(e),this.clearHintIfInvalid(),this._checkLanguageDirection()},resetInputValue:function(){this.setInputValue(this.query)},getHint:function(){return this.$hint.val()},setHint:function(e){this.$hint.val(e)},clearHint:function(){this.setHint("")},clearHintIfInvalid:function(){var e,t,n;e=this.getInputValue(),t=this.getHint(),n=e!==t&&0===t.indexOf(e),(""===e||!n||this.hasOverflow())&&this.clearHint()},hasFocus:function(){return this.$input.is(":focus")},hasOverflow:function(){var e=this.$input.width()-2;return this.$overflowHelper.text(this.getInputValue()),this.$overflowHelper.width()>=e},isCursorAtEnd:function(){var e,t,i;return e=this.$input.val().length,t=this.$input[0].selectionStart,n.isNumber(t)?t===e:!document.selection||((i=document.selection.createRange()).moveStart("character",-e),e===i.text.length)},destroy:function(){this.$hint.off(".tt"),this.$input.off(".tt"),this.$overflowHelper.remove(),this.$hint=this.$input=this.$overflowHelper=t("<div>")}}),i;function r(e){return e.altKey||e.ctrlKey||e.metaKey||e.shiftKey}}(),l=function(){"use strict";var e,i;function r(e,r){var o,s,a,u;(e=e||{}).templates=e.templates||{},e.templates.notFound=e.templates.notFound||e.templates.empty,e.source||t.error("missing source"),e.node||t.error("missing node"),e.name&&(o=e.name,!/^[_a-zA-Z0-9-]+$/.test(o))&&t.error("invalid dataset name: "+e.name),r.mixin(this),this.highlight=!!e.highlight,this.name=e.name||i(),this.limit=e.limit||3,this.displayFn=(u=(u=e.display||e.displayKey)||n.stringify,n.isFunction(u)?u:function(e){return e[u]}),this.templates=(s=e.templates,a=this.displayFn,{notFound:s.notFound&&n.templatify(s.notFound),pending:s.pending&&n.templatify(s.pending),header:s.header&&n.templatify(s.header),footer:s.footer&&n.templatify(s.footer),suggestion:s.suggestion||function(e){return t("<div>").text(a(e))}}),this.source=e.source.__ttAdapter?e.source.__ttAdapter():e.source,this.async=n.isUndefined(e.async)?this.source.length>2:!!e.async,this._resetLastSuggestion(),this.$el=t(e.node).addClass(this.classes.dataset).addClass(this.classes.dataset+"-"+this.name)}return e={val:"tt-selectable-display",obj:"tt-selectable-object"},i=n.getIdGenerator(),r.extractData=function(n){var i=t(n);return i.data(e.obj)?{val:i.data(e.val)||"",obj:i.data(e.obj)||null}:null},n.mixin(r.prototype,s,{_overwrite:function(e,t){(t=t||[]).length?this._renderSuggestions(e,t):this.async&&this.templates.pending?this._renderPending(e):!this.async&&this.templates.notFound?this._renderNotFound(e):this._empty(),this.trigger("rendered",this.name,t,!1)},_append:function(e,t){(t=t||[]).length&&this.$lastSuggestion.length?this._appendSuggestions(e,t):t.length?this._renderSuggestions(e,t):!this.$lastSuggestion.length&&this.templates.notFound&&this._renderNotFound(e),this.trigger("rendered",this.name,t,!0)},_renderSuggestions:function(e,t){var n;n=this._getSuggestionsFragment(e,t),this.$lastSuggestion=n.children().last(),this.$el.html(n).prepend(this._getHeader(e,t)).append(this._getFooter(e,t))},_appendSuggestions:function(e,t){var n,i;n=this._getSuggestionsFragment(e,t),i=n.children().last(),this.$lastSuggestion.after(n),this.$lastSuggestion=i},_renderPending:function(e){var t=this.templates.pending;this._resetLastSuggestion(),t&&this.$el.html(t({query:e,dataset:this.name}))},_renderNotFound:function(e){var t=this.templates.notFound;this._resetLastSuggestion(),t&&this.$el.html(t({query:e,dataset:this.name}))},_empty:function(){this.$el.empty(),this._resetLastSuggestion()},_getSuggestionsFragment:function(i,r){var o,s=this;return o=document.createDocumentFragment(),n.each(r,function(n){var r,a;a=s._injectQuery(i,n),r=t(s.templates.suggestion(a)).data(e.obj,n).data(e.val,s.displayFn(n)).addClass(s.classes.suggestion+" "+s.classes.selectable),o.appendChild(r[0])}),this.highlight&&a({className:this.classes.highlight,node:o,pattern:i}),t(o)},_getFooter:function(e,t){return this.templates.footer?this.templates.footer({query:e,suggestions:t,dataset:this.name}):null},_getHeader:function(e,t){return this.templates.header?this.templates.header({query:e,suggestions:t,dataset:this.name}):null},_resetLastSuggestion:function(){this.$lastSuggestion=t()},_injectQuery:function(e,t){return n.isObject(t)?n.mixin({_query:e},t):t},update:function(e){var n=this,i=!1,r=!1,o=0;function s(t){r||(r=!0,t=(t||[]).slice(0,n.limit),o=t.length,n._overwrite(e,t),o<n.limit&&n.async&&n.trigger("asyncRequested",e))}this.cancel(),this.cancel=function(){i=!0,n.cancel=t.noop,n.async&&n.trigger("asyncCanceled",e)},this.source(e,s,function(r){r=r||[],!i&&o<n.limit&&(n.cancel=t.noop,n._append(e,r.slice(0,n.limit-o)),o+=r.length,n.async&&n.trigger("asyncReceived",e))}),!r&&s([])},cancel:t.noop,clear:function(){this._empty(),this.cancel(),this.trigger("cleared")},isEmpty:function(){return this.$el.is(":empty")},destroy:function(){this.$el=t("<div>")}}),r}(),c=function(){"use strict";function e(e,i){var r=this;(e=e||{}).node||t.error("node is required"),i.mixin(this),this.$node=t(e.node),this.query=null,this.datasets=n.map(e.datasets,function(e){var n=r.$node.find(e.node).first();return e.node=n.length?n:t("<div>").appendTo(r.$node),new l(e,i)})}return n.mixin(e.prototype,s,{_onSelectableClick:function(e){this.trigger("selectableClicked",t(e.currentTarget))},_onRendered:function(e,t,n,i){this.$node.toggleClass(this.classes.empty,this._allDatasetsEmpty()),this.trigger("datasetRendered",t,n,i)},_onCleared:function(){this.$node.toggleClass(this.classes.empty,this._allDatasetsEmpty()),this.trigger("datasetCleared")},_propagate:function(){this.trigger.apply(this,arguments)},_allDatasetsEmpty:function(){return n.every(this.datasets,function(e){return e.isEmpty()})},_getSelectables:function(){return this.$node.find(this.selectors.selectable)},_removeCursor:function(){var e=this.getActiveSelectable();e&&e.removeClass(this.classes.cursor)},_ensureVisible:function(e){var t,n,i,r;t=e.position().top,n=t+e.outerHeight(!0),i=this.$node.scrollTop(),r=this.$node.height()+parseInt(this.$node.css("paddingTop"),10)+parseInt(this.$node.css("paddingBottom"),10),t<0?this.$node.scrollTop(i+t):r<n&&this.$node.scrollTop(i+(n-r))},bind:function(){var e,t=this;return e=n.bind(this._onSelectableClick,this),this.$node.on("click.tt",this.selectors.selectable,e),n.each(this.datasets,function(e){e.onSync("asyncRequested",t._propagate,t).onSync("asyncCanceled",t._propagate,t).onSync("asyncReceived",t._propagate,t).onSync("rendered",t._onRendered,t).onSync("cleared",t._onCleared,t)}),this},isOpen:function(){return this.$node.hasClass(this.classes.open)},open:function(){this.$node.addClass(this.classes.open)},close:function(){this.$node.removeClass(this.classes.open),this._removeCursor()},setLanguageDirection:function(e){this.$node.attr("dir",e)},selectableRelativeToCursor:function(e){var t,n,i,r;return n=this.getActiveSelectable(),t=this._getSelectables(),i=n?t.index(n):-1,-1===(r=(r=((r=i+e)+1)%(t.length+1)-1)<-1?t.length-1:r)?null:t.eq(r)},setCursor:function(e){this._removeCursor(),(e=e&&e.first())&&(e.addClass(this.classes.cursor),this._ensureVisible(e))},getSelectableData:function(e){return e&&e.length?l.extractData(e):null},getActiveSelectable:function(){var e=this._getSelectables().filter(this.selectors.cursor).first();return e.length?e:null},getTopSelectable:function(){var e=this._getSelectables().first();return e.length?e:null},update:function(e){var t=e!==this.query;return t&&(this.query=e,n.each(this.datasets,function(t){t.update(e)})),t},empty:function(){n.each(this.datasets,function(e){e.clear()}),this.query=null,this.$node.addClass(this.classes.empty)},destroy:function(){this.$node.off(".tt"),this.$node=t("<div>"),n.each(this.datasets,function(e){e.destroy()})}}),e}(),d=function(){"use strict";var e=c.prototype;function t(){c.apply(this,[].slice.call(arguments,0))}return n.mixin(t.prototype,c.prototype,{open:function(){return!this._allDatasetsEmpty()&&this._show(),e.open.apply(this,[].slice.call(arguments,0))},close:function(){return this._hide(),e.close.apply(this,[].slice.call(arguments,0))},_onRendered:function(){return this._allDatasetsEmpty()?this._hide():this.isOpen()&&this._show(),e._onRendered.apply(this,[].slice.call(arguments,0))},_onCleared:function(){return this._allDatasetsEmpty()?this._hide():this.isOpen()&&this._show(),e._onCleared.apply(this,[].slice.call(arguments,0))},setLanguageDirection:function(t){return this.$node.css("ltr"===t?this.css.ltr:this.css.rtl),e.setLanguageDirection.apply(this,[].slice.call(arguments,0))},_hide:function(){this.$node.hide()},_show:function(){this.$node.css("display","block")}}),t}(),p=function(){"use strict";function e(e,r){var o,s,a,u,l,c,d,p,h,f,q;(e=e||{}).input||t.error("missing input"),e.menu||t.error("missing menu"),e.eventBus||t.error("missing event bus"),r.mixin(this),this.eventBus=e.eventBus,this.minLength=n.isNumber(e.minLength)?e.minLength:1,this.input=e.input,this.menu=e.menu,this.enabled=!0,this.active=!1,this.input.hasFocus()&&this.activate(),this.dir=this.input.getLangDir(),this._hacks(),this.menu.bind().onSync("selectableClicked",this._onSelectableClicked,this).onSync("asyncRequested",this._onAsyncRequested,this).onSync("asyncCanceled",this._onAsyncCanceled,this).onSync("asyncReceived",this._onAsyncReceived,this).onSync("datasetRendered",this._onDatasetRendered,this).onSync("datasetCleared",this._onDatasetCleared,this),o=i(this,"activate","open","_onFocused"),s=i(this,"deactivate","_onBlurred"),a=i(this,"isActive","isOpen","_onEnterKeyed"),u=i(this,"isActive","isOpen","_onTabKeyed"),l=i(this,"isActive","_onEscKeyed"),c=i(this,"isActive","open","_onUpKeyed"),d=i(this,"isActive","open","_onDownKeyed"),p=i(this,"isActive","isOpen","_onLeftKeyed"),h=i(this,"isActive","isOpen","_onRightKeyed"),f=i(this,"_openIfActive","_onQueryChanged"),q=i(this,"_openIfActive","_onWhitespaceChanged"),this.input.bind().onSync("focused",o,this).onSync("blurred",s,this).onSync("enterKeyed",a,this).onSync("tabKeyed",u,this).onSync("escKeyed",l,this).onSync("upKeyed",c,this).onSync("downKeyed",d,this).onSync("leftKeyed",p,this).onSync("rightKeyed",h,this).onSync("queryChanged",f,this).onSync("whitespaceChanged",q,this).onSync("langDirChanged",this._onLangDirChanged,this)}return n.mixin(e.prototype,{_hacks:function(){var e,i;e=this.input.$input||t("<div>"),i=this.menu.$node||t("<div>"),e.on("blur.tt",function(t){var r,o,s;r=document.activeElement,o=i.is(r),s=i.has(r).length>0,n.isMsie()&&(o||s)&&(t.preventDefault(),t.stopImmediatePropagation(),n.defer(function(){e.focus()}))}),i.on("mousedown.tt",function(e){e.preventDefault()})},_onSelectableClicked:function(e,t){this.select(t)},_onDatasetCleared:function(){this._updateHint()},_onDatasetRendered:function(e,t,n,i){this._updateHint(),this.eventBus.trigger("render",n,i,t)},_onAsyncRequested:function(e,t,n){this.eventBus.trigger("asyncrequest",n,t)},_onAsyncCanceled:function(e,t,n){this.eventBus.trigger("asynccancel",n,t)},_onAsyncReceived:function(e,t,n){this.eventBus.trigger("asyncreceive",n,t)},_onFocused:function(){this._minLengthMet()&&this.menu.update(this.input.getQuery())},_onBlurred:function(){this.input.hasQueryChangedSinceLastFocus()&&this.eventBus.trigger("change",this.input.getQuery())},_onEnterKeyed:function(e,t){var n;(n=this.menu.getActiveSelectable())&&this.select(n)&&t.preventDefault()},_onTabKeyed:function(e,t){var n;(n=this.menu.getActiveSelectable())?this.select(n)&&t.preventDefault():(n=this.menu.getTopSelectable())&&this.autocomplete(n)&&t.preventDefault()},_onEscKeyed:function(){this.close()},_onUpKeyed:function(){this.moveCursor(-1)},_onDownKeyed:function(){this.moveCursor(1)},_onLeftKeyed:function(){"rtl"===this.dir&&this.input.isCursorAtEnd()&&this.autocomplete(this.menu.getTopSelectable())},_onRightKeyed:function(){"ltr"===this.dir&&this.input.isCursorAtEnd()&&this.autocomplete(this.menu.getTopSelectable())},_onQueryChanged:function(e,t){this._minLengthMet(t)?this.menu.update(t):this.menu.empty()},_onWhitespaceChanged:function(){this._updateHint()},_onLangDirChanged:function(e,t){this.dir!==t&&(this.dir=t,this.menu.setLanguageDirection(t))},_openIfActive:function(){this.isActive()&&this.open()},_minLengthMet:function(e){return(e=n.isString(e)?e:this.input.getQuery()||"").length>=this.minLength},_updateHint:function(){var e,t,i,r,o,s,a;e=this.menu.getTopSelectable(),t=this.menu.getSelectableData(e),i=this.input.getInputValue(),!t||n.isBlankString(i)||this.input.hasOverflow()?this.input.clearHint():(r=u.normalizeQuery(i),o=n.escapeRegExChars(r),s=new RegExp("^(?:"+o+")(.+$)","i"),(a=s.exec(t.val))&&this.input.setHint(i+a[1]))},isEnabled:function(){return this.enabled},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},isActive:function(){return this.active},activate:function(){return!!this.isActive()||!(!this.isEnabled()||this.eventBus.before("active"))&&(this.active=!0,this.eventBus.trigger("active"),!0)},deactivate:function(){return!this.isActive()||!this.eventBus.before("idle")&&(this.active=!1,this.close(),this.eventBus.trigger("idle"),!0)},isOpen:function(){return this.menu.isOpen()},open:function(){return this.isOpen()||this.eventBus.before("open")||(this.menu.open(),this._updateHint(),this.eventBus.trigger("open")),this.isOpen()},close:function(){return this.isOpen()&&!this.eventBus.before("close")&&(this.menu.close(),this.input.clearHint(),this.input.resetInputValue(),this.eventBus.trigger("close")),!this.isOpen()},setVal:function(e){this.input.setQuery(n.toStr(e))},getVal:function(){return this.input.getQuery()},select:function(e){var t=this.menu.getSelectableData(e);return!(!t||this.eventBus.before("select",t.obj)||(this.input.setQuery(t.val,!0),this.eventBus.trigger("select",t.obj),this.close(),0))},autocomplete:function(e){var t,n;return t=this.input.getQuery(),!(!(n=this.menu.getSelectableData(e))||t===n.val||this.eventBus.before("autocomplete",n.obj)||(this.input.setQuery(n.val),this.eventBus.trigger("autocomplete",n.obj),0))},moveCursor:function(e){var t,n,i,r;return t=this.input.getQuery(),n=this.menu.selectableRelativeToCursor(e),i=this.menu.getSelectableData(n),r=i?i.obj:null,!(this._minLengthMet()&&this.menu.update(t)||this.eventBus.before("cursorchange",r)||(this.menu.setCursor(n),i?this.input.setInputValue(i.val):(this.input.resetInputValue(),this._updateHint()),this.eventBus.trigger("cursorchange",r),0))},destroy:function(){this.input.destroy(),this.menu.destroy()}}),e;function i(e){var t=[].slice.call(arguments,1);return function(){var i=[].slice.call(arguments);n.each(t,function(t){return e[t].apply(e,i)})}}}(),void function(){"use strict";var e,i,s;function a(e,n){e.each(function(){var e,r=t(this);(e=r.data(i.typeahead))&&n(e,r)})}function l(e){var i,r;return i=n.isJQuery(e)||n.isElement(e),(r=i?t(e).first():[]).length?r:null}e=t.fn.typeahead,i={www:"tt-www",attrs:"tt-attrs",typeahead:"tt-typeahead"},s={initialize:function(e,s){var a;return s=n.isArray(s)?s:[].slice.call(arguments,1),a=r((e=e||{}).classNames),this.each(function(){var r,h,f,q,g,m,_,v,y,b,S;n.each(s,function(t){t.highlight=!!e.highlight}),r=t(this),h=t(a.html.wrapper),f=l(e.hint),q=l(e.menu),g=!1!==e.hint&&!f,m=!1!==e.menu&&!q,g&&(f=function(e,t){return e.clone().addClass(t.classes.hint).removeData().css(t.css.hint).css((n=e,{backgroundAttachment:n.css("background-attachment"),backgroundClip:n.css("background-clip"),backgroundColor:n.css("background-color"),backgroundImage:n.css("background-image"),backgroundOrigin:n.css("background-origin"),backgroundPosition:n.css("background-position"),backgroundRepeat:n.css("background-repeat"),backgroundSize:n.css("background-size")})).prop("readonly",!0).removeAttr("id name placeholder required").attr({autocomplete:"off",spellcheck:"false",tabindex:-1});var n}(r,a)),m&&(q=t(a.html.menu).css(a.css.menu)),f&&f.val(""),r=function(e,t){e.data(i.attrs,{dir:e.attr("dir"),autocomplete:e.attr("autocomplete"),spellcheck:e.attr("spellcheck"),style:e.attr("style")}),e.addClass(t.classes.input).attr({autocomplete:"off",spellcheck:!1});try{!e.attr("dir")&&e.attr("dir","auto")}catch(e){}return e}(r,a),(g||m)&&(h.css(a.css.wrapper),r.css(g?a.css.input:a.css.inputWithNoHint),r.wrap(h).parent().prepend(g?f:null).append(m?q:null)),S=m?d:c,_=new o({el:r}),v=new u({hint:f,input:r},a),y=new S({node:q,datasets:s},a),b=new p({input:v,menu:y,eventBus:_,minLength:e.minLength},a),r.data(i.www,a),r.data(i.typeahead,b)})},isEnabled:function(){var e;return a(this.first(),function(t){e=t.isEnabled()}),e},enable:function(){return a(this,function(e){e.enable()}),this},disable:function(){return a(this,function(e){e.disable()}),this},isActive:function(){var e;return a(this.first(),function(t){e=t.isActive()}),e},activate:function(){return a(this,function(e){e.activate()}),this},deactivate:function(){return a(this,function(e){e.deactivate()}),this},isOpen:function(){var e;return a(this.first(),function(t){e=t.isOpen()}),e},open:function(){return a(this,function(e){e.open()}),this},close:function(){return a(this,function(e){e.close()}),this},select:function(e){var n=!1,i=t(e);return a(this.first(),function(e){n=e.select(i)}),n},autocomplete:function(e){var n=!1,i=t(e);return a(this.first(),function(e){n=e.autocomplete(i)}),n},moveCursor:function(e){var t=!1;return a(this.first(),function(n){t=n.moveCursor(e)}),t},val:function(e){var t;return arguments.length?(a(this,function(t){t.setVal(e)}),this):(a(this.first(),function(e){t=e.getVal()}),t)},destroy:function(){return a(this,function(e,t){!function(e){var t,r;t=e.data(i.www),r=e.parent().filter(t.selectors.wrapper),n.each(e.data(i.attrs),function(t,i){n.isUndefined(t)?e.removeAttr(i):e.attr(i,t)}),e.removeData(i.typeahead).removeData(i.www).removeData(i.attr).removeClass(t.classes.input),r.length&&(e.detach().insertAfter(r),r.remove())}(t),e.destroy()}),this}},t.fn.typeahead=function(e){return s[e]?s[e].apply(this,[].slice.call(arguments,1)):s.initialize.apply(this,arguments)},t.fn.typeahead.noConflict=function(){return t.fn.typeahead=e,this}}();var t,n,r,o,s,a,u,l,c,d,p}.apply(t,r))||(e.exports=o)}).call(this,n(557).setImmediate)}}]);
//# sourceMappingURL=libVendors.8a7c3fc459d2fe514eeb.build.min.js.map